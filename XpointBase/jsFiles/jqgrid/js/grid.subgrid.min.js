(function(n){n.fn.extend({setSubGrid:function(){return this.each(function(){var r=this,t;if(r.p.colNames.unshift(""),r.p.colModel.unshift({name:"subgrid",width:n.browser.safari?r.p.subGridWidth+r.p.cellLayout:r.p.subGridWidth,sortable:!1,resizable:!1,hidedlg:!0,search:!1}),t=r.p.subGridModel,t[0])for(t[0].align=n.extend([],t[0].align||[]),i=0;i<t[0].name.length;i++)t[0].align[i]=t[0].align[i]||"left"})},addSubGridCell:function(n,t){var i="",r;return this.each(function(){i=this.formatCol(n,t);r=this.p.gridview}),r===!1?"<td role='grid' class='ui-sgcollapsed sgcollapsed' "+i+"><a href='javascript:void(0);'><span class='ui-icon ui-icon-plus'><\/span><\/a><\/td>":"<td role='grid' "+i+"><\/td>"},addSubGrid:function(t,i){return this.each(function(){var r=this,e,u,o,c,h,l,f;if(r.grid){n("td:eq("+i+")",t).click(function(){if(n(this).hasClass("sgcollapsed")){if(o=r.p.id,e=n(this).parent(),c=i>=1?"<td colspan='"+i+"'>&nbsp;<\/td>":"",u=n(e).attr("id"),f=!0,n.isFunction(r.p.subGridBeforeExpand)&&(f=r.p.subGridBeforeExpand(o+"_"+u,u)),f===!1)return!1;h=0;n.each(r.p.colModel,function(){(this.hidden===!0||this.name=="rn"||this.name=="cb")&&h++});l="<tr role='row' class='ui-subgrid'>"+c+"<td><span class='ui-icon ui-icon-carat-1-sw'/><\/td><td colspan='"+parseInt(r.p.colNames.length-1-h)+"' class='ui-widget-content subgrid-data'><div id="+o+"_"+u+" class='tablediv'>";n(this).parent().after(l+"<\/div><\/td><\/tr>");n.isFunction(r.p.subGridRowExpanded)?r.p.subGridRowExpanded(o+"_"+u,u):y(e);n(this).html("<a href='javascript:void(0);'><span class='ui-icon ui-icon-minus'><\/span><\/a>").removeClass("sgcollapsed").addClass("sgexpanded")}else if(n(this).hasClass("sgexpanded")){if(f=!0,n.isFunction(r.p.subGridRowColapsed)&&(e=n(this).parent(),u=n(e).attr("id"),f=r.p.subGridRowColapsed(o+"_"+u,u)),f===!1)return!1;n(this).parent().next().remove(".ui-subgrid");n(this).html("<a href='javascript:void(0);'><span class='ui-icon ui-icon-plus'><\/span><\/a>").removeClass("sgexpanded").addClass("sgcollapsed")}return!1});var y=function(t){var f,u,i,e;if(f=n(t).attr("id"),u={id:f,nd_:(new Date).getTime()},!r.p.subGridModel[0])return!1;if(r.p.subGridModel[0].params)for(e=0;e<r.p.subGridModel[0].params.length;e++)for(i=0;i<r.p.colModel.length;i++)r.p.colModel[i].name==r.p.subGridModel[0].params[e]&&(u[r.p.colModel[i].name]=n("td:eq("+i+")",t).text().replace(/\&nbsp\;/ig,""));if(!r.grid.hDiv.loading){r.grid.hDiv.loading=!0;n("#load_"+r.p.id).show();r.p.subgridtype||(r.p.subgridtype=r.p.datatype);n.isFunction(r.p.subgridtype)&&r.p.subgridtype(u);switch(r.p.subgridtype){case"xml":n.ajax({type:r.p.mtype,url:r.p.subGridUrl,dataType:"xml",data:u,complete:function(n){a(n.responseXML,f);n=null}});break;case"json":n.ajax({type:r.p.mtype,url:r.p.subGridUrl,dataType:"text",data:u,complete:function(t){v(n.jgrid.parse(t.responseText),f);t=null}})}}return!1},s=function(t,i,u){var f=n("<td align='"+r.p.subGridModel[0].align[u]+"'><\/td>").html(i);n(t).append(f)},a=function(t,i){for(var o,e,h=n("<table cellspacing='0' cellpadding='0' border='0'><tbody><\/tbody><\/table>"),f=n("<tr><\/tr>"),c,u=0;u<r.p.subGridModel[0].name.length;u++)o=n("<th class='ui-state-default ui-th-column'><\/th>"),n(o).html(r.p.subGridModel[0].name[u]),n(o).width(r.p.subGridModel[0].width[u]),n(f).append(o);return n(h).append(f),t&&(e=r.p.xmlReader.subgrid,n(e.root+" "+e.row,t).each(function(){if(f=n("<tr class='ui-widget-content ui-subtblcell'><\/tr>"),e.repeatitems===!0)n(e.cell,this).each(function(t){s(f,n(this).text()||"&nbsp;",t)});else{var t=r.p.subGridModel[0].mapping;if(t)for(u=0;u<t.length;u++)s(f,n(t[u],this).text()||"&nbsp;",u)}n(h).append(f)})),c=n("table:first",r.grid.bDiv).attr("id")+"_",n("#"+c+i).append(h),r.grid.hDiv.loading=!1,n("#load_"+r.p.id).hide(),!1},v=function(t,i){for(var c,l,e,h,v=n("<table cellspacing='0' cellpadding='0' border='0'><tbody><\/tbody><\/table>"),o=n("<tr><\/tr>"),a,u,y,f=0;f<r.p.subGridModel[0].name.length;f++)c=n("<th class='ui-state-default ui-th-column'><\/th>"),n(c).html(r.p.subGridModel[0].name[f]),n(c).width(r.p.subGridModel[0].width[f]),n(o).append(c);if(n(v).append(o),t&&(h=r.p.jsonReader.subgrid,l=t[h.root],typeof l!="undefined"))for(f=0;f<l.length;f++){if(e=l[f],o=n("<tr class='ui-widget-content ui-subtblcell'><\/tr>"),h.repeatitems===!0)for(h.cell&&(e=e[h.cell]),u=0;u<e.length;u++)s(o,e[u]||"&nbsp;",u);else if(a=r.p.subGridModel[0].mapping,a.length)for(u=0;u<a.length;u++)s(o,e[a[u]]||"&nbsp;",u);n(v).append(o)}return y=n("table:first",r.grid.bDiv).attr("id")+"_",n("#"+y+i).append(v),r.grid.hDiv.loading=!1,n("#load_"+r.p.id).hide(),!1};r.subGridXml=function(n,t){a(n,t)};r.subGridJson=function(n,t){v(n,t)}}})},expandSubGridRow:function(t){return this.each(function(){var u=this,i,r;(u.grid||t)&&u.p.subGrid===!0&&(i=n(this).getInd(t,!0),i&&(r=n("td.sgcollapsed",i)[0],r&&n(r).trigger("click")))})},collapseSubGridRow:function(t){return this.each(function(){var u=this,i,r;(u.grid||t)&&u.p.subGrid===!0&&(i=n(this).getInd(t,!0),i&&(r=n("td.sgexpanded",i)[0],r&&n(r).trigger("click")))})},toggleSubGridRow:function(t){return this.each(function(){var u=this,r,i;(u.grid||t)&&u.p.subGrid===!0&&(r=n(this).getInd(t,!0),r&&(i=n("td.sgcollapsed",r)[0],i?n(i).trigger("click"):(i=n("td.sgexpanded",r)[0],i&&n(i).trigger("click"))))})}})})(jQuery);
/*
//# sourceMappingURL=grid.subgrid.min.js.map
*/