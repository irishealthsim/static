(function(n){n.fn.extend({setTreeNode:function(t,i){return this.each(function(){var r=this,f,o,s,u;if(r.grid&&r.p.treeGrid){var l=r.p.expColInd,h=r.p.treeReader.expanded_field,e=r.p.treeReader.leaf_field,c=r.p.treeReader.level_field;i.level=t[c];r.p.treeGridModel=="nested"?(i.lft=t[r.p.treeReader.left_field],i.rgt=t[r.p.treeReader.right_field],t[e]||(t[e]=parseInt(i.rgt,10)===parseInt(i.lft,10)+1?"true":"false")):i.parent_id=t[r.p.treeReader.parent_id_field];f=parseInt(i.level,10);r.p.tree_root_level===0?(o=f+1,s=f):(o=f,s=f-1);u="<div class='tree-wrap' style='width:"+o*18+"px;'>";u+="<div style='left:"+s*18+"px;' class='ui-icon ";t[e]=="true"||t[e]==!0?(u+=r.p.treeIcons.leaf+" tree-leaf'",i.isLeaf=!0):(t[h]=="true"||t[h]==!0?(u+=r.p.treeIcons.minus+" tree-minus treeclick'",i.expanded=!0):(u+=r.p.treeIcons.plus+" tree-plus treeclick'",i.expanded=!1),i.isLeaf=!1);u+="<\/div><\/div>";parseInt(t[c],10)!==parseInt(r.p.tree_root_level,10)&&(n(r).isVisibleNode(i)||n(i).css("display","none"));n("td:eq("+l+")",i).wrapInner("<span><\/span>").prepend(u);n(".treeclick",i).bind("click",function(t){var u=t.target||t.srcElement,i=n(u,r.rows).parents("tr.jqgrow")[0].rowIndex;return r.rows[i].isLeaf||(r.rows[i].expanded?(n(r).collapseRow(r.rows[i]),n(r).collapseNode(r.rows[i])):(n(r).expandRow(r.rows[i]),n(r).expandNode(r.rows[i]))),!1});r.p.ExpandColClick===!0&&n("span",i).css("cursor","pointer").bind("click",function(t){var u=t.target||t.srcElement,i=n(u,r.rows).parents("tr.jqgrow")[0].rowIndex;return r.rows[i].isLeaf||(r.rows[i].expanded?(n(r).collapseRow(r.rows[i]),n(r).collapseNode(r.rows[i])):(n(r).expandRow(r.rows[i]),n(r).expandNode(r.rows[i]))),n(r).setSelection(r.rows[i].id),!1})}})},setTreeGrid:function(){return this.each(function(){var t=this,i=0,r;if(t.p.treeGrid){t.p.treedatatype||n.extend(t.p,{treedatatype:t.p.datatype});t.p.subGrid=!1;t.p.altRows=!1;t.p.pgbuttons=!1;t.p.pginput=!1;t.p.multiselect=!1;t.p.rowList=[];t.p.treeIcons=n.extend({plus:"ui-icon-triangle-1-e",minus:"ui-icon-triangle-1-s",leaf:"ui-icon-radio-off"},t.p.treeIcons||{});t.p.treeGridModel=="nested"?t.p.treeReader=n.extend({level_field:"level",left_field:"lft",right_field:"rgt",leaf_field:"isLeaf",expanded_field:"expanded"},t.p.treeReader):t.p.treeGridModel=="adjacency"&&(t.p.treeReader=n.extend({level_field:"level",parent_id_field:"parent",leaf_field:"isLeaf",expanded_field:"expanded"},t.p.treeReader));for(r in t.p.colModel){if(t.p.colModel[r].name==t.p.ExpandColumn){t.p.expColInd=i;break}i++}t.p.expColInd||(t.p.expColInd=0);n.each(t.p.treeReader,function(n,i){i&&(t.p.colNames.push(i),t.p.colModel.push({name:i,width:1,hidden:!0,sortable:!1,resizable:!1,hidedlg:!0,editable:!0,search:!1}))})}})},expandRow:function(t){this.each(function(){var i=this,r;i.grid&&i.p.treeGrid&&(r=n(i).getNodeChildren(t),n(r).each(function(){n(this).css("display","");this.expanded&&n(i).expandRow(this)}))})},collapseRow:function(t){this.each(function(){var i=this,r;i.grid&&i.p.treeGrid&&(r=n(i).getNodeChildren(t),n(r).each(function(){n(this).css("display","none");n(i).collapseRow(this)}))})},getRootNodes:function(){var t=[];return this.each(function(){var i=this,r;if(i.grid&&i.p.treeGrid)switch(i.p.treeGridModel){case"nested":r=i.p.treeReader.level_field;n(i.rows).each(function(){parseInt(this[r],10)===parseInt(i.p.tree_root_level,10)&&t.push(this)});break;case"adjacency":n(i.rows).each(function(){(this.parent_id==null||this.parent_id.toLowerCase()=="null")&&t.push(this)})}}),t},getNodeDepth:function(t){var i=null;return this.each(function(){var r=this;if(this.grid&&this.p.treeGrid)switch(r.p.treeGridModel){case"nested":i=parseInt(t.level,10)-parseInt(this.p.tree_root_level,10);break;case"adjacency":i=n(r).getNodeAncestors(t).length}}),i},getNodeParent:function(t){var i=null;return this.each(function(){var r=this;if(r.grid&&r.p.treeGrid)switch(r.p.treeGridModel){case"nested":var u=parseInt(t.lft,10),f=parseInt(t.rgt,10),e=parseInt(t.level,10);n(this.rows).each(function(){if(parseInt(this.level,10)===e-1&&parseInt(this.lft)<u&&parseInt(this.rgt)>f)return i=this,!1});break;case"adjacency":n(this.rows).each(function(){if(this.id==t.parent_id)return i=this,!1})}}),i},getNodeChildren:function(t){var i=[];return this.each(function(){var r=this;if(r.grid&&r.p.treeGrid)switch(r.p.treeGridModel){case"nested":var u=parseInt(t.lft,10),f=parseInt(t.rgt,10),e=parseInt(t.level,10);n(this.rows).each(function(){parseInt(this.level,10)===e+1&&parseInt(this.lft,10)>u&&parseInt(this.rgt,10)<f&&i.push(this)});break;case"adjacency":n(this.rows).each(function(){this.parent_id==t.id&&i.push(this)})}}),i},getFullTreeNode:function(t){var i=[];return this.each(function(){var r=this;if(r.grid&&r.p.treeGrid)switch(r.p.treeGridModel){case"nested":var u=parseInt(t.lft,10),f=parseInt(t.rgt,10),e=parseInt(t.level,10);n(this.rows).each(function(){parseInt(this.level,10)>=e&&parseInt(this.lft,10)>=u&&parseInt(this.lft,10)<=f&&i.push(this)})}}),i},getNodeAncestors:function(t){var i=[];return this.each(function(){if(this.grid&&this.p.treeGrid)for(var r=n(this).getNodeParent(t);r;)i.push(r),r=n(this).getNodeParent(r)}),i},isVisibleNode:function(t){var i=!0;return this.each(function(){var r=this,u;r.grid&&r.p.treeGrid&&(u=n(r).getNodeAncestors(t),n(u).each(function(){return i=i&&this.expanded,i?void 0:!1}))}),i},isNodeLoaded:function(t){var i;return this.each(function(){var r=this;r.grid&&r.p.treeGrid&&(i=t.loaded!==undefined?t.loaded:t.isLeaf||n(r).getNodeChildren(t).length>0?!0:!1)}),i},expandNode:function(t){return this.each(function(){this.grid&&this.p.treeGrid&&(t.expanded||(n(this).isNodeLoaded(t)?(t.expanded=!0,n("div.treeclick",t).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus")):(t.expanded=!0,n("div.treeclick",t).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus"),this.p.treeANode=t.rowIndex,this.p.datatype=this.p.treedatatype,this.p.treeGridModel=="nested"?n(this).setGridParam({postData:{nodeid:t.id,n_left:t.lft,n_right:t.rgt,n_level:t.level}}):n(this).setGridParam({postData:{nodeid:t.id,parentid:t.parent_id,n_level:t.level}}),n(this).trigger("reloadGrid"),this.p.treeGridModel=="nested"?n(this).setGridParam({postData:{nodeid:"",n_left:"",n_right:"",n_level:""}}):n(this).setGridParam({postData:{nodeid:"",parentid:"",n_level:""}}))))})},collapseNode:function(t){return this.each(function(){this.grid&&this.p.treeGrid&&t.expanded&&(t.expanded=!1,n("div.treeclick",t).removeClass(this.p.treeIcons.minus+" tree-minus").addClass(this.p.treeIcons.plus+" tree-plus"))})},SortTree:function(t){return this.each(function(){if(this.grid&&this.p.treeGrid){var r,o,u,f=[],e=this,i=n(this).getRootNodes();for(i.sort(function(n,i){return n.sortKey<i.sortKey?-t:n.sortKey>i.sortKey?t:0}),i[0]&&(n("td",i[0]).each(function(t){n(this).css("width",e.grid.headers[t].width+"px")}),e.grid.cols=i[0].cells),r=0,o=i.length;r<o;r++)u=i[r],f.push(u),n(this).collectChildrenSortTree(f,u,t);n.each(f,function(t,i){n("tbody",e.grid.bDiv).append(i);i.sortKey=null})}})},collectChildrenSortTree:function(t,i,r){return this.each(function(){if(this.grid&&this.p.treeGrid){var u,o,f,e=n(this).getNodeChildren(i);for(e.sort(function(n,t){return n.sortKey<t.sortKey?-r:n.sortKey>t.sortKey?r:0}),u=0,o=e.length;u<o;u++)f=e[u],t.push(f),n(this).collectChildrenSortTree(t,f,r)}})},setTreeRow:function(t,i){var r=!1;return this.each(function(){var u=this;u.grid&&u.p.treeGrid&&(r=n(u).setRowData(t,i))}),r},delTreeNode:function(t){return this.each(function(){var i=this,r,u,f;if(i.grid&&i.p.treeGrid&&(r=n(i).getInd(t,!0),r)){if(u=n(i).getNodeChildren(r),u.length>0)for(f=0;f<u.length;f++)n(i).delRowData(u[f].id);n(i).delRowData(r.id)}})}})})(jQuery);
/*
//# sourceMappingURL=grid.treegrid.min.js.map
*/