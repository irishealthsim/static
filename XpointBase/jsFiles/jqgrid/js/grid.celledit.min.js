(function(n){n.fn.extend({editCell:function(t,i,r){return this.each(function(){var u=this,f,e,o,c,l,s,h;if(u.grid&&u.p.cellEdit===!0){if(i=parseInt(i,10),u.p.selrow=u.rows[t].id,u.p.knv||n(u).GridNav(),u.p.savedRow.length>0){if(r===!0&&t==u.p.iRow&&i==u.p.iCol)return;c=n("td:eq("+u.p.savedRow[0].ic+")>#"+u.p.savedRow[0].id+"_"+u.p.savedRow[0].name.replace(".","\\."),u.rows[u.p.savedRow[0].id]).val();u.p.savedRow[0].v!=c?n(u).saveCell(u.p.savedRow[0].id,u.p.savedRow[0].ic):n(u).restoreCell(u.p.savedRow[0].id,u.p.savedRow[0].ic)}else window.setTimeout(function(){n("#"+u.p.knv).attr("tabindex","-1").focus()},0);if(f=u.p.colModel[i].name,f!="subgrid"&&f!="cb"&&f!="rn"){if(u.p.colModel[i].editable===!0&&r===!0){o=n("td:eq("+i+")",u.rows[t]);parseInt(u.p.iCol)>=0&&parseInt(u.p.iRow)>=0&&(n("td:eq("+u.p.iCol+")",u.rows[u.p.iRow]).removeClass("edit-cell ui-state-highlight"),n(u.rows[u.p.iRow]).removeClass("selected-row ui-state-hover"));n(o).addClass("edit-cell ui-state-highlight");n(u.rows[t]).addClass("selected-row ui-state-hover");try{e=n.unformat(o,{colModel:u.p.colModel[i]},i)}catch(a){e=n.jgrid.htmlDecode(n(o).html())}l=n.extend({},u.p.colModel[i].editoptions||{},{id:t+"_"+f,name:f});u.p.colModel[i].edittype||(u.p.colModel[i].edittype="text");u.p.savedRow.push({id:t,ic:i,name:f,v:e});n.isFunction(u.p.formatCell)&&(s=u.p.formatCell(u.rows[t].id,f,e,t,i),s&&(e=s));h=createEl(u.p.colModel[i].edittype,l,e,o);n.isFunction(u.p.beforeEditCell)&&u.p.beforeEditCell(u.rows[t].id,f,e,t,i);n(o).html("").append(h).attr("tabindex","0");window.setTimeout(function(){n(h).focus()},0);n("input, select, textarea",o).bind("keydown",function(r){r.keyCode===27&&n(u).restoreCell(t,i);r.keyCode===13&&n(u).saveCell(t,i);r.keyCode==9&&(r.shiftKey?n(u).prevCell(t,i):n(u).nextCell(t,i));r.stopPropagation()});n.isFunction(u.p.afterEditCell)&&u.p.afterEditCell(u.rows[t].id,f,e,t,i)}else if(parseInt(u.p.iCol)>=0&&parseInt(u.p.iRow)>=0&&(n("td:eq("+u.p.iCol+")",u.rows[u.p.iRow]).removeClass("edit-cell ui-state-highlight"),n(u.rows[u.p.iRow]).removeClass("selected-row ui-state-hover")),n("td:eq("+i+")",u.rows[t]).addClass("edit-cell ui-state-highlight"),n(u.rows[t]).addClass("selected-row ui-state-hover"),n.isFunction(u.p.onSelectCell)){e=n("td:eq("+i+")",u.rows[t]).html().replace(/\&nbsp\;/ig,"");u.p.onSelectCell(u.rows[t].id,f,e,t,i)}u.p.iCol=i;u.p.iRow=t}}})},saveCell:function(t,i){return this.each(function(){var r=this,l,o,u,e,f,a,v,c,y,p,h,s;if(r.grid&&r.p.cellEdit===!0){if(l=r.p.savedRow.length>=1?0:null,l!=null){o=n("td:eq("+i+")",r.rows[t]);f=r.p.colModel[i].name.replace(".","\\.");switch(r.p.colModel[i].edittype){case"select":r.p.colModel[i].editoptions.multiple?(a=n("#"+t+"_"+f.replace(".","\\."),r.rows[t]),v=[],u=n(a).val(),u?u.join(","):u="",n("option:selected",a).each(function(t,i){v[t]=n(i).text()}),e=v.join(",")):(u=n("#"+t+"_"+f.replace(".","\\.")+">option:selected",r.rows[t]).val(),e=n("#"+t+"_"+f.replace(".","\\.")+">option:selected",r.rows[t]).text());break;case"checkbox":c=["Yes","No"];r.p.colModel[i].editoptions&&(c=r.p.colModel[i].editoptions.value.split(":"));u=n("#"+t+"_"+f.replace(".","\\."),r.rows[t]).attr("checked")?c[0]:c[1];e=u;break;case"password":case"text":case"textarea":case"button":u=r.p.autoencode?n.jgrid.htmlEncode(n("#"+t+"_"+f.replace(".","\\."),r.rows[t]).val()):n("#"+t+"_"+f.replace(".","\\."),r.rows[t]).val();e=u}if(e!=r.p.savedRow[l].v)if(n.isFunction(r.p.beforeSaveCell)&&(y=r.p.beforeSaveCell(r.rows[t].id,f,u,t,i),y&&(u=y)),p=checkValues(u,i,r),p[0]===!0){if(h={},n.isFunction(r.p.beforeSubmitCell)&&(h=r.p.beforeSubmitCell(r.rows[t].id,f,u,t,i),h||(h={})),r.p.cellsubmit=="remote")if(r.p.cellurl)s={},s[f]=u,s.id=r.rows[t].id,s=n.extend(h,s),n.ajax({url:r.p.cellurl,data:s,type:"POST",complete:function(h,c){if(c=="success")if(n.isFunction(r.p.afterSubmitCell)){var l=r.p.afterSubmitCell(h,s.id,f,u,t,i);l[0]===!0?(n(o).empty(),n(r).setCell(r.rows[t].id,i,e),n(o).addClass("dirty-cell"),n(r.rows[t]).addClass("edited"),n.isFunction(r.p.afterSaveCell)&&r.p.afterSaveCell(r.rows[t].id,f,u,t,i),r.p.savedRow.splice(0,1)):(info_dialog(n.jgrid.errors.errcap,l[1],n.jgrid.edit.bClose),n(r).restoreCell(t,i))}else n(o).empty(),n(r).setCell(r.rows[t].id,i,e),n(o).addClass("dirty-cell"),n(r.rows[t]).addClass("edited"),n.isFunction(r.p.afterSaveCell)&&r.p.afterSaveCell(r.rows[t].id,f,u,t,i),r.p.savedRow.splice(0,1)},error:function(u,f){n.isFunction(r.p.errorCell)?(r.p.errorCell(u,f),n(r).restoreCell(t,i)):(info_dialog(n.jgrid.errors.errcap,u.status+" : "+u.statusText+"<br/>"+f,n.jgrid.edit.bClose),n(r).restoreCell(t,i))}});else try{info_dialog(n.jgrid.errors.errcap,n.jgrid.errors.nourl,n.jgrid.edit.bClose);n(r).restoreCell(t,i)}catch(w){}r.p.cellsubmit=="clientArray"&&(n(o).empty(),n(r).setCell(r.rows[t].id,i,e),n(o).addClass("dirty-cell"),n(r.rows[t]).addClass("edited"),n.isFunction(r.p.afterSaveCell)&&r.p.afterSaveCell(r.rows[t].id,f,u,t,i),r.p.savedRow.splice(0,1))}else try{window.setTimeout(function(){info_dialog(n.jgrid.errors.errcap,u+" "+p[1],n.jgrid.edit.bClose)},100);n(r).restoreCell(t,i)}catch(w){}else n(r).restoreCell(t,i)}n.browser.opera?n("#"+r.p.knv).attr("tabindex","-1").focus():window.setTimeout(function(){n("#"+r.p.knv).attr("tabindex","-1").focus()},0)}})},restoreCell:function(t,i){return this.each(function(){var r=this,u,f;if(r.grid&&r.p.cellEdit===!0){if(u=r.p.savedRow.length>=1?0:null,u!=null){if(f=n("td:eq("+i+")",r.rows[t]),n.isFunction(n.fn.datepicker))try{n.datepicker("hide")}catch(e){try{n.datepicker.hideDatepicker()}catch(e){}}n(f).empty().attr("tabindex","-1");n(r).setCell(r.rows[t].id,i,r.p.savedRow[u].v);r.p.savedRow.splice(0,1)}window.setTimeout(function(){n("#"+r.p.knv).attr("tabindex","-1").focus()},0)}})},nextCell:function(t,i){return this.each(function(){var r=this,f=!1,u;if(r.grid&&r.p.cellEdit===!0){for(u=i+1;u<r.p.colModel.length;u++)if(r.p.colModel[u].editable===!0){f=u;break}f!==!1?n(r).editCell(t,f,!0):r.p.savedRow.length>0&&n(r).saveCell(t,i)}})},prevCell:function(t,i){return this.each(function(){var r=this,f=!1,u;if(r.grid&&r.p.cellEdit===!0){for(u=i-1;u>=0;u--)if(r.p.colModel[u].editable===!0){f=u;break}f!==!1?n(r).editCell(t,f,!0):r.p.savedRow.length>0&&n(r).saveCell(t,i)}})},GridNav:function(){return this.each(function(){function r(i,r,u){if(u.substr(0,1)=="v"){var e=n(t.grid.bDiv)[0].clientHeight,o=n(t.grid.bDiv)[0].scrollTop,s=t.rows[i].offsetTop+t.rows[i].clientHeight,h=t.rows[i].offsetTop;u=="vd"&&s>=e&&(n(t.grid.bDiv)[0].scrollTop=n(t.grid.bDiv)[0].scrollTop+t.rows[i].clientHeight);u=="vu"&&h<o&&(n(t.grid.bDiv)[0].scrollTop=n(t.grid.bDiv)[0].scrollTop-t.rows[i].clientHeight)}if(u=="h"){var c=n(t.grid.bDiv)[0].clientWidth,f=n(t.grid.bDiv)[0].scrollLeft,l=t.rows[i].cells[r].offsetLeft+t.rows[i].cells[r].clientWidth,a=t.rows[i].cells[r].offsetLeft;l>=c+parseInt(f)?n(t.grid.bDiv)[0].scrollLeft=n(t.grid.bDiv)[0].scrollLeft+t.rows[i].cells[r].clientWidth:a<f&&(n(t.grid.bDiv)[0].scrollLeft=n(t.grid.bDiv)[0].scrollLeft-t.rows[i].cells[r].clientWidth)}}function f(n,i){var u,r;if(i=="lft")for(u=n+1,r=n;r>=0;r--)if(t.p.colModel[r].hidden!==!0){u=r;break}if(i=="rgt")for(u=n-1,r=n;r<t.p.colModel.length;r++)if(t.p.colModel[r].hidden!==!0){u=r;break}return u}var t=this,u,i;t.grid&&t.p.cellEdit===!0&&(t.p.knv=n("table:first",t.grid.bDiv).attr("id")+"_kn",u=n("<span style='width:0px;height:0px;background-color:black;' tabindex='0'><span tabindex='-1' style='width:0px;height:0px;background-color:grey' id='"+t.p.knv+"'><\/span><\/span>"),n(u).insertBefore(t.grid.cDiv),n("#"+t.p.knv).focus(),n("#"+t.p.knv).keydown(function(u){switch(u.keyCode){case 38:t.p.iRow-1>=0&&(r(t.p.iRow-1,t.p.iCol,"vu"),n(t).editCell(t.p.iRow-1,t.p.iCol,!1));break;case 40:t.p.iRow+1<=t.rows.length-1&&(r(t.p.iRow+1,t.p.iCol,"vd"),n(t).editCell(t.p.iRow+1,t.p.iCol,!1));break;case 37:t.p.iCol-1>=0&&(i=f(t.p.iCol-1,"lft"),r(t.p.iRow,i,"h"),n(t).editCell(t.p.iRow,i,!1));break;case 39:t.p.iCol+1<=t.p.colModel.length-1&&(i=f(t.p.iCol+1,"rgt"),r(t.p.iRow,i,"h"),n(t).editCell(t.p.iRow,i,!1));break;case 13:parseInt(t.p.iCol,10)>=0&&parseInt(t.p.iRow,10)>=0&&n(t).editCell(t.p.iRow,t.p.iCol,!0)}return!1}))})},getChangedCells:function(t){var i=[];return t||(t="all"),this.each(function(){var u=this,r;u.grid&&u.p.cellEdit===!0&&n(u.rows).each(function(){var f={};n(this).hasClass("edited")&&(n("td",this).each(function(i){r=u.p.colModel[i].name;r!=="cb"&&r!=="subgrid"&&(t=="dirty"?n(this).hasClass("dirty-cell")&&(f[r]=n.jgrid.htmlDecode(n(this).html())):f[r]=n.jgrid.htmlDecode(n(this).html()))}),f.id=this.id,i.push(f))})}),i}})})(jQuery);
/*
//# sourceMappingURL=grid.celledit.min.js.map
*/