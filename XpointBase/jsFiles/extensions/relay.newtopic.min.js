(function(n){n.getquery=function(){var t={},n=location.search;return n=n.replace(/^\?/,""),n=n.replace(/\&$/,""),jQuery.each(n.split("&"),function(){var i=this.split("=")[0],n=this.split("=")[1];/^[0-9.]+$/.test(n)&&(n=parseFloat(n));n&&(t[i]=n)}),t};n.fn.newtopic=function(t){function f(){tinyMCE.triggerSave()}function u(t){var r=n("#"+i.errorp);r.hide();r.html('<div class="xp-Width30" style="margin:auto;"><div style="margin:auto;" class="xp-FloatLeft"><img src="/_layouts/Images/XPointBase/error_msg.png" style="padding-right:6px"/><\/div><div style="margin:auto;" class="xp-FloatLeft">'+t+"<\/div><\/div>");r.addClass("ui-state-error");r.addClass("xp-ErrorMsg");r.show().fadeOut(1e4)}function e(n){n.RelayRichText()}function o(){var f=n("#"+i.body),r,u;e(f);n("#"+i.title).charCounter(50,{style:""});t.enablecategory&&(r=n.getquery().category,r==null&&(r=""),n("#"+i.category).classification({listname:"g_spforums_category",columnname:"Title",parentcolumnname:"",parentid:"",serviceurl:"/_layouts/IImpact.Web/ClassificationService.asmx/Classification",valuecolumn:"",uniquevals:"False",autoindexing:"False",allowblank:!1,selectedvalue:r}),u=n.getquery().forum,(u==null||r=="")&&(u=""),n("#"+i.subcategory).classification({listname:"g_spforums_forums",columnname:"Title",parentcolumnname:"CategoryID",parentid:i.category,serviceurl:"/_layouts/IImpact.Web/ClassificationService.asmx/Classification",valuecolumn:"",uniquevals:"False",autoindexing:"False",allowblank:!1,selectedvalue:u,parentKey:r}))}function s(){var r=!0;return(t.title=n("#"+i.title).val(),n.trim(t.title).length==0)?(r=!1,u("Enter a valid title"),r):t.enablecategory&&(t.subcategory=n("#"+i.subcategory).val(),n.trim(t.subcategory).length==0)?(r=!1,u("Select valid category and subcategory"),r):(f(),t.body=n("#"+i.body).val(),n.trim(t.body).length==0)?(r=!1,u("Enter topic description"),r):r}function h(n){for(var i,r=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),t=0;t<r.length;t++)if(i=r[t].split("="),i[0]==n)return i[1]}function c(r){var y=n("<div id='"+i.errorp+"'/>"),p,e,f,a,v;y.hide();r.append(y);p=n("<div class='xp-FloatLeft xp-Width xp-PaddingBottom-5'><div class='xp-DivHeader  xp-Overflowhidden' >Create Discussion<\/div><\/div>");r.append(p);var w=n("<div style='width:87%' class='xp-FloatLeft xp-Width xp-OuterPanel ui-corner-all xp-BoxShadow' />"),c=n("<table class='xp-Width xp-NewTopicTd' cellpadding=10px cellspacing=0 />"),e=n("<tr />"),f=n("<td  style='width:140px' class='xp-FontBold' />");f.append("Title <span class='"+t.requiredcss+"'>*<\/span>");e.append(f);f=n("<td class='xp-Width80'/>");f.append(" <div class='xp-Width40 xp-FloatLeft'><input type='text' autocomplete='off' id='"+i.title+"' class='xp-TxtBox xp-Width xp-FloatLeft ' /><\/div>");e.append(f);c.append(e);t.enablecategory&&(e=n("<tr />"),f=n("<td  style='' class='xp-FontBold'/>"),f.append("Category <span class='"+t.requiredcss+"'>*<\/span>"),e.append(f),f=n("<td />"),f.append("<select id='"+i.category+"' style='width:250px' />"),e.append(f),c.append(e),e=n("<tr />"),f=n("<td  style='' class='xp-FontBold'/>"),f.append("Subcategory <span class='"+t.requiredcss+"'>*<\/span>"),e.append(f),f=n("<td />"),f.append("<select id='"+i.subcategory+"' style='width:250px' />"),e.append(f),c.append(e));e=n("<tr />");f=n("<td class='xp-FontBold' style='vertical-align:top;' valign='top' />");f.append("Body <span class='"+t.requiredcss+"'>*<\/span>");e.append(f);f=n("<td/>");f.append("<textarea id='"+i.body+"' cols='75' rows='10'/>");e.append(f);c.append(e);var e=n("<tr />"),f=n("<td colspan=2 />"),l=n("<div style='margin:auto;width:auto !important;float:right' class='xp-Width30'/>"),b=n("<div class='xp-FloatLeft' />"),k=n("<input type='button' id='"+i.addbuttonid+"' value='Post' class='ui-button  ui-primarytabclr ui-corner-all'/>");b.append(k);l.append(b);a=n("<div style=' padding-left:15px;' class='xp-FloatLeft'  />");v=n("<input type='button' value='Cancel' class='ui-button ui-secondarytabclr ui-corner-all'/>");a.append(v);l.append(a);f.append(l);e.append(f);c.append(e);w.append(c);r.append(w);o();v.click(function(){window.location=document.referrer?document.referrer:t.cancelpageurl});n(document).ready(function(){n("select").wrap("<label class='xp-CustomLabel'/>")});k.click(function(){var i=h("trackerId"),r="",f;i!="undefined"&&(r=i);s()&&(f={title:t.title,subcategory:t.subcategory,body:t.body,forumtype:t.forumtype,trackerID:""+r+""},n.ajax({url:t.saveurl,contentType:"application/json; charset=utf-8",type:"post",dataType:"json",data:n.toJSON(f),success:function(n){var t=n.d;t.status=="success"?window.location=t.message:u(t.message)}}))})}var t=n.extend({saveurl:"",enablecategory:!0,forumtype:"general",requiredcss:"xp-Error",cancelpageurl:"",body:"",subcategory:"",title:"",categorylist:"g_spforums_category",subcategorylist:""},t),r=n(this).attr("id"),i={title:r+"_title",category:r+"_category",subcategory:r+"_subcategory",body:r+"_bodytext",addbuttonid:r+"_addbutton",errorp:r+"_errormessage"};return this.each(function(){var t=n(this);c(t)})}})(jQuery);
/*
//# sourceMappingURL=relay.newtopic.min.js.map
*/