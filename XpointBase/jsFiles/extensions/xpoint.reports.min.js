function getQueryStrings(){for(var n,i={},r=function(n){return decodeURIComponent(n.replace(/\+/g," "))},f=location.search.substring(1),u=f.split("&"),t=0;t<u.length;t++)n=u[t].split("="),n.length>1&&(i[r(n[0]).toLowerCase()]=r(n[1]));return i}var filterRules=[];(function(n){n.xpreports={defaults:{baseUrl:"",keyVariable:"trackerID",keyValue:"",reportConfig:[],iconUrl:"",modalId:"reportModalId",title:"Generate Document",label:"Document Type",notifyMsg:"Your document is on its way, it may take a few minutes to download....",exportBtnId:"exportBtnId",formatterLabel:"",needImage:!0,param1:!1,param2:"/_layouts/IImpact.Web/LifeCycleService.asmx/GetReportsConfig"},methods:{generateReport:function(t,i,r,u,f,e,o){var c="",h,s;o=window.location.origin;c=e!=undefined?e+"?"+r+"="+u+"&reportID="+i:n.xpreports.methods.prepareUrl(t,i,r,u,f);h=n("#myframe");h.length>0&&h.remove();s=document.createElement("iframe");s.setAttribute("id","myframe");s.setAttribute("src",c);s.style.display="none";document.body.appendChild(s)},prepareUrl:function(t,i,r,u,f){var o="",e;if(filterRules.length>0&&n("#IsFiltered")[0].checked)for(e=0;e<filterRules.length;e++)o+="&~data"+e+"="+filterRules[e].data+"&field"+e+"="+filterRules[e].field+"&op"+e+"="+filterRules[e].op+"";return t+"?reportID="+i+"&"+r+"="+u+"&frmID="+f+o},getConfig:function(t){var i=t.keyVariable.toLowerCase(),r=getQueryStrings()[i],u={contentType:"application/json; charset=utf-8",type:"post",dataType:"json",async:!1,data:"{"+i+":"+r+"}",url:t.param2,success:function(datap){var data=datap.d,config=eval("("+data+")");t=n.extend(t,config)}};n.ajax(u)},prepareModal:function(t){var v=this,i=n("#"+t.modalId),r,l,s,u,a,h,e;if(i.length>0)i.dialog("open");else{var c=n("body"),i=n("<div id='"+t.modalId+"' style='height:auto;width:auto' title='"+t.title+"' />").appendTo(c),o=n("<\/p>").html(n.xpreports.defaults.notifyMsg).attr("style","display:none;").appendTo(i),f=n("<div />").addClass("xp-FloatLeft xp-Width xp-MarginTop-25").appendTo(i);f.append("<div class='xp-FloatLeft xp-Width30 xp-FontBold'>"+t.label+"<\/div>");r=n("<select class='xp-Width90'/>");l=n("<div />").addClass("xp-FloatLeft xp-Width70").append(r).appendTo(f);n(t.reportConfig).each(function(){var n=this;window.reportlevel=n.reportLevel});reportlevel=="Portfolio"&&f.append("<div class='xp-FontBold' style='margin-Top:15%'>Do you want export only filtered projects <input type='checkBox' id='IsFiltered'/><\/div>");n(t.reportConfig).each(function(){var t=this,i=n("<option/>").text(t.title).val(t.id);r.append(i)});s=n("<div />").hide().addClass("xp-FloatLeft xp-Width xp-MarginTop-5").appendTo(i);s.append("<div class='xp-FloatLeft xp-Width30 xp-FontBold'>"+t.formatterLabel+"<\/div>");u=n("<select class='xp-Width90'/>");a=n("<div />").addClass("xp-FloatLeft xp-Width70").append(u).appendTo(s);r.change(function(){var r=n(this).val(),i=n.grep(t.reportConfig,function(n){return n.id==r});u.children().remove();i=i[0].frms;n(i).each(function(){var t=this,i=n("<option/>").val(t.frmId).text(t.displayName);u.append(i)})});h=r.val();e=n.grep(t.reportConfig,function(n){return n.id==h});e=e[0].frms;n(e).each(function(){var t=this,i=n("<option/>").val(t.frmId).text(t.displayName);u.append(i)});i.dialog({bgiframe:!0,modal:!0,buttons:[{text:"Export",id:n.xpreports.defaults.exportBtnId,click:function(){n("#"+n.xpreports.defaults.exportBtnId).hide();f.hide();o.show();var e=r.val(),c=u.val(),s="",h=n("#relayAjaxLoading");h.length>0&&h.remove();$loadingProgressBar=n("<div id='relayAjaxLoading'><div class='xp-Width xp-TextAlignCenter xp-Height100' style='top: 10%;left: 0px;margin-top:10px;'><img src='/_layouts/Images/XPointBase/Loader.gif';z-index:999999999;text-align:center;'/><\/div><\/div>");o.show().append($loadingProgressBar);n.ajax({xhr:function(){var n=new window.XMLHttpRequest;return n.upload.addEventListener("relayAjaxLoading",function(n){if(n.lengthComputable){var t=n.loaded/n.total;console.log(t)}},!1),n},type:"POST",url:"/",data:{},success:function(){n("#relayajaxloading").hide();i.remove()}});n(t.reportConfig).each(function(){var n=this;n.id==e&&(s=n.frms[0].reportUrl)});n.xpreports.methods.generateReport(t.baseUrl,e,t.keyVariable,t.keyValue,c,s)}}],close:function(){f.show();o.hide();n("#"+n.xpreports.defaults.exportBtnId).show()}})}n(".ui-widget-overlay").css("z-index","999");i.css("z-index","1111")},init:function(t){return this.each(function(){var u=this,i=n(u),r;t.param1==="True"&&n.xpreports.methods.getConfig(t);t.needImage===!0?(r=n("<div title='"+t.title+"'/>").addClass(t.iconUrl).appendTo(i),r.click(function(){n.xpreports.methods.prepareModal.call(i,t)})):n.xpreports.methods.prepareModal.call(i,t)})}}};n.fn.xpreports=function(t){var i,r;if(this&&this.length!=0)return i=n(this),typeof t=="object"&&(t=n.extend({},n.xpreports.defaults,t),i.notifyOpts=t,n.xpreports.methods.init.apply(this,n.makeArray(t))),n.xpreports.methods[t]?(r=i.reportsOpts,r=n.extend(r,Array.prototype.slice.call(arguments,1)),n.xpreports.methods[t].call(i,r[0])):void 0}})($);
/*
//# sourceMappingURL=xpoint.reports.min.js.map
*/