(function(n){n.xpointComments={defaults:{numberOfComments:"",inputBoxWaterMarkText:"",getCommentsUrl:"",saveCommentsUrl:"",deleteCommentsUrl:"",userPictureUrl:"",allowInput:!1,id:"",numberOfVisibleComments:0,getCommentResult:"GetPostCommentsResult",getDeleteResult:"DeletePostCommentResult",addCommentResult:"AddPostCommentResult",versionLabel:!1,scrollDiv:!1},ids:{commentMain:"xpointCommentMainDiv_",inputContainer:"xpointInputContainerDiv_",closeComment:"xpointCloseCommentDiv_",deleteComment:"xpointDeleteCommentDiv_",inputBox:"xpointInputBox_",dateDiv:"dateDiv_",timeDiv:"timeDiv_",actualTimeDiv:"actualTimeDiv_"},classes:{dateDiv:"xp-PositionAbsolute xp-Padding-4 ui-state-default xp-BoxShadow xp-DateHoverDiv  xp-DisplayNone",tourCssCommentCount:"Tip-HPMyPostsCmntCount"},methods:{ajaxCall:function(t,i){var r=this,f,u;r.length>0&&r.showLoading(i);f=t.complete&&n.isFunction(t.complete)?t.complete:null;t&&(u={type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:"",complete:function(n,t){r.hideLoading();f&&f.call(r,n,t)}},u=n.extend(u,t),n.ajax(u))},initializeJScroll:function(t){var i=n("#"+t.commentsMainDiv);n.xpointComments.defaults.numberOfVisibleComments>=3&&(i.addClass("xp-CommentScroll"),i.jScrollPane({verticalDragMinHeight:"60",autoReinitialise:!0}).data("jsp").scrollToBottom())},removeJScroll:function(t){var i=n("#"+t.commentsMainDiv),r,u;i.removeClass("xp-CommentScroll");r=i.jScrollPane({});u=r.data("jsp");u.destroy()},addComment:function(t,i,r){var h=new Date(parseInt(i.CreatedDate.substr(6))),f=n("<div id='"+i.Id+"' class='xp-FloatLeft  xp-Width xp-BottomBorder xp-NoBackground ui-state-default'><\/div>").appendTo(t),e=n("<div class='xp-FloatLeft xp-Width99 xp-PositionRelative xp-Padding-4'><\/div>").appendTo(f),o,c,l,a,v,u,s;e.append("<div class='xp-FloatLeft xp-PaddingRight-5 xp-SmallProfilePic'><img src='"+i.CreatedBy.PictureUrl+"' /><\/div>");o=n("<div class='xp-FloatLeft xp-Width85'><\/div>").appendTo(e);c=n("<div class='xp-FloatLeft xp-Width'><\/div>").appendTo(o);c.append("<div class='xp-FloatLeft xp-Width xp-CommentHeight  xp-TxtDescription xp-Breakword'><a href='"+i.CreatedBy.ProfileUrl+"' class='xp-LinkLabel'>"+i.CreatedBy.DisplayName+"<\/a>"+(!r.isLabel?"":"<span> (Version "+i.VersionLabel.slice(0,i.VersionLabel.indexOf("."))+")<\/span>")+" : "+i.Comment+"<\/div>");l=n("<div class='xp-FloatLeft xp-VerticalAlignBottom' id='"+n.xpointComments.ids.timeDiv+i.Id+"'><\/div>").appendTo(o);l.append("<div class='xp-IconTimestamp xp-Icon xp-FloatLeft  xp-PaddingRight-3'><\/div><div class='xp-FontLite xp-VerticalAlignTop  xp-FloatLeft' style='line-height:11px;'><div class='xp-FloatLeft xp-TimeStampDiv xp-PositionRelative xp-Padding-2 xp-Width' id='"+n.xpointComments.ids.actualTimeDiv+i.Id+"'> "+n.timeago(h)+"<\/div><\/div>");try{a=n.xpoint.utils.formatDate(h)}catch(y){}v=n("<div/>").attr("class",n.xpointComments.classes.dateDiv).attr("id",n.xpointComments.ids.dateDiv+i.Id).append(a).appendTo(n("#"+n.xpointComments.ids.actualTimeDiv+i.Id));n("#"+n.xpointComments.ids.timeDiv+i.Id).hover(function(){n("#"+n.xpointComments.ids.dateDiv+i.Id).show()},function(){n("#"+n.xpointComments.ids.dateDiv+i.Id).hide()});u=n("<div id='"+n.xpointComments.ids.deleteComment+i.Id+"'class='xp-IconDeleteComment xp-MarginLeft-5 xp-HoverCursor xp-Icon xp-FloatLeft xp-PositionRelative'><\/div>");s=n("<div class='xp-PositionAbsolute ui-secondarytabclr xp-NoBackground xp-BoxShadow ui-corner-all xp-DisplayNone xp-DeleteCmnt xp-PositionAbsolute xp-Padding-4'><span class='xp-HoverCursor xp-FontBold'>Delete Comment<\/span><\/div>").appendTo(u);i.IsDeleteAllowed&&e.append(u);u.click(function(){s.toggle()});s.click(function(){var t={url:r.deleteCommentsUrl,type:"POST",data:'{ "commentId": '+i.Id+"}",dataType:"json",contentType:"application/json; charset=utf-8",success:function(t){var e,i,u;t&&(e=t[n.xpointComments.defaults.getDeleteResult],e.Status=="success"&&(f.remove(),i=n("#"+r.commentCountId),u=parseInt(i.text())-1,i.text(u),u==0&&(n("#"+r.commentCountDiv).toggle(),n("#"+r.viewComment).toggle(),i.removeClass(n.xpointComments.classes.tourCssCommentCount)),n.xpointComments.defaults.numberOfVisibleComments--,u<=3&&n.xpointComments.methods.removeJScroll(r)))}};n.xpointComments.methods.ajaxCall.call(f,t)})},addInputContainer:function(t){var u=n("#"+t.inputComment).show(),i,f,r;n("#"+t.commentsMainDiv).show();i=n("#"+n.xpointComments.ids.inputContainer+t.id);i.length>0&&(i.children().remove(),i.remove());i=n("<div id='"+n.xpointComments.ids.inputContainer+t.id+"' class='xp-FloatLeft xp-Width xp-NoBackground xp-Height-60 xp-BottomBorder ui-state-default'><\/div>").appendTo(u);i.append("<div class='xp-FloatLeft xp-Padding-4 xp-SmallProfilePic '><img  src='"+t.userPictureUrl+"' /><\/div>");f=n("<div class='xp-FloatLeft xp-Width85 xp-CommentTxtBox'><\/div>").appendTo(i);r=n("<input size='100%' autocomplete='off'  id='"+n.xpointComments.ids.inputBox+t.id+"' type='text' />").appendTo(f).keypress(function(i){var s=i.keyCode?i.keyCode:i.which,f,e,r,o;if(s==13)return f=n(this),e=f.val(),e.trim()!=""?(r={},r.comment=e,r.postId=t.id,!t.versionLabel||(r.versionLabel=t.versionLabel),f.val(""),o={url:t.saveCommentsUrl,type:"POST",data:n.toJSON(r),dataType:"json",contentType:"application/json; charset=utf-8",success:function(i){var u,f;if(i&&(u=i[n.xpointComments.defaults.addCommentResult],u)){f=n("#"+t.viewComment).show();n.xpointComments.methods.addComment(f,u,t);var o=n("#"+t.commentCountDiv),r=n("#"+t.commentCountId),s=n("#"+t.likeCommentCountMainDiv),e;r.text()==0&&(s.show(),o.show(),r.addClass(n.xpointComments.classes.tourCssCommentCount));e=parseInt(r.text());r.text(e+1);n.xpointComments.defaults.numberOfVisibleComments++;n("#"+t.commentsMainDiv).jScrollPane({verticalDragMinHeight:"60"}).data("jsp").scrollToBottom()}},error:function(){f.val(e)}},n.xpointComments.methods.ajaxCall.call(u,o),!1):!1});r.charCounter(140);r.watermark(t.inputBoxWaterMarkText)},addCommentContainer:function(t,i){var r;i=n.extend(!0,n.xpointComments.defaults,i);r=n("#"+n.xpointComments.ids.commentMain+i.id);r.length>0&&(r.children().remove(),r.remove());r=n("<div id='"+n.xpointComments.ids.commentMain+i.id+"' class='xp-FloatLeft xp-Width'><\/div>").appendTo(t);var u=n("<div id='"+i.viewComment+"' class='xp-Width xp-FloatLeft'><\/div>").appendTo(r),e=n("<div id='"+i.inputComment+"' class='xp-Width xp-FloatLeft'><\/div>").appendTo(r).hide(),f={type:"GET",dataType:"json",cache:!1,url:i.getCommentsUrl,data:{postId:i.id,numberOfComments:i.numberOfComments},success:function(r){if(r!=null){var f=r[i.getCommentResult];f&&(f.length==0?(t.hide(),u.hide(),!i.versionLabel||(n("#"+i.commentCountId).text(0),n("#"+i.commentCountDiv).hide())):!i.versionLabel||(t.show(),u.show(),n("#"+i.commentCountDiv).show(),n("#"+i.commentCountId).text(f.length)),n.xpointComments.defaults.numberOfVisibleComments=f.length,n(f).each(function(){var t=this;t&&n.xpointComments.methods.addComment(u,t,i)}),n.xpointComments.methods.initializeJScroll(i))}i.allowInput&&n.xpointComments.methods.addInputContainer(i)}};n.xpointComments.methods.ajaxCall.call(n("#"+i.likeCommentCountMainDiv),f)},init:function(t){var i=n(this);n.xpointComments.methods.addCommentContainer(elem,t)}}};n.fn.xpointComments=function(t){if(this&&this.length!==0){if("string"==typeof t&&n.xpointComments.methods[t]){var i=n.extend(this.get(0).options,n.makeArray(arguments).slice(1)[0]);return n.xpointComments.methods[t].apply(this,n.makeArray(i))}return this.each(function(){this.options=n.extend(n.xpointComments.defaults,t);n.xpointComments.methods.init.apply(this,n.makeArray(this.options))})}}})(jQuery);
/*
//# sourceMappingURL=xpoint.comments.min.js.map
*/