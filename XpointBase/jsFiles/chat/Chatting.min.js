function CheckForLogin(n){if(n==!0&&($.ajaxSetup({beforeSend:function(){return!1}}),$("#loginNeeded").length==0))var t=$("<div id='loginNeeded'/>").append("Session time out. Need to login again.").appendTo("body").dialog({closeOnEscape:!1,open:function(){$(".ui-dialog-titlebar-close").hide()},modal:!0,buttons:{"Click to login again":function(){location.reload()}}})}function StartChat(){pollPing==0&&$.ajax({type:"POST",cache:!1,url:"/_layouts/IImpact.Web/ChatService.asmx/Conversations",data:"{}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){var t=n.d;t&&(convs=t.Conversations,CheckForLogin(t.NeedLogin));conversationTimer=setTimeout("gotConvs()",3)}});pollPing++;pollPing>3&&(pollPing=0);startChatTimer=setTimeout("StartChat()",500)}function processChatBoxes(){for(x in chatBoxes)activeConvs[chatBoxes[x]]==!1&&closeChatBox(chatBoxes[x]);for(x in newMessages)newMessages[x]==!0&&(chatboxFocus[x]!=!1||firstTime||($("#chatbox_"+x+" .chatboxhead").toggleClass("chatboxblink"),isActive||(document.title=document.title==""?documenttitle:"")),firstTime&&($("#chatbox_"+x+" .chatboxhead").removeClass("chatboxblink"),newMessages[x]=!1));isActive&&document.title==""&&(document.title=documenttitle);firstTime=!1}function chatAudienceHtml(n){var t="<div class = 'xp-VerticalAlignMiddle xp-Padding-2'>";return $.each(n.split("|"),function(){var i=$(this);if(i.length>0){var n=this.split("@"),r=n[0],u=n[1];t+="<div><img src='/_layouts/Images/XPointBase/"+r+"'/>";t+="&nbsp;&nbsp;"+u+"<\/div>"}}),t+="<\/div>"}function gotConvs(){if(totalConvs==0){activeConvs=[];for(x in chatBoxes)activeConvs[chatBoxes[x]]=!1;convs!=null&&(totalConvs=convs.length,totalConvs>0?$.each(convs,function(n,t){var i=t,r;activeConvs[i]=!0;r="";$("#chatboxping_"+i).attr("lastping")&&(r=$("#chatboxping_"+i).attr("lastping"));$.ajax({type:"POST",cache:!1,url:"/_layouts/IImpact.Web/ChatService.asmx/Conversation",data:"{ 'guid':'"+i+"' , 'when':'"+r+"' }",contentType:"application/json; charset=utf-8",dataType:"json",complete:function(){totalConvs--;totalConvs==0&&processChatBoxes()},success:function(n){var t,i,e;if(con=n.d,$("#chatbox_"+con.ID).length<=0&&con.ID!=null?createChatBox(con.ID,con.roomName,con.IamInitiator,con.isPrivate):($("#chatbox_"+con.ID).css("display","block"),restructureChatBoxes()),t=$("#chatbox_"+con.ID+" .chatboxaudience"),i=t.data("audience"),i?con.audience&&i!=con.audience&&(e=chatAudienceHtml(con.audience),t.html(e),t.data("audience",con.audience)):con.audience!=null&&(t.html(chatAudienceHtml(con.audience)),t.data("audience",con.audience)),con.isPrivate=="true"&&$("#chatprivatespan_"+con.ID).val()!="(Private)"&&$("#chatprivatespan_"+con.ID).html("(Private)"),con!=null&&con.chats!=null&&con.chats.length>0){$("#chatbox_"+con.ID+" .chatboxcontent").append(con.chats);$("#chatbox_"+con.ID+" .chatboxcontent").scrollTop($("#chatbox_"+con.ID+" .chatboxcontent")[0].scrollHeight);var r=con.lastPing.split(" "),u=r[0].split("/"),f=r[1].split(":"),o=new Date(u[2],u[0]-1,u[1],f[0],f[1],f[2]);$("#chatboxping_"+con.ID).attr("lastping",con.lastPing).html(o.format("mmm dd, yyyy h:MM")).append(r[2]);chatboxFocus[con.ID]==!1&&(newMessages[con.ID]=!0)}}})}):processChatBoxes())}}function GetWidth(){var n=0;return self.innerHeight?n=self.innerWidth:document.documentElement&&document.documentElement.clientHeight?n=document.documentElement.clientWidth:document.body&&(n=document.body.clientWidth),n}function GetHeight(){var n=0;return self.innerHeight?n=self.innerHeight:document.documentElement&&document.documentElement.clientHeight?n=document.documentElement.clientHeight:document.body&&(n=document.body.clientHeight),n}function restructureChatBoxes(){align=0;offset=0;rowMinimized=1;height=GetHeight()-320;for(x in chatBoxes)chatboxguid=chatBoxes[x],$("#chatbox_"+chatboxguid).css("display")!="none"&&($("#chatbox_"+chatboxguid+" .chatboxinput").css("display")=="none"?(align==0?($("#chatbox_"+chatboxguid).css("right","20px"),$("#chatbox_"+chatboxguid).css("top",height-offset+280+"px")):(width=align*232+20,$("#chatbox_"+chatboxguid).css("right",width+"px"),$("#chatbox_"+chatboxguid).css("top",height-offset+280+"px")),$("#chatbox_"+chatboxguid).css("bottom",offset+"px")):(rowMinimized=0,align==0?($("#chatbox_"+chatboxguid).css("right","20px"),$("#chatbox_"+chatboxguid).css("top",height-offset+"px")):(width=align*232+20,$("#chatbox_"+chatboxguid).css("right",width+"px"),$("#chatbox_"+chatboxguid).css("top",height-offset+"px")),$("#chatbox_"+chatboxguid).css("bottom",offset+"px")),align++,(align+1)*232+20>GetWidth()-200&&(align=0,offset=rowMinimized==1?offset+350-280:offset+350,rowMinimized=1))}function createChatBox(n,t,i,r){if($("#chatbox_"+n).length>0){$("#chatbox_"+n).css("display")=="none"&&($("#chatbox_"+n).css("display","block"),restructureChatBoxes());$("#chatbox_"+n+" .chatboxtextarea").focus();return}var f=$.cookie("chatbox_minimized"),u="block";f&&$.each(f.split("|"),function(){var t=this;t==n&&(u="none")});$(" <div />").attr("id","chatbox_"+n).addClass("chatbox xp-OuterPanel").html('<div class="chatboxhead"><div id="chattitle_'+n+'" class="chatboxtitle xp-ChattingPadding">'+t+'<span id="chatprivatespan_'+n+'" class="chatboxprivate"><\/span><\/div><div class="chatboxoptions" id="chatoptions_'+n+'"><div class = "xp-FloatLeft xp-ChattingPadding"><a href="javascript:void(0)" onclick="javascript:invite(event,\''+n+'\')"  title="Invite" id="inv_'+n+'"><img border="0" src="/_layouts/Images/XpointBase/Chat_invite.png" alt="Invite"/><\/a><\/div><div class = "xp-FloatLeft xp-ChattingPadding"><span class="xp-ChatMinimize" id="mini_'+n+'">&nbsp;&nbsp;&nbsp;&nbsp;<\/span><\/div><div  class = "xp-FloatLeft xp-ChattingPadding"><a href="javascript:void(0)" onclick="javascript:closeChatBox(\''+n+'\')" title="Close"  id="close_'+n+'"><img border="0" src="/_layouts/Images/XpointBase/Chat_close.png" alt="close" /><\/a><\/div><\/div><br clear="all"/><\/div><div class="chatboxaudience"><\/div><div class="chatboxcontent"><\/div><div class="chatboxlastmessage">Last message: <span id="chatboxping_'+n+'"><\/span><\/div><div id="chatboxinput_'+n+'" class="chatboxinput"><textarea id="textarea_'+n+'"onkeydown="javascript:return checkChatBoxInputKey(event,this,\''+n+'\');" class="chatboxtextarea" ><\/textarea><span id="chatemoticon_'+n+'"><a href="javascript:void(0)" onclick="javascript:emoticonPicker(event, \''+n+'\');" title="Insert Emoticons"  id="Emoticons_'+n+'"><img border="0" src="/_Layouts/Images/XPointBase/ChatEmoticons/Happy/00000001.gif" alt="Emoticons" ><\/a><\/span><\/div>').appendTo($("body"));$("#chatbox_"+n+" .chatboxcontent").css("display",u);$("#chatbox_"+n+" .chatboxinput").css("display",u);$("#chatbox_"+n+" .chatboxlastmessage").css("display",u);$("#chatbox_"+n+" .chatboxaudience").css("display",u);$("#textarea_"+n).keydown(function(t){checkChatBoxInputKey(t,this,n)});$("#mini_"+n).click(function(){toggleChatBoxGrowth(n)});$("#close_"+n).click(function(){closeChatBox(n)});$("#inv_"+n).click(function(){invite(n)});$("#chatbox_"+n).css("bottom","0px");$("#Emoticons_"+n).click(function(){emoticonPicker(event,n)});i=="true"&&r=="false"&&($("#chatoptions_"+n).prepend('<div class = "xp-FloatLeft xp-ChattingPadding"><a href="javascript:void(0)" onclick="javascript:makePrivate(\''+n+'\')"  title="Private" id="private_'+n+'"><img border="0" src="/_layouts/Images/XpointBase/Chat_private.png" alt="private"/><\/a><\/div>'),$("#private_"+n).click(function(){makePrivate(n)}));chatBoxeslength=0;for(x in chatBoxes)$("#chatbox_"+chatBoxes[x]).css("display")!="none"&&chatBoxeslength++;chatBoxeslength==0?$("#chatbox_"+n).css("right","20px"):(width=chatBoxeslength*232+20,$("#chatbox_"+n).css("right",width+"px"));chatBoxes.push(n);chatboxFocus[n]=!1;$("#chatbox_"+n+" .chatboxtextarea").blur(function(){chatboxFocus[n]=!1;$("#chatbox_"+n+" .chatboxtextarea").removeClass("chatboxtextareaselected")}).focus(function(){chatboxFocus[n]=!0;newMessages[n]=!1;$("#chatbox_"+n+" .chatboxhead").removeClass("chatboxblink");$("#chatbox_"+n+" .chatboxtextarea").addClass("chatboxtextareaselected")});$("#chatbox_"+n).click(function(){$("#chatbox_"+n+" .chatboxcontent").css("display")!="none"&&$("#chatbox_"+n+" .chatboxtextarea").focus()});$("#chatbox_"+n).show();restructureChatBoxes()}function makePrivate(n){$.post("/_layouts/IImpact.Web/ChatService.asmx/MakePrivate",{guid:n},function(){},"json");$("#private_"+n).is(":visible")&&($("#private_"+n).hide(),$("#chatprivatespan_"+n).html("(Private)"))}function emoticonPicker(n,t){var f,e,u,r,o,i;if(n||(n=window.event),f=0,e=0,n.pageX||n.pageY?(f=n.pageX,e=n.pageY):(n.clientX||n.clientY)&&(f=n.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e=n.clientY+document.body.scrollTop+document.documentElement.scrollTop),posX=f-230,posY=e-150,box!=null&&(box.unload(),box=null),embox==null){embox=new Boxy('<input type="hidden" id="emoticonGUID"/><table id=emtable style=font-size:3px><\/table>',{title:"Emoticons"});o=["Happy","Rage","SadConfused","Mood"];for(x in o){for(i=o[x],u="",r=1;r<7;r++)u+='<td><a href="javascript:void(0)" onclick="javascript:emoticonInsert(\''+i+"','"+r+'\')" title="Insert"  id="Emoticons_'+i+r+'"><img border="0" src="_layouts/Images/XPointBase/ChatEmoticons/'+i+"/0000000"+r+'.gif" alt="Emoticon" ><\/a><\/td>';u="<tr>"+u+"<\/tr>";$("#emtable").append(u);$("#Emoticons_"+i+"1").click(function(){emoticonInsert(i,1)});$("#Emoticons_"+i+"2").click(function(){emoticonInsert(i,2)});$("#Emoticons_"+i+"3").click(function(){emoticonInsert(i,3)});$("#Emoticons_"+i+"4").click(function(){emoticonInsert(i,4)});$("#Emoticons_"+i+"5").click(function(){emoticonInsert(i,5)});$("#Emoticons_"+i+"6").click(function(){emoticonInsert(i,6)});$("#Emoticons_"+i+"7").click(function(){emoticonInsert(i,7)});$("#Emoticons_"+i+"8").click(function(){emoticonInsert(i,8)});$("#Emoticons_"+i+"9").click(function(){emoticonInsert(i,9)})}}updateEmbox(t)}function emoticonInsert(n,t){var i;embox!=null&&(i=$("#emoticonGUID").val(),$("#textarea_"+i).val($("#textarea_"+i).val()+":"+n.toString().toLowerCase()+"0"+t),$("#chatbox_"+i+" .chatboxtextarea").focus(),embox.unload(),embox=null)}function inviteClicked(){var n,t,i;return box!=null&&(n=$("#picker").val(),t=$("#picker").validatepp({loginname:n})[0].validate,t&&(i=$("#guidCache").val(),$.post("/_layouts/IImpact.Web/ChatService.asmx/InviteUser",{guid:i,user:n},function(){}),box.unload(),box=null,ppAttached=!1,$("#picker").trigger("resetpp"))),!1}function invite(n,t){var i=0,r=0,u;n||(n=window.event);n.pageX||n.pageY?(i=n.pageX,r=n.pageY):(n.clientX||n.clientY)&&(i=n.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,r=n.clientY+document.body.scrollTop+document.documentElement.scrollTop);posX=i-180;posY=r;embox!=null&&(embox.unload(),embox=null);box==null?$.ajax({type:"POST",cache:!1,url:"/_layouts/IImpact.Web/ChatService.asmx/GetPeoplePicker",data:"{}",contentType:"application/json; charset=utf-8",async:!1,dataType:"json",success:function(n){n!=null&&(u=n.d,box=new Boxy(u,{title:"Invite to chat"}))}}):$("#picker").trigger("resetpp");UpdateBoxy(t)}function updateEmbox(n){embox.moveTo(posX,posY);embox.show();$("#emoticonGUID").val(n)}function UpdateBoxy(n){n!=null&&(box.moveTo(posX,posY),box.show(),$("#guidCache").val(n),$("#inviteButton").click(inviteClicked),ppAttached==!1&&($("#picker").peoplepicker({hoverprofile:!1,width:200,searchurl:"/_layouts/IImpact.Web/ChatService.asmx/SearchUsers"}),ppAttached=!0))}function removeArrItems(n,t){var i,r;if(null!=t)for(/Array/.test(t.constructor)||(t=[t]),r=0;r<t.length;r++)for(i=0;i<n.length;)n[i]==t[r]?n.splice(i,1):i++}function closeChatBox(n){$("#chatbox_"+n).css("display")!="none"&&($("#chatbox_"+n).css("display","none"),restructureChatBoxes(),$.post("/_layouts/IImpact.Web/ChatService.asmx/CloseConversation",{guid:n},function(){$("#chatbox_"+n)&&$("#chatbox_"+n).remove();removeArrItems(chatBoxes,n)},"json"),box!=null&&($("#guidCache").val()==n&&(box.unload(),box=null),$("#emoticonGUID").val()==n&&embox.hide()))}function toggleChatBoxGrowth(n){var r,t;if($("#mini_"+n).toggleClass("xp-ChatMinimize"),$("#mini_"+n).toggleClass("xp-ChatMaximize"),$("#chatbox_"+n+" .chatboxcontent").css("display")=="none"){for(r=[],$.cookie("chatbox_minimized")&&(r=$.cookie("chatbox_minimized").split(/\|/)),t="",i=0;i<r.length;i++)r[i]!=n&&(t+=n+"|");t=t.slice(0,-1);$.cookie("chatbox_minimized",t);$("#chatbox_"+n+" .chatboxcontent").css("display","block");$("#chatbox_"+n+" .chatboxinput").css("display","block");$("#chatbox_"+n+" .chatboxaudience").css("display","block");$("#chatbox_"+n+" .chatboxlastmessage").css("display","block");$("#chatbox_"+n+" .chatboxcontent").scrollTop($("#chatbox_"+n+" .chatboxcontent")[0].scrollHeight)}else t=n,$.cookie("chatbox_minimized")&&(t+="|"+$.cookie("chatbox_minimized")),$.cookie("chatbox_minimized",t),$("#chatbox_"+n+" .chatboxcontent").css("display","none"),$("#chatbox_"+n+" .chatboxinput").css("display","none"),$("#chatbox_"+n+" .chatboxlastmessage").css("display","none"),$("#chatbox_"+n+" .chatboxaudience").css("display","none"),box!=null&&$("#guidCache").val()==n&&(box.unload(),box=null);restructureChatBoxes()}function checkChatBoxInputKey(n,t,i){if(n||(n=window.event),n.keyCode==13&&n.shiftKey==0)return message=$(t).val(),message=message.replace(/^\s+|\s+$/g,""),$(t).val(""),$(t).focus(),$(t).css("height","35px"),message!=""&&$.post("/_layouts/IImpact.Web/ChatService.asmx/AddChat",{guid:i,chatText:message},function(){message=message.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;")},"json"),!1;var r=t.clientHeight,u=35;u>r?(r=Math.max(t.scrollHeight,r),u&&(r=Math.min(u,r)),r>t.clientHeight&&$(t).css("height",r+8+"px")):$(t).css("overflow","auto")}function startChatSession(n,t){$.ajax({type:"POST",cache:!1,url:"/_layouts/IImpact.Web/ChatService.asmx/StartNewChat",data:"users="+n+"&roomName="+t,beforeSend:function(i){i.setRequestHeader("Content-Length","users="+n+"&roomName="+t.length)},dataType:"json",ContentType:"application/json; charset=utf-8",complete:function(n){n.status==200||alert(n.responseText)}})}var windowFocus=!0,username,ppAttached=!1,chatboxFocus=[],newMessages=[],chatBoxes=[],convs=null,con=null,pollPing=0,box=null,embox=null,firstTime=!0,totalConvs=0,activeConvs,step=0,documenttitle=document.title,startChatTimer,conversationTimer,isActive;window.onfocus=function(){isActive=!0};window.onblur=function(){isActive=!1};jQuery.cookie=function(n,t,i){var f,r,e,o,u,s;if(typeof t!="undefined"){i=i||{};t===null&&(t="",i.expires=-1);f="";i.expires&&(typeof i.expires=="number"||i.expires.toUTCString)&&(typeof i.expires=="number"?(r=new Date,r.setTime(r.getTime()+i.expires*864e5)):r=i.expires,f="; expires="+r.toUTCString());var h=i.path?"; path="+i.path:"",c=i.domain?"; domain="+i.domain:"",l=i.secure?"; secure":"";document.cookie=[n,"=",encodeURIComponent(t),f,h,c,l].join("")}else{if(e=null,document.cookie&&document.cookie!="")for(o=document.cookie.split(";"),u=0;u<o.length;u++)if(s=jQuery.trim(o[u]),s.substring(0,n.length+1)==n+"="){e=decodeURIComponent(s.substring(n.length+1));break}return e}};
/*
//# sourceMappingURL=Chatting.min.js.map
*/