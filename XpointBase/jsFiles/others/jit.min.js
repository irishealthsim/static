(function(){function n(){}function f(n,t){for(var i in t||{})n[i]=t[i];return n}function p(n){return typeof n=="function"?n:function(){return n}}function o(n){var t=u(n);return t?t!="array"?[n]:n:[]}function r(n,t){var f=u(n),r,i;if(f=="object")for(r in n)t(n[r],r);else for(i=0;i<n.length;i++)t(n[i],i)}function t(){for(var n,i,r,f,e={},o=0,s=arguments.length;o<s;o++)if(n=arguments[o],u(n)=="object")for(i in n)r=n[i],f=e[i],e[i]=f&&u(r)=="object"&&u(f)=="object"?t(f,r):w(r);return e}function w(n){var t,r,i,f;switch(u(n)){case"object":t={};for(r in n)t[r]=w(n[r]);break;case"array":for(t=[],i=0,f=n.length;i<f;i++)t[i]=w(n[i]);break;default:return n}return t}function nt(n,t){var i,r,u;if(n.length<3)return null;if(n.length==4&&n[3]==0&&!t)return"transparent";for(i=[],r=0;r<3;r++)u=(n[r]-0).toString(16),i.push(u.length==1?"0"+u:u);return t?i:"#"+i.join("")}function tt(n){k(n);n.parentNode&&n.parentNode.removeChild(n);n.clearAttributes&&n.clearAttributes()}function k(n){for(var i=n.childNodes,t=0;t<i.length;t++)tt(i[t])}function l(n,t,i){n.addEventListener?n.addEventListener(t,i,!1):n.attachEvent("on"+t,i)}function d(n,t){return(" "+n.className+" ").indexOf(" "+t+" ")>-1}function a(n,t){d(n,t)||(n.className=n.className+" "+t)}function v(n,t){n.className=n.className.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)"),"$1")}function s(n){return document.getElementById(n)}var g=Date.now||function(){return+new Date},u=function(n){return u.s.call(n).match(/^\[object\s(.*)\]$/)[1].toLowerCase()},i,e,h,y,c,b;u.s=Object.prototype.toString;i=function(n){var t,r;n=n||{};t=function(){if(this.constructor=t,i.prototyping)return this;return this.initialize?this.initialize.apply(this,arguments):this};for(r in i.Mutators)n[r]&&(n=i.Mutators[r](n,n[r]),delete n[r]);return f(t,this),t.constructor=i,t.prototype=n,t};i.Mutators={Extends:function(n,t){i.prototyping=t.prototype;var r=new t;return delete r.parent,r=i.inherit(r,n),delete i.prototyping,r},Implements:function(n,t){return r(o(t),function(t){i.prototying=t;f(n,u(t)=="function"?new t:t);delete i.prototyping}),n}};f(i,{inherit:function(n,r){var s=arguments.callee.caller;for(var e in r){var f=r[e],o=n[e],h=u(f);o&&h=="function"?f!=o&&(s?(f.__parent=o,n[e]=f):i.override(n,e,f)):n[e]=h=="object"?t(o,f):f}return s&&(n.parent=function(){return arguments.callee.caller.__parent.apply(this,arguments)}),n},override:function(n,t,r){var u=i.prototyping,f;u&&n[t]!=u[t]&&(u=null);f=function(){var f=this.parent,i;return this.parent=u?u[t]:n[t],i=r.apply(this,arguments),this.parent=f,i};n[t]=f}});i.prototype.implement=function(){var n=this.prototype;return r(Array.prototype.slice.call(arguments||[]),function(t){i.inherit(n,t)}),this};this.TreeUtil={prune:function(n,t){this.each(n,function(n,i){i==t&&n.children&&(delete n.children,n.children=[])})},getParent:function(n,t){var i,r,u;if(n.id==t)return!1;if(i=n.children,i&&i.length>0)for(r=0;r<i.length;r++){if(i[r].id==t)return n;if(u=this.getParent(i[r],t),u)return u}return!1},getSubtree:function(n,t){var i,r,u;if(n.id==t)return n;for(i=0,r=n.children;i<r.length;i++)if(u=this.getSubtree(r[i],t),u!=null)return u;return null},getLeaves:function(n,t){var i=[],r=t||Number.MAX_VALUE;return this.each(n,function(n,t){t<r&&(!n.children||n.children.length==0)&&i.push({node:n,level:r-t})}),i},eachLevel:function(n,t,i,r){if(t<=i){r(n,t);for(var u=0,f=n.children;u<f.length;u++)this.eachLevel(f[u],t+1,i,r)}},each:function(n,t){this.eachLevel(n,0,Number.MAX_VALUE,t)},loadSubtrees:function(n,t){var h=t.request&&t.levelsToShow,e=this.getLeaves(n,h),u=e.length,o={},i,s,r,f;for(u==0&&t.onComplete(),i=0,s=0;i<u;i++)r=e[i],f=r.node.id,o[f]=r.node,t.request(f,r.level,{onComplete:function(n,i){var r=i.children;o[n].children=r;++s==u&&t.onComplete()}})}};this.Canvas=function(){function n(){return n.t=n.t||typeof HTMLCanvasElement,"function"==n.t||"object"==n.t}function r(t,i,r){var u=document.createElement(t);return function(n,t){if(t)for(var i in t)n[i]=t[i];return arguments.callee}(u,i)(u.style,r),t=="canvas"&&!n()&&G_vmlCanvasManager&&(u=G_vmlCanvasManager.initElement(document.body.appendChild(u))),u}function f(n){return document.getElementById(n)}function i(n,t,i,r){var u=i?n.width-i:n.width,f=r?n.height-r:n.height;t.translate(u/2,f/2)}var u={injectInto:"id",width:200,height:200,backgroundColor:"#333333",styles:{fillStyle:"#000000",strokeStyle:"#000000"},backgroundCanvas:!1};return function(e,o){var s,a,y,k,h,c,v,b,l,p,w;if(arguments.length<1)throw"Arguments missing";var d=e+"-label",g=e+"-canvas",nt=e+"-bkcanvas";o=t(u,o||{});v={width:o.width,height:o.height};y=r("div",{id:e},t(v,{position:"relative"}));k=r("div",{id:d},{overflow:"visible",position:"absolute",top:0,left:0,width:v.width+"px",height:0});b={position:"absolute",top:0,left:0,width:v.width+"px",height:v.height+"px"};h=r("canvas",t({id:g},v),b);l=o.backgroundCanvas;l&&(c=r("canvas",t({id:nt},v),b),y.appendChild(c));y.appendChild(h);y.appendChild(k);f(o.injectInto).appendChild(y);s=h.getContext("2d");i(h,s);p=o.styles;for(w in p)s[w]=p[w];if(l){a=c.getContext("2d");p=l.styles;for(w in p)a[w]=p[w];i(c,a);l.impl.init(c,a);l.impl.plot(c,a)}return{id:e,getCtx:function(){return s},getElement:function(){return y},resize:function(t,r){var e=h.width,v=h.height,u,f;h.width=t;h.height=r;h.style.width=t+"px";h.style.height=r+"px";l&&(c.width=t,c.height=r,c.style.width=t+"px",c.style.height=r+"px");n()?i(h,s):i(h,s,e,v);u=o.styles;for(f in u)s[f]=u[f];if(l){u=l.styles;for(f in u)a[f]=u[f];n()?i(c,a):i(c,a,e,v);l.impl.init(c,a);l.impl.plot(c,a)}},getSize:function(){return{width:h.width,height:h.height}},path:function(n,t){s.beginPath();t(s);s[n]();s.closePath()},clear:function(){var n=this.getSize();s.clearRect(-n.width/2,-n.height/2,n.width,n.height)},clearRectangle:function(t,i,r,u){if(n())s.clearRect(u,t,Math.abs(i-u),Math.abs(r-t));else{var f=s.fillStyle;s.fillStyle=o.backgroundColor;s.fillRect(u,t,Math.abs(i-u),Math.abs(r-t));s.fillStyle=f}}}}}();this.Polar=function(n,t){this.theta=n;this.rho=t};Polar.prototype={getc:function(n){return this.toComplex(n)},getp:function(){return this},set:function(n){n=n.getp();this.theta=n.theta;this.rho=n.rho},setc:function(n,t){this.rho=Math.sqrt(n*n+t*t);this.theta=Math.atan2(t,n);this.theta<0&&(this.theta+=Math.PI*2)},setp:function(n,t){this.theta=n;this.rho=t},clone:function(){return new Polar(this.theta,this.rho)},toComplex:function(n){var t=Math.cos(this.theta)*this.rho,i=Math.sin(this.theta)*this.rho;return n?{x:t,y:i}:new Complex(t,i)},add:function(n){return new Polar(this.theta+n.theta,this.rho+n.rho)},scale:function(n){return new Polar(this.theta,this.rho*n)},equals:function(n){return this.theta==n.theta&&this.rho==n.rho},$add:function(n){return this.theta=this.theta+n.theta,this.rho+=n.rho,this},$madd:function(n){return this.theta=(this.theta+n.theta)%(Math.PI*2),this.rho+=n.rho,this},$scale:function(n){return this.rho*=n,this},interpolate:function(n,t){var e=Math.PI,r=e*2,f=function(n){return n<0?n%r+r:n%r},u=this.theta,i=n.theta,o,s;return o=Math.abs(u-i)>e?u>i?f(i+(u-r-i)*t):f(i-r+(u-(i-r))*t):f(i+(u-i)*t),s=(this.rho-n.rho)*t+n.rho,{theta:o,rho:s}}};e=function(n,t){return new Polar(n,t)};Polar.KER=e(0,0);this.Complex=function(n,t){this.x=n;this.y=t};Complex.prototype={getc:function(){return this},getp:function(n){return this.toPolar(n)},set:function(n){n=n.getc(!0);this.x=n.x;this.y=n.y},setc:function(n,t){this.x=n;this.y=t},setp:function(n,t){this.x=Math.cos(n)*t;this.y=Math.sin(n)*t},clone:function(){return new Complex(this.x,this.y)},toPolar:function(n){var i=this.norm(),t=Math.atan2(this.y,this.x);return(t<0&&(t+=Math.PI*2),n)?{theta:t,rho:i}:new Polar(t,i)},norm:function(){return Math.sqrt(this.squaredNorm())},squaredNorm:function(){return this.x*this.x+this.y*this.y},add:function(n){return new Complex(this.x+n.x,this.y+n.y)},prod:function(n){return new Complex(this.x*n.x-this.y*n.y,this.y*n.x+this.x*n.y)},conjugate:function(){return new Complex(this.x,-this.y)},scale:function(n){return new Complex(this.x*n,this.y*n)},equals:function(n){return this.x==n.x&&this.y==n.y},$add:function(n){return this.x+=n.x,this.y+=n.y,this},$prod:function(n){var t=this.x,i=this.y;return this.x=t*n.x-i*n.y,this.y=i*n.x+t*n.y,this},$conjugate:function(){return this.y=-this.y,this},$scale:function(n){return this.x*=n,this.y*=n,this},$div:function(n){var t=this.x,i=this.y,r=n.squaredNorm();return this.x=t*n.x+i*n.y,this.y=i*n.x-t*n.y,this.$scale(1/r)}};h=function(n,t){return new Complex(n,t)};Complex.KER=h(0,0);this.Graph=new i({initialize:function(n){this.opt=t({complex:!1,Node:{}},n||{});this.nodes={}},getNode:function(n){return this.hasNode(n)?this.nodes[n]:!1},getAdjacence:function(n,t){var i=[];return this.hasNode(n)&&this.hasNode(t)&&this.nodes[n].adjacentTo({id:t})&&this.nodes[t].adjacentTo({id:n})?(i.push(this.nodes[n].getAdjacency(t)),i.push(this.nodes[t].getAdjacency(n)),i):!1},addNode:function(n){return this.nodes[n.id]||(this.nodes[n.id]=new Graph.Node(f({id:n.id,name:n.name,data:n.data},this.opt.Node),this.opt.complex)),this.nodes[n.id]},addAdjacence:function(n,t,i){var u=[],r;this.hasNode(n.id)||this.addNode(n);this.hasNode(t.id)||this.addNode(t);n=this.nodes[n.id];t=this.nodes[t.id];for(r in this.nodes)this.nodes[r].id==n.id&&(this.nodes[r].adjacentTo(t)||u.push(this.nodes[r].addAdjacency(t,i))),this.nodes[r].id==t.id&&(this.nodes[r].adjacentTo(n)||u.push(this.nodes[r].addAdjacency(n,i)));return u},removeNode:function(n){var t,i;if(this.hasNode(n)){t=this.nodes[n];for(in t.adjacencies)i=t.adjacencies[0],this.removeAdjacence(n,i.nodeTo.id);delete this.nodes[n]}},removeAdjacence:function(n,t){this.hasNode(n)&&this.nodes[n].removeAdjacency(t);this.hasNode(t)&&this.nodes[t].removeAdjacency(n)},hasNode:function(n){return n in this.nodes}});Graph.Node=new i({initialize:function(n,t){var i={id:"",name:"",data:{},adjacencies:{},selected:!1,drawn:!1,exist:!1,angleSpan:{begin:0,end:0},alpha:1,startAlpha:1,endAlpha:1,pos:t&&h(0,0)||e(0,0),startPos:t&&h(0,0)||e(0,0),endPos:t&&h(0,0)||e(0,0)};f(this,f(i,n))},adjacentTo:function(n){return n.id in this.adjacencies},getAdjacency:function(n){return this.adjacencies[n]},addAdjacency:function(n,t){var i=new Graph.Adjacence(this,n,t);return this.adjacencies[n.id]=i},removeAdjacency:function(n){delete this.adjacencies[n]}});Graph.Adjacence=function(n,t,i){this.nodeFrom=n;this.nodeTo=t;this.data=i||{};this.alpha=1;this.startAlpha=1;this.endAlpha=1};Graph.Util={filter:function(n){if(!n||!(u(n)=="string"))return function(){return!0};var t=n.split(" ");return function(n){for(var i=0;i<t.length;i++)if(n[t[i]])return!1;return!0}},getNode:function(n,t){return n.getNode(t)},eachNode:function(n,t,i){var u=this.filter(i);for(var r in n.nodes)u(n.nodes[r])&&t(n.nodes[r])},eachAdjacency:function(n,t,i){var r=n.adjacencies,f=this.filter(i);for(var u in r)f(r[u])&&t(r[u],u)},computeLevels:function(n,t,i,r){var o,e,u,f;for(i=i||0,o=this.filter(r),this.eachNode(n,function(n){n._flag=!1;n._depth=-1},r),e=n.getNode(t),e._depth=i,u=[e];u.length!=0;)f=u.pop(),f._flag=!0,this.eachAdjacency(f,function(n){var t=n.nodeTo;t._flag==!1&&o(t)&&(t._depth<0&&(t._depth=f._depth+1+i),u.unshift(t))},r)},eachBFS:function(n,t,i,r){var e=this.filter(r),f,u;for(this.clean(n),f=[n.getNode(t)];f.length!=0;)u=f.pop(),u._flag=!0,i(u,u._depth),this.eachAdjacency(u,function(n){var t=n.nodeTo;t._flag==!1&&e(t)&&(t._flag=!0,f.unshift(t))},r)},eachLevel:function(n,t,i,r,u){var f=n._depth,e=this.filter(u),o=this;i=i===!1?Number.MAX_VALUE-f:i,function s(n,t,i){var u=n._depth;u>=t&&u<=i&&e(n)&&r(n,u);u<i&&o.eachAdjacency(n,function(n){var r=n.nodeTo;r._depth>u&&s(r,t,i)})}(n,t+f,i+f)},eachSubgraph:function(n,t,i){this.eachLevel(n,0,!1,t,i)},eachSubnode:function(n,t,i){this.eachLevel(n,1,1,t,i)},anySubnode:function(n,t,i){var r=!1,f;return t=t||p(!0),f=u(t)=="string"?function(n){return n[t]}:t,this.eachSubnode(n,function(n){f(n)&&(r=!0)},i),r},getSubnodes:function(n,t,i){var e=[],o=this,r,f;return t=t||0,u(t)=="array"?(r=t[0],f=t[1]):(r=t,f=Number.MAX_VALUE-n._depth),this.eachLevel(n,r,f,function(n){e.push(n)},i),e},getParents:function(n){var t=[];return this.eachAdjacency(n,function(i){var r=i.nodeTo;r._depth<n._depth&&t.push(r)}),t},isDescendantOf:function(n,t){var u,i,r;if(n.id==t)return!0;for(u=this.getParents(n),i=!1,r=0;!i&&r<u.length;r++)i=i||this.isDescendantOf(u[r],t);return i},clean:function(n){this.eachNode(n,function(n){n._flag=!1})}};Graph.Op={options:{type:"nothing",duration:2e3,hideLabels:!0,fps:30},removeNode:function(n,i){var r=this.viz,e=t(this.options,r.controller,i),u=o(n),f,s,h;switch(e.type){case"nothing":for(f=0;f<u.length;f++)r.graph.removeNode(u[f]);break;case"replot":this.removeNode(u,{type:"nothing"});r.fx.clearLabels();r.refresh(!0);break;case"fade:seq":case"fade":for(s=this,f=0;f<u.length;f++)h=r.graph.getNode(u[f]),h.endAlpha=0;r.fx.animate(t(e,{modes:["fade:nodes"],onComplete:function(){s.removeNode(u,{type:"nothing"});r.fx.clearLabels();r.reposition();r.fx.animate(t(e,{modes:["linear"]}))}}));break;case"fade:con":for(s=this,f=0;f<u.length;f++)h=r.graph.getNode(u[f]),h.endAlpha=0,h.ignore=!0;r.reposition();r.fx.animate(t(e,{modes:["fade:nodes","linear"],onComplete:function(){s.removeNode(u,{type:"nothing"})}}));break;case"iter":s=this;r.fx.sequence({condition:function(){return u.length!=0},step:function(){s.removeNode(u.shift(),{type:"nothing"});r.fx.clearLabels()},onComplete:function(){e.onComplete()},duration:Math.ceil(e.duration/u.length)});break;default:this.doError()}},removeEdge:function(n,i){var e=this.viz,s=t(this.options,e.controller,i),r=u(n[0])=="string"?[n]:n,f,h,o;switch(s.type){case"nothing":for(f=0;f<r.length;f++)e.graph.removeAdjacence(r[f][0],r[f][1]);break;case"replot":this.removeEdge(r,{type:"nothing"});e.refresh(!0);break;case"fade:seq":case"fade":for(h=this,f=0;f<r.length;f++)o=e.graph.getAdjacence(r[f][0],r[f][1]),o&&(o[0].endAlpha=0,o[1].endAlpha=0);e.fx.animate(t(s,{modes:["fade:vertex"],onComplete:function(){h.removeEdge(r,{type:"nothing"});e.reposition();e.fx.animate(t(s,{modes:["linear"]}))}}));break;case"fade:con":for(h=this,f=0;f<r.length;f++)o=e.graph.getAdjacence(r[f][0],r[f][1]),o&&(o[0].endAlpha=0,o[0].ignore=!0,o[1].endAlpha=0,o[1].ignore=!0);e.reposition();e.fx.animate(t(s,{modes:["fade:vertex","linear"],onComplete:function(){h.removeEdge(r,{type:"nothing"})}}));break;case"iter":h=this;e.fx.sequence({condition:function(){return r.length!=0},step:function(){h.removeEdge(r.shift(),{type:"nothing"});e.fx.clearLabels()},onComplete:function(){s.onComplete()},duration:Math.ceil(s.duration/r.length)});break;default:this.doError()}},sum:function(n,i){var r=this.viz,u=t(this.options,r.controller,i),h=r.root,f,e,s,o;r.root=i.id||r.root;switch(u.type){case"nothing":e=r.construct(n);f=Graph.Util;f.eachNode(e,function(n){f.eachAdjacency(n,function(n){r.graph.addAdjacence(n.nodeFrom,n.nodeTo,n.data)})});break;case"replot":r.refresh(!0);this.sum(n,{type:"nothing"});r.refresh(!0);break;case"fade:seq":case"fade":case"fade:con":f=Graph.Util;that=this;e=r.construct(n);s=this.preprocessSum(e);o=s?["fade:nodes","fade:vertex"]:["fade:nodes"];r.reposition();u.type!="fade:con"?r.fx.animate(t(u,{modes:["linear"],onComplete:function(){r.fx.animate(t(u,{modes:o,onComplete:function(){u.onComplete()}}))}})):(f.eachNode(r.graph,function(n){n.id!=h&&n.pos.getp().equals(Polar.KER)&&(n.pos.set(n.endPos),n.startPos.set(n.endPos))}),r.fx.animate(t(u,{modes:["linear"].concat(o)})));break;default:this.doError()}},morph:function(n,i){var r=this.viz,e=t(this.options,r.controller,i),h=r.root,u,f,o,s;r.root=i.id||r.root;switch(e.type){case"nothing":f=r.construct(n);u=Graph.Util;u.eachNode(f,function(n){u.eachAdjacency(n,function(n){r.graph.addAdjacence(n.nodeFrom,n.nodeTo,n.data)})});u.eachNode(r.graph,function(n){u.eachAdjacency(n,function(n){f.getAdjacence(n.nodeFrom.id,n.nodeTo.id)||r.graph.removeAdjacence(n.nodeFrom.id,n.nodeTo.id)});f.hasNode(n.id)||r.graph.removeNode(n.id)});break;case"replot":r.fx.clearLabels(!0);this.morph(n,{type:"nothing"});r.refresh(!0);r.refresh(!0);break;case"fade:seq":case"fade":case"fade:con":u=Graph.Util;that=this;f=r.construct(n);o=this.preprocessSum(f);u.eachNode(r.graph,function(n){f.hasNode(n.id)||(n.alpha=1,n.startAlpha=1,n.endAlpha=0,n.ignore=!0)});u.eachNode(r.graph,function(n){n.ignore||u.eachAdjacency(n,function(n){var i,u,t;n.nodeFrom.ignore||n.nodeTo.ignore||(i=f.getNode(n.nodeFrom.id),u=f.getNode(n.nodeTo.id),i.adjacentTo(u)||(t=r.graph.getAdjacence(i.id,u.id),o=!0,t[0].alpha=1,t[0].startAlpha=1,t[0].endAlpha=0,t[0].ignore=!0,t[1].alpha=1,t[1].startAlpha=1,t[1].endAlpha=0,t[1].ignore=!0))})});s=o?["fade:nodes","fade:vertex"]:["fade:nodes"];r.reposition();u.eachNode(r.graph,function(n){n.id!=h&&n.pos.getp().equals(Polar.KER)&&(n.pos.set(n.endPos),n.startPos.set(n.endPos))});r.fx.animate(t(e,{modes:["polar"].concat(s),onComplete:function(){u.eachNode(r.graph,function(n){n.ignore&&r.graph.removeNode(n.id)});u.eachNode(r.graph,function(n){u.eachAdjacency(n,function(n){n.ignore&&r.graph.removeAdjacence(n.nodeFrom.id,n.nodeTo.id)})});e.onComplete()}}));break;default:this.doError()}},preprocessSum:function(n){var t=this.viz,i=Graph.Util,r;return i.eachNode(n,function(n){if(!t.graph.hasNode(n.id)){t.graph.addNode(n);var i=t.graph.getNode(n.id);i.alpha=0;i.startAlpha=0;i.endAlpha=1}}),r=!1,i.eachNode(n,function(n){i.eachAdjacency(n,function(n){var u=t.graph.getNode(n.nodeFrom.id),f=t.graph.getNode(n.nodeTo.id),i;u.adjacentTo(f)||(i=t.graph.addAdjacence(u,f,n.data),u.startAlpha==u.endAlpha&&f.startAlpha==f.endAlpha&&(r=!0,i[0].alpha=0,i[0].startAlpha=0,i[0].endAlpha=1,i[1].alpha=0,i[1].startAlpha=0,i[1].endAlpha=1))})}),r}};Graph.Plot={Interpolator:{moebius:function(n,t,i){if(t<=1||i.norm()<=1){var u=i.x,f=i.y,r=n.startPos.getc().moebiusTransformation(i);n.pos.setc(r.x,r.y);i.x=u;i.y=f}},linear:function(n,t){var i=n.startPos.getc(!0),r=n.endPos.getc(!0);n.pos.setc((r.x-i.x)*t+i.x,(r.y-i.y)*t+i.y)},"fade:nodes":function(n,t){if(t<=1&&n.endAlpha!=n.alpha){var i=n.startAlpha,r=n.endAlpha;n.alpha=i+(r-i)*t}},"fade:vertex":function(n,t){var i=n.adjacencies;for(var r in i)this["fade:nodes"](i[r],t)},polar:function(n,t){var r=n.startPos.getp(!0),u=n.endPos.getp(),i=u.interpolate(r,t);n.pos.setp(i.theta,i.rho)}},labelsHidden:!1,labelContainer:!1,labels:{},getLabelContainer:function(){return this.labelContainer?this.labelContainer:this.labelContainer=document.getElementById(this.viz.config.labelContainer)},getLabel:function(n){return n in this.labels&&this.labels[n]!=null?this.labels[n]:this.labels[n]=document.getElementById(n)},hideLabels:function(n){var t=this.getLabelContainer();t.style.display=n?"none":"";this.labelsHidden=n},clearLabels:function(n){for(var t in this.labels)(n||!this.viz.graph.hasNode(t))&&(this.disposeLabel(t),delete this.labels[t])},disposeLabel:function(n){var t=this.getLabel(n);t&&t.parentNode&&t.parentNode.removeChild(t)},hideLabel:function(n,t){n=o(n);var i=t?"":"none",u=this;r(n,function(n){var t=u.getLabel(n.id);t&&(t.style.display=i)})},sequence:function(i){var u=this,r;i=t({condition:p(!1),step:n,onComplete:n,duration:200},i||{});r=setInterval(function(){i.condition()?i.step():(clearInterval(r),i.onComplete());u.viz.refresh(!0)},i.duration)},animate:function(n,i){var r=this,u=this.viz,f=u.graph,e=Graph.Util;n=t(u.controller,n||{});n.hideLabels&&this.hideLabels(!0);this.animation.setOptions(t(n,{$animating:!1,compute:function(t){var u=i?i.scale(-t):null;e.eachNode(f,function(i){for(var f=0;f<n.modes.length;f++)r.Interpolator[n.modes[f]](i,t,u)});r.plot(n,this.$animating);this.$animating=!0},complete:function(){e.eachNode(f,function(n){n.startPos.set(n.pos);n.startAlpha=n.alpha});n.hideLabels&&r.hideLabels(!1);r.plot(n);n.onComplete();n.onAfterCompute()}})).start()},plot:function(n,t){var f=this.viz,o=f.graph,r=f.canvas,h=f.root,u=this,i=r.getCtx(),s=Graph.Util,e;n=n||this.viz.controller;n.clearCanvas&&r.clear();e=!!o.getNode(h).visited;s.eachNode(o,function(f){s.eachAdjacency(f,function(o){var s=o.nodeTo;!!s.visited===e&&f.drawn&&s.drawn&&(t||n.onBeforePlotLine(o),i.save(),i.globalAlpha=Math.min(Math.min(f.alpha,s.alpha),o.alpha),u.plotLine(o,r,t),i.restore(),t||n.onAfterPlotLine(o))});i.save();f.drawn&&(i.globalAlpha=f.alpha,t||n.onBeforePlotNode(f),u.plotNode(f,r,t),t||n.onAfterPlotNode(f));!u.labelsHidden&&n.withLabels&&(f.drawn&&i.globalAlpha>=.95?u.plotLabel(r,f,n):u.hideLabel(f,!1));i.restore();f.visited=!e})},plotLabel:function(n,t,i){var u=t.id,r=this.getLabel(u),f;if(!r&&!(r=document.getElementById(u))){r=document.createElement("div");f=this.getLabelContainer();f.appendChild(r);r.id=u;r.className="node";r.style.position="absolute";i.onCreateLabel(r,t);this.labels[t.id]=r}this.placeLabel(r,t,i)},plotNode:function(n,t,i){var r=this.node,u=n.data,e=r.overridable&&u,h=e&&u.$lineWidth||r.lineWidth,o=e&&u.$color||r.color,f=t.getCtx(),s;f.lineWidth=h;f.fillStyle=o;f.strokeStyle=o;s=n.data&&n.data.$type||r.type;this.nodeTypes[s].call(this,n,t,i)},plotLine:function(n,t,i){var r=this.edge,u=n.data,e=r.overridable&&u,h=e&&u.$lineWidth||r.lineWidth,o=e&&u.$color||r.color,f=t.getCtx(),s;f.lineWidth=h;f.fillStyle=o;f.strokeStyle=o;s=n.data&&n.data.$type||r.type;this.edgeTypes[s].call(this,n,t,i)},fitsInCanvas:function(n,t){var i=t.getSize();return n.x>=i.width||n.x<0||n.y>=i.height||n.y<0?!1:!0}};y={construct:function(n){var i=u(n)=="array",t=new Graph(this.graphOptions);return i?function(n,t){for(var r,f,u,e,o=function(n){for(var i=0;i<t.length;i++)if(t[i].id==n)return t[i];return undefined},i=0;i<t.length;i++)for(n.addNode(t[i]),r=0,f=t[i].adjacencies;r<f.length;r++)u=f[r],typeof f[r]!="string"&&(e=u.data,u=u.nodeTo),n.addAdjacence(t[i],o(u),e)}(t,n):function(n,t){n.addNode(t);for(var i=0,r=t.children;i<r.length;i++)n.addAdjacence(t,r[i]),arguments.callee(n,r[i])}(t,n),t},loadJSON:function(n,t){this.json=n;this.graph=this.construct(n);this.root=u(n)!="array"?n.id:n[t?t:0].id}};this.Trans={linear:function(n){return n}},function(){var n=function(n,t){return t=o(t),f(n,{easeIn:function(i){return n(i,t)},easeOut:function(i){return 1-n(1-i,t)},easeInOut:function(i){return i<=.5?n(2*i,t)/2:(2-n(2*(1-i),t))/2}})},t={Pow:function(n,t){return Math.pow(n,t[0]||6)},Expo:function(n){return Math.pow(2,8*(n-1))},Circ:function(n){return 1-Math.sin(Math.acos(n))},Sine:function(n){return 1-Math.sin((1-n)*Math.PI/2)},Back:function(n,t){return t=t[0]||1.618,Math.pow(n,2)*((t+1)*n-t)},Bounce:function(n){for(var r,i=0,t=1;;i+=t,t/=2)if(n>=(7-4*i)/11){r=t*t-Math.pow((11-6*i-11*n)/4,2);break}return r},Elastic:function(n,t){return Math.pow(2,10*--n)*Math.cos(20*n*Math.PI*(t[0]||1)/3)}};r(t,function(t,i){Trans[i]=n(t)});r(["Quad","Cubic","Quart","Quint"],function(t,i){Trans[t]=n(function(n){return Math.pow(n,[i+2])})})}();c=new i({initalize:function(n){this.setOptions(n)},setOptions:function(i){var r={duration:2500,fps:40,transition:Trans.Quart.easeInOut,compute:n,complete:n};return this.opt=t(r,i||{}),this},getTime:function(){return g()},step:function(){var t=this.getTime(),n=this.opt,i;t<this.time+n.duration?(i=n.transition((t-this.time)/n.duration),n.compute(i)):(this.timer=clearInterval(this.timer),n.compute(1),n.complete())},start:function(){return this.time=0,this.startTimer(),this},startTimer:function(){var n=this,t=this.opt;return this.timer?!1:(this.time=this.getTime()-this.time,this.timer=setInterval(function(){n.step()},Math.round(1e3/t.fps)),!0)}}),function(){function a(n,t,i,r){var u=t.Node,o=Graph.Util,s=t.multitree,f,e;return u.overridable?(f=-1,e=-1,o.eachNode(n,function(n){if(n._depth==i&&(!s||"$orn"in n.data&&n.data.$orn==r)){var t=n.data.$width||u.width,o=n.data.$height||u.height;f=f<t?t:f;e=e<o?o:e}}),{width:f<0?u.width:f,height:e<0?u.height:e}):u}function v(n,t,i,r){var u=r=="left"||r=="right"?"y":"x";n[t][u]+=i}function e(n,t){var i=[];return r(n,function(n){n=h.call(n);n[0]+=t;n[1]+=t;i.push(n)}),i}function u(n,t){if(n.length==0)return t;if(t.length==0)return n;var i=n.shift(),r=t.shift();return[[i[0],r[1]]].concat(u(n,t))}function l(n,t){if(t=t||[],n.length==0)return t;var i=n.pop();return l(n,u(i,t))}function s(n,t,i,r,u){if(n.length<=u||t.length<=u)return 0;var f=n[u][1],e=t[u][0];return Math.max(s(n,t,i,r,++u)+i,f-e+r)}function p(n,t,i){function r(n,f,o){if(f.length<=o)return[];var h=f[o],c=s(n,h,t,i,0);return[c].concat(r(u(n,e(h,c)),f,++o))}return r([],n,0)}function w(n,t,i){function r(n,f,o){if(f.length<=o)return[];var h=f[o],c=-s(h,n,t,i,0);return[c].concat(r(u(e(h,c),n),f,++o))}n=h.call(n);var f=r([],n.reverse(),0);return f.reverse()}function b(n,t,i,r){var f=p(n,t,i),e=w(n,t,i),u,o;for(r=="left"?e=f:r=="right"&&(f=e),u=0,o=[];u<f.length;u++)o[u]=(f[u]+e[u])/2;return o}function k(n,t,i,r,u){function w(t,f,h){var ot=o.overridable&&t.data["$"+p]||o[p],ct=f||o.overridable&&t.data["$"+s]||o[s],rt=[],ut=[],ft=!1,lt=ct+r.levelDistance,et,ht;it.eachSubnode(t,function(t){if(t.exist&&(!k||"$orn"in t.data&&t.data.$orn==u)){ft||(ft=a(n,r,t._depth,u));var i=w(t,ft[s],h+lt);rt.push(i.tree);ut.push(i.extent)}});et=b(ut,nt,g,tt);for(var c=0,st=[];c<rt.length;c++)v(rt[c],i,et[c],u),st.push(e(ut[c],et[c]));return ht=[[-ot/2,ot/2]].concat(l(st)),t[i][d]=0,t[i][y]=u=="top"||u=="left"?h:-h,{tree:t,extent:ht}}var k=r.multitree,h=["x","y"],c=["width","height"],f=+(u=="left"||u=="right"),d=h[f],y=h[1-f],o=r.Node,p=c[f],s=c[1-f],g=r.siblingOffset,nt=r.subtreeOffset,tt=r.align,it=Graph.Util;w(t,!1,0)}var h=Array.prototype.slice;this.ST=function(){function e(n){var f,r,e;n=n||this.clickedNode;var o=this.geom,i=Graph.Util,s=this.graph,h=this.canvas,c=n._depth,t=[];for(i.eachNode(s,function(r){r.exist&&!r.selected&&(i.isDescendantOf(r,n.id)?r._depth<=c&&t.push(r):t.push(r))}),f=o.getRightLevelToShow(n,h),i.eachLevel(n,f,f,function(n){n.exist&&!n.selected&&t.push(n)}),r=0;r<u.length;r++)e=this.graph.getNode(u[r]),i.isDescendantOf(e,n.id)||t.push(e);return t}function o(n){var t=[],i=Graph.Util,r=this.config;return n=n||this.clickedNode,i.eachLevel(this.clickedNode,0,r.levelsToShow,function(n){!r.multitree||"$orn"in n.data||!i.anySubnode(n,function(n){return n.exist&&!n.drawn})?n.drawn&&!i.anySubnode(n,"drawn")&&t.push(n):t.push(n)}),t}var u=[];return new i({Implements:y,initialize:function(i,r){var u={onBeforeCompute:n,onAfterCompute:n,onCreateLabel:n,onPlaceLabel:n,onComplete:n,onBeforePlotNode:n,onAfterPlotNode:n,onBeforePlotLine:n,onAfterPlotLine:n,request:!1},f={orientation:"left",labelContainer:i.id+"-label",levelsToShow:2,subtreeOffset:8,siblingOffset:5,levelDistance:30,withLabels:!0,clearCanvas:!0,align:"center",indent:10,multitree:!1,constrained:!0,Node:{overridable:!1,type:"rectangle",color:"#ccb",lineWidth:1,height:20,width:90,dim:15,align:"center"},Edge:{overridable:!1,type:"line",color:"#ccc",dim:15,lineWidth:1},duration:700,fps:25,transition:Trans.Quart.easeInOut};this.controller=this.config=t(f,u,r);this.canvas=i;this.graphOptions={complex:!0};this.graph=new Graph(this.graphOptions);this.fx=new ST.Plot(this);this.op=new ST.Op(this);this.group=new ST.Group(this);this.geom=new ST.Geom(this);this.clickedNode=null},plot:function(){this.fx.plot(this.controller)},switchPosition:function(n,t,i){var f=this.geom,u=this.fx,r=this;u.busy||(u.busy=!0,this.contract({onComplete:function(){if(f.switchOrientation(n),r.compute("endPos",!1),u.busy=!1,t=="animate")r.onClick(r.clickedNode.id,i);else t=="replot"&&r.select(r.clickedNode.id,i)}},n))},switchAlignment:function(n,t,i){if(this.config.align=n,t=="animate")this.select(this.clickedNode.id,i);else if(t=="replot")this.onClick(this.clickedNode.id,i)},addNodeInPath:function(n){u.push(n);this.select(this.clickedNode&&this.clickedNode.id||this.root)},clearNodesInPath:function(){u.length=0;this.select(this.clickedNode&&this.clickedNode.id||this.root)},refresh:function(){this.reposition();this.select(this.clickedNode&&this.clickedNode.id||this.root)},reposition:function(){Graph.Util.computeLevels(this.graph,this.root,0,"ignore");this.geom.setRightLevelToShow(this.clickedNode,this.canvas);Graph.Util.eachNode(this.graph,function(n){n.exist&&(n.drawn=!0)});this.compute("endPos")},compute:function(n,t){var r=n||"startPos",i=this.graph.getNode(this.root);f(i,{drawn:!0,exist:!0,selected:!0});!t&&"_depth"in i||Graph.Util.computeLevels(this.graph,this.root,0,"ignore");this.computePositions(i,r)},computePositions:function(n,t){var i=this.config,f=i.multitree,e=i.align,u=e!=="center"&&i.indent,s=i.orientation,h=f?["top","right","bottom","left"]:[s],o=this;r(h,function(i){k(o.graph,n,t,o.config,i);var r=["x","y"][+(i=="left"||i=="right")];(function s(n){Graph.Util.eachSubnode(n,function(o){o.exist&&(!f||"$orn"in o.data&&o.data.$orn==i)&&(o[t][r]+=n[t][r],u&&(o[t][r]+=e=="left"?u:-u),s(o))})})(n)})},requestNodes:function(n,i){var r=t(this.controller,i),f=this.config.levelsToShow,e=Graph.Util,u,o;r.request?(u=[],o=n._depth,e.eachLevel(n,0,f,function(n){n.drawn&&!e.anySubnode(n)&&(u.push(n),n._level=f-(n._depth-o))}),this.group.requestNodes(u,r)):r.onComplete()},contract:function(n,i){var f=this.config.orientation,r=this.geom,o=this.group,u;i&&r.switchOrientation(i);u=e.call(this);i&&r.switchOrientation(f);o.contract(u,t(this.controller,n))},move:function(n,i){this.compute("endPos",!1);var r=i.Move,u={x:r.offsetX,y:r.offsetY};r.enable&&this.geom.translate(n.endPos.add(u).$scale(-1),"endPos");this.fx.animate(t(this.controller,{modes:["linear"]},i))},expand:function(n,i){var r=o.call(this,n);this.group.expand(r,t(this.controller,i))},selectPath:function(n){function e(n){if(n!=null&&!n.selected){n.selected=!0;r(o.group.getSiblings([n])[n.id],function(n){n.exist=!0;n.drawn=!0});var t=f.getParents(n);t=t.length>0?t[0]:null;e(t)}}var f=Graph.Util,o=this,t,i;for(f.eachNode(this.graph,function(n){n.selected=!1}),t=0,i=[n.id].concat(u);t<i.length;t++)e(this.graph.getNode(i[t]))},setRoot:function(n,t){function f(){if(this.config.multitree&&i.data.$orn){var u=i.data.$orn,t={left:"right",right:"left",top:"bottom",bottom:"top"}[u];r.data.$orn=t,function f(i){Graph.Util.eachSubnode(i,function(i){i.id!=n&&(i.data.$orn=t,f(i))})}(r);delete i.data.$orn}this.root=n;this.clickedNode=i;Graph.Util.computeLevels(this.graph,this.root,0,"ignore")}var u=this,e=this.canvas,r=this.graph.getNode(this.root),i=this.graph.getNode(n);if(delete r.data.$orns,t=="animate")this.onClick(n,{onBeforeMove:function(){f.call(u);u.selectPath(i)}});else t=="replot"&&(f.call(this),this.select(this.root))},addSubtree:function(n,t,i){t=="replot"?this.op.sum(n,f({type:"replot"},i||{})):t=="animate"&&this.op.sum(n,f({type:"fade:seq"},i||{}))},removeSubtree:function(n,t,i,r){var e=this.graph.getNode(n),u=[];Graph.Util.eachLevel(e,+!t,!1,function(n){u.push(n.id)});i=="replot"?this.op.removeNode(u,f({type:"replot"},r||{})):i=="animate"&&this.op.removeNode(u,f({type:"fade:seq"},r||{}))},select:function(n,i){var s=this.group,h=this.geom,u=this.graph.getNode(n),c=this.canvas,l=this.graph.getNode(this.root),f=t(this.controller,i),r=this;f.onBeforeCompute(u);this.selectPath(u);this.clickedNode=u;this.requestNodes(u,{onComplete:function(){s.hide(s.prepare(e.call(r)),f);h.setRightLevelToShow(u,c);r.compute("pos");Graph.Util.eachNode(r.graph,function(n){var t=n.pos.getc(!0);n.startPos.setc(t.x,t.y);n.endPos.setc(t.x,t.y);n.visited=!1});r.geom.translate(u.endPos.scale(-1),["pos","startPos","endPos"]);s.show(o.call(r));r.plot();f.onAfterCompute(r.clickedNode);f.onComplete()}})},onClick:function(i,r){var o=this.canvas,e=this,c=this.fx,l=Graph.Util,s=this.geom,h={Move:{enable:!0,offsetX:0,offsetY:0},onBeforeRequest:n,onBeforeContract:n,onBeforeMove:n,onBeforeExpand:n},f=t(this.controller,h,r),u;if(!this.busy){this.busy=!0;u=this.graph.getNode(i);this.selectPath(u,this.clickedNode);this.clickedNode=u;f.onBeforeCompute(u);f.onBeforeRequest(u);this.requestNodes(u,{onComplete:function(){f.onBeforeContract(u);e.contract({onComplete:function(){s.setRightLevelToShow(u,o);f.onBeforeMove(u);e.move(u,{Move:f.Move,onComplete:function(){f.onBeforeExpand(u);e.expand(u,{onComplete:function(){e.busy=!1;f.onAfterCompute(i);f.onComplete()}})}})}})}})}}})}();ST.Op=new i({Implements:Graph.Op,initialize:function(n){this.viz=n}});ST.Group=new i({initialize:function(n){this.viz=n;this.canvas=n.canvas;this.config=n.config;this.animation=new c;this.nodes=null},requestNodes:function(n,t){var e=0,r=n.length,o={},f=function(){t.onComplete()},u=this.viz,i;for(r==0&&f(),i=0;i<r;i++)o[n[i].id]=n[i],t.request(n[i].id,n[i]._level,{onComplete:function(n,t){t&&t.children&&(t.id=n,u.op.sum(t,{type:"nothing"}));++e==r&&(Graph.Util.computeLevels(u.graph,u.root,0),f())}})},contract:function(n,i){var u=Graph.Util,f=this.viz,r=this;n=this.prepare(n);this.animation.setOptions(t(i,{$animating:!1,compute:function(n){n==1&&(n=.99);r.plotStep(1-n,i,this.$animating);this.$animating="contract"},complete:function(){r.hide(n,i)}})).start()},hide:function(n,t){for(var r,u=Graph.Util,e=this.viz,i=0;i<n.length;i++)!1&&t&&t.request?(r=[],u.eachLevel(n[i],1,!1,function(n){r.push(n.id)}),e.op.removeNode(r,{type:"nothing"}),e.fx.clearLabels()):u.eachLevel(n[i],1,!1,function(n){n.exist&&f(n,{drawn:!1,exist:!1})});t.onComplete()},expand:function(n,i){var r=this,u=Graph.Util;this.show(n);this.animation.setOptions(t(i,{$animating:!1,compute:function(n){r.plotStep(n,i,this.$animating);this.$animating="expand"},complete:function(){r.plotStep(undefined,i,!1);i.onComplete()}})).start()},show:function(n){var t=Graph.Util,i=this.config;this.prepare(n);r(n,function(n){if(i.multitree&&!("$orn"in n.data)){delete n.data.$orns;var r=" ";t.eachSubnode(n,function(n){"$orn"in n.data&&r.indexOf(n.data.$orn)<0&&n.exist&&!n.drawn&&(r+=n.data.$orn+" ")});n.data.$orns=r}t.eachLevel(n,0,i.levelsToShow,function(n){n.exist&&(n.drawn=!0)})})},prepare:function(n){return this.nodes=this.getNodesWithChildren(n),this.nodes},getNodesWithChildren:function(n){var u=[],f=Graph.Util,e=this.config,o=this.viz.root,t,i,r;for(n.sort(function(n,t){return(n._depth<=t._depth)-(n._depth>=t._depth)}),t=0;t<n.length;t++)if(f.anySubnode(n[t],"exist")){for(i=t+1,r=!1;!r&&i<n.length;i++)(!e.multitree||"$orn"in n[i].data)&&(r=r||f.isDescendantOf(n[t],n[i].id));r||u.push(n[t])}return u},plotStep:function(n,t,i){for(var c=this.viz,a=this.config,v=c.canvas,l=v.getCtx(),e=this.nodes,y=Graph.Util,f,o={},s,h,u=0;u<e.length;u++)f=e[u],o[f.id]=[],s=a.multitree&&!("$orn"in f.data),h=s&&f.data.$orns,y.eachSubgraph(f,function(n){s&&h&&h.indexOf(n.data.$orn)>0&&n.drawn?(n.drawn=!1,o[f.id].push(n)):s&&h||!n.drawn||(n.drawn=!1,o[f.id].push(n))}),f.drawn=!0;e.length>0&&c.fx.plot();for(u in o)r(o[u],function(n){n.drawn=!0});for(u=0;u<e.length;u++)f=e[u],l.save(),c.fx.plotSubtree(f,t,n,i),l.restore()},getSiblings:function(n){var t={},i=Graph.Util;return r(n,function(n){var u=i.getParents(n),r;u.length==0?t[n.id]=[n]:(r=[],i.eachSubnode(u[0],function(n){r.push(n)}),t[n.id]=r)}),t}});ST.Geom=new i({initialize:function(n){this.viz=n;this.config=n.config;this.node=n.config.Node;this.edge=n.config.Edge},translate:function(n,t){t=o(t);Graph.Util.eachNode(this.viz.graph,function(i){r(t,function(t){i[t].$add(n)})})},switchOrientation:function(n){this.config.orientation=n},dispatch:function(){var n=Array.prototype.slice.call(arguments),i=n.shift(),r=n.length,t=function(n){return typeof n=="function"?n():n};if(r==2)return i=="top"||i=="bottom"?t(n[0]):t(n[1]);if(r==4)switch(i){case"top":return t(n[0]);case"right":return t(n[1]);case"bottom":return t(n[2]);case"left":return t(n[3])}return undefined},getSize:function(n,t){var i=this.node,r=n.data,h=this.config,u=i.overridable,f=h.siblingOffset,e=this.config.multitree&&"$orn"in n.data&&n.data.$orn||this.config.orientation,o=(u&&r.$width||i.width)+f,s=(u&&r.$height||i.height)+f;return t?this.dispatch(e,o,s):this.dispatch(e,s,o)},getTreeBaseSize:function(n,t,i){var r=this.getSize(n,!0),u=0,f=this;return i(t,n)?r:t===0?0:(Graph.Util.eachSubnode(n,function(n){u+=f.getTreeBaseSize(n,t-1,i)}),(r>u?r:u)+this.config.subtreeOffset)},getEdge:function(n,t,i){var r=function(t,i){return function(){return n.pos.add(new Complex(t,i))}},u=this.node,o=this.node.overridable,s=n.data,f=o&&s.$width||u.width,e=o&&s.$height||u.height;if(t=="begin"){if(u.align=="center")return this.dispatch(i,r(0,e/2),r(-f/2,0),r(0,-e/2),r(f/2,0));if(u.align=="left")return this.dispatch(i,r(0,e),r(0,0),r(0,0),r(f,0));if(u.align=="right")return this.dispatch(i,r(0,0),r(-f,0),r(0,-e),r(0,0));throw"align: not implemented";}else if(t=="end"){if(u.align=="center")return this.dispatch(i,r(0,-e/2),r(f/2,0),r(0,e/2),r(-f/2,0));if(u.align=="left")return this.dispatch(i,r(0,0),r(f,0),r(0,e),r(0,0));if(u.align=="right")return this.dispatch(i,r(0,-e),r(0,0),r(0,0),r(-f,0));throw"align: not implemented";}},getScaledTreePosition:function(n,t){var r=this.node,o=this.node.overridable,s=n.data,u=o&&s.$width||r.width,f=o&&s.$height||r.height,e=this.config.multitree&&"$orn"in n.data&&n.data.$orn||this.config.orientation,i=function(i,r){return function(){return n.pos.add(new Complex(i,r)).$scale(1-t)}};if(r.align=="left")return this.dispatch(e,i(0,f),i(0,0),i(0,0),i(u,0));if(r.align=="center")return this.dispatch(e,i(0,f/2),i(-u/2,0),i(0,-f/2),i(u/2,0));if(r.align=="right")return this.dispatch(e,i(0,0),i(-u,0),i(0,-f),i(0,0));throw"align: not implemented";},treeFitsInCanvas:function(n,t,i){var r=t.getSize(n),u=this.config.multitree&&"$orn"in n.data&&n.data.$orn||this.config.orientation,f=this.dispatch(u,r.width,r.height),e=this.getTreeBaseSize(n,i,function(n,t){return n===0||!Graph.Util.anySubnode(t)});return e<f},setRightLevelToShow:function(n,t){var i=this.getRightLevelToShow(n,t),r=this.viz.fx;Graph.Util.eachLevel(n,0,this.config.levelsToShow,function(t){var u=t._depth-n._depth;u>i?(t.drawn=!1,t.exist=!1,r.hideLabel(t,!1)):t.exist=!0});n.drawn=!0},getRightLevelToShow:function(n,t){var r=this.config,i=r.levelsToShow,u=r.constrained;if(!u)return i;while(!this.treeFitsInCanvas(n,t,i)&&i>1)i--;return i}});ST.Plot=new i({Implements:Graph.Plot,initialize:function(n){this.viz=n;this.config=n.config;this.node=this.config.Node;this.edge=this.config.Edge;this.animation=new c;this.nodeTypes=new ST.Plot.NodeTypes;this.edgeTypes=new ST.Plot.EdgeTypes},plotSubtree:function(n,t,i,r){var e=this.viz,o=e.canvas,u,f;i=Math.min(Math.max(.001,i),1);i>=0&&(n.drawn=!1,u=o.getCtx(),f=e.geom.getScaledTreePosition(n,i),u.translate(f.x,f.y),u.scale(i,i));this.plotTree(n,!i,t,r);i>=0&&(n.drawn=!0)},plotTree:function(n,t,i,r){var e=this,s=this.viz,u=s.canvas,h=this.config,f=u.getCtx(),o=h.multitree&&!("$orn"in n.data),c=o&&n.data.$orns;Graph.Util.eachSubnode(n,function(s){if((!o||c.indexOf(s.data.$orn)>0)&&s.exist&&s.drawn){var h=n.getAdjacency(s.id);r||i.onBeforePlotLine(h);f.globalAlpha=Math.min(n.alpha,s.alpha);e.plotLine(h,u,r);r||i.onAfterPlotLine(h);e.plotTree(s,t,i,r)}});n.drawn?(f.globalAlpha=n.alpha,r||i.onBeforePlotNode(n),this.plotNode(n,u,r),r||i.onAfterPlotNode(n),t&&f.globalAlpha>=.95?this.plotLabel(u,n,i):this.hideLabel(n,!1)):this.hideLabel(n,!0)},placeLabel:function(n,t,i){var r=t.pos.getc(!0),f=this.node,l=this.viz.canvas,s=f.overridable&&t.data.$width||f.width,h=f.overridable&&t.data.$height||f.height,u=l.getSize(),e,o,c;if(f.align=="center")e={x:Math.round(r.x-s/2+u.width/2),y:Math.round(r.y-h/2+u.height/2)};else if(f.align=="left")o=this.config.orientation,e=o=="bottom"||o=="top"?{x:Math.round(r.x-s/2+u.width/2),y:Math.round(r.y+u.height/2)}:{x:Math.round(r.x+u.width/2),y:Math.round(r.y-h/2+u.height/2)};else if(f.align=="right")o=this.config.orientation,e=o=="bottom"||o=="top"?{x:Math.round(r.x-s/2+u.width/2),y:Math.round(r.y-h+u.height/2)}:{x:Math.round(r.x-s+u.width/2),y:Math.round(r.y-h/2+u.height/2)};else throw"align: not implemented";c=n.style;c.left=e.x+"px";c.top=e.y+"px";c.display=this.fitsInCanvas(e,l)?"":"none";i.onPlaceLabel(n,t)},getAlignedPos:function(n,t,i){var f=this.node,u,r;if(f.align=="center")u={x:n.x-t/2,y:n.y-i/2};else if(f.align=="left")r=this.config.orientation,u=r=="bottom"||r=="top"?{x:n.x-t/2,y:n.y}:{x:n.x,y:n.y-i/2};else if(f.align=="right")r=this.config.orientation,u=r=="bottom"||r=="top"?{x:n.x-t/2,y:n.y-i}:{x:n.x-t,y:n.y-i/2};else throw"align: not implemented";return u},getOrientation:function(n){var r=this.config,u=r.orientation,t,i;return r.multitree&&(t=n.nodeFrom,i=n.nodeTo,u="$orn"in t.data&&t.data.$orn||"$orn"in i.data&&i.data.$orn),u}});ST.Plot.NodeTypes=new i({none:function(){},circle:function(n,t){var e=n.pos.getc(!0),r=this.node,u=n.data,o=r.overridable&&u,i=o&&u.$dim||r.dim,f=this.getAlignedPos(e,i*2,i*2);t.path("fill",function(n){n.arc(f.x+i,f.y+i,i,0,Math.PI*2,!0)})},square:function(n,t){var e=n.pos.getc(!0),r=this.node,u=n.data,o=r.overridable&&u,i=o&&u.$dim||r.dim,f=this.getAlignedPos(e,i,i);t.getCtx().fillRect(f.x,f.y,i,i)},ellipse:function(n,t){var h=n.pos.getc(!0),u=this.node,f=n.data,o=u.overridable&&f,r=(o&&f.$width||u.width)/2,i=(o&&f.$height||u.height)/2,s=this.getAlignedPos(h,r*2,i*2),e=t.getCtx();e.save();e.scale(r/i,i/r);t.path("fill",function(n){n.arc((s.x+r)*(i/r),(s.y+i)*(r/i),i,0,Math.PI*2,!0)});e.restore()},rectangle:function(n,t){var s=n.pos.getc(!0),i=this.node,r=n.data,u=i.overridable&&r,f=u&&r.$width||i.width,e=u&&r.$height||i.height,o=this.getAlignedPos(s,f,e);t.getCtx().fillRect(o.x,o.y,f,e)}});ST.Plot.EdgeTypes=new i({none:function(){},line:function(n,t){var u=this.getOrientation(n),i=n.nodeFrom,r=n.nodeTo,f=this.viz.geom.getEdge(i._depth<r._depth?i:r,"begin",u),e=this.viz.geom.getEdge(i._depth<r._depth?r:i,"end",u);t.path("stroke",function(n){n.moveTo(f.x,f.y);n.lineTo(e.x,e.y)})},"quadratic:begin":function(n,t){var o=this.getOrientation(n),s=n.data,h=this.edge,u=n.nodeFrom,f=n.nodeTo,i=this.viz.geom.getEdge(u._depth<f._depth?u:f,"begin",o),r=this.viz.geom.getEdge(u._depth<f._depth?f:u,"end",o),c=h.overridable&&s,e=c&&s.$dim||h.dim;switch(o){case"left":t.path("stroke",function(n){n.moveTo(i.x,i.y);n.quadraticCurveTo(i.x+e,i.y,r.x,r.y)});break;case"right":t.path("stroke",function(n){n.moveTo(i.x,i.y);n.quadraticCurveTo(i.x-e,i.y,r.x,r.y)});break;case"top":t.path("stroke",function(n){n.moveTo(i.x,i.y);n.quadraticCurveTo(i.x,i.y+e,r.x,r.y)});break;case"bottom":t.path("stroke",function(n){n.moveTo(i.x,i.y);n.quadraticCurveTo(i.x,i.y-e,r.x,r.y)})}},"quadratic:end":function(n,t){var o=this.getOrientation(n),s=n.data,h=this.edge,u=n.nodeFrom,f=n.nodeTo,r=this.viz.geom.getEdge(u._depth<f._depth?u:f,"begin",o),i=this.viz.geom.getEdge(u._depth<f._depth?f:u,"end",o),c=h.overridable&&s,e=c&&s.$dim||h.dim;switch(o){case"left":t.path("stroke",function(n){n.moveTo(r.x,r.y);n.quadraticCurveTo(i.x-e,i.y,i.x,i.y)});break;case"right":t.path("stroke",function(n){n.moveTo(r.x,r.y);n.quadraticCurveTo(i.x+e,i.y,i.x,i.y)});break;case"top":t.path("stroke",function(n){n.moveTo(r.x,r.y);n.quadraticCurveTo(i.x,i.y-e,i.x,i.y)});break;case"bottom":t.path("stroke",function(n){n.moveTo(r.x,r.y);n.quadraticCurveTo(i.x,i.y+e,i.x,i.y)})}},bezier:function(n,t){var s=n.data,h=this.edge,o=this.getOrientation(n),f=n.nodeFrom,e=n.nodeTo,i=this.viz.geom.getEdge(f._depth<e._depth?f:e,"begin",o),r=this.viz.geom.getEdge(f._depth<e._depth?e:f,"end",o),c=h.overridable&&s,u=c&&s.$dim||h.dim;switch(o){case"left":t.path("stroke",function(n){n.moveTo(i.x,i.y);n.bezierCurveTo(i.x+u,i.y,r.x-u,r.y,r.x,r.y)});break;case"right":t.path("stroke",function(n){n.moveTo(i.x,i.y);n.bezierCurveTo(i.x-u,i.y,r.x+u,r.y,r.x,r.y)});break;case"top":t.path("stroke",function(n){n.moveTo(i.x,i.y);n.bezierCurveTo(i.x,i.y+u,r.x,r.y-u,r.x,r.y)});break;case"bottom":t.path("stroke",function(n){n.moveTo(i.x,i.y);n.bezierCurveTo(i.x,i.y-u,r.x,r.y+u,r.x,r.y)})}},arrow:function(n,t){var c=this.getOrientation(n),e=n.nodeFrom,o=n.nodeTo,u=n.data,l=this.edge,a=l.overridable&&u,b=a&&u.$dim||l.dim,f,h;a&&u.$direction&&u.$direction.length>1&&(f={},f[e.id]=e,f[o.id]=o,h=u.$direction,e=f[h[0]],o=f[h[1]]);var s=this.viz.geom.getEdge(e,"begin",c),i=this.viz.geom.getEdge(o,"end",c),r=new Complex(i.x-s.x,i.y-s.y);r.$scale(b/r.norm());var v=new Complex(i.x-r.x,i.y-r.y),y=new Complex(-r.y/2,r.x/2),p=v.add(y),w=v.$add(y.$scale(-1));t.path("stroke",function(n){n.moveTo(s.x,s.y);n.lineTo(i.x,i.y)});t.path("fill",function(n){n.moveTo(p.x,p.y);n.lineTo(w.x,w.y);n.lineTo(i.x,i.y)})}})}();b={setAngularWidthForNodes:function(){var n=this.config.Node,t=n.overridable,i=n.dim;Graph.Util.eachBFS(this.graph,this.root,function(n,r){var u=t&&n.data&&n.data.$aw||i;n._angularWidth=u/r},"ignore")},setSubtreesAngularWidth:function(){var n=this;Graph.Util.eachNode(this.graph,function(t){n.setSubtreeAngularWidth(t)},"ignore")},setSubtreeAngularWidth:function(n){var i=this,r=n._angularWidth,t=0;Graph.Util.eachSubnode(n,function(n){i.setSubtreeAngularWidth(n);t+=n._treeAngularWidth},"ignore");n._treeAngularWidth=Math.max(r,t)},computeAngularWidths:function(){this.setAngularWidthForNodes();this.setSubtreesAngularWidth()}};this.RGraph=new i({Implements:[y,b],initialize:function(i,r){var u={labelContainer:i.id+"-label",interpolation:"linear",levelDistance:100,withLabels:!0,Node:{overridable:!1,type:"circle",dim:3,color:"#ccb",width:5,height:5,lineWidth:1},Edge:{overridable:!1,type:"line",color:"#ccb",lineWidth:1},fps:40,duration:2500,transition:Trans.Quart.easeInOut,clearCanvas:!0},f={onBeforeCompute:n,onAfterCompute:n,onCreateLabel:n,onPlaceLabel:n,onComplete:n,onBeforePlotLine:n,onAfterPlotLine:n,onBeforePlotNode:n,onAfterPlotNode:n};this.controller=this.config=t(u,f,r);this.graphOptions={complex:!1,Node:{selected:!1,exist:!0,drawn:!0}};this.graph=new Graph(this.graphOptions);this.fx=new RGraph.Plot(this);this.op=new RGraph.Op(this);this.json=null;this.canvas=i;this.root=null;this.busy=!1;this.parent=!1},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("endPos")},plot:function(){this.fx.plot()},compute:function(n){var t=n||["pos","startPos","endPos"],i=this.graph.getNode(this.root);i._depth=0;Graph.Util.computeLevels(this.graph,this.root,0,"ignore");this.computeAngularWidths();this.computePositions(t)},computePositions:function(n){for(var t=o(n),h=this.graph,u=Graph.Util,i=this.graph.getNode(this.root),f=this.parent,s=this.config,r=0;r<t.length;r++)i[t[r]]=e(0,0);i.angleSpan={begin:0,end:2*Math.PI};i._rel=1;u.eachBFS(this.graph,this.root,function(n){var y=n.angleSpan.end-n.angleSpan.begin,p=(n._depth+1)*s.levelDistance,o=n.angleSpan.begin,a=0,r=[],h,i,c,v,l;for(u.eachSubnode(n,function(n){a+=n._treeAngularWidth;r.push(n)},"ignore"),f&&f.id==n.id&&r.length>0&&r[0].dist&&r.sort(function(n,t){return(n.dist>=t.dist)-(n.dist<=t.dist)}),h=0;h<r.length;h++)if(i=r[h],!i._flag){for(i._rel=i._treeAngularWidth/a,c=i._rel*y,v=o+c/2,l=0;l<t.length;l++)i[t[l]]=e(v,p);i.angleSpan={begin:o,end:o+c};o+=c}},"ignore")},getNodeAndParentAngle:function(n){var t=!1,r=this.graph.getNode(n),u=Graph.Util.getParents(r),i=u.length>0?u[0]:!1;if(i){var e=i.pos.getc(),o=r.pos.getc(),f=e.add(o.scale(-1));t=Math.atan2(f.y,f.x);t<0&&(t+=2*Math.PI)}return{parent:i,theta:t}},tagChildren:function(n,t){var i,f,r,u,e;if(n.angleSpan){for(i=[],Graph.Util.eachAdjacency(n,function(n){i.push(n.nodeTo)},"ignore"),f=i.length,r=0;r<f&&t!=i[r].id;r++);for(u=(r+1)%f,e=0;t!=i[u].id;u=(u+1)%f)i[u].dist=e++}},onClick:function(i,r){var u,f,o;if(this.root!=i&&!this.busy){this.busy=!0;this.root=i;that=this;this.controller.onBeforeCompute(this.graph.getNode(i));u=this.getNodeAndParentAngle(i);this.tagChildren(u.parent,i);this.parent=u.parent;this.compute("endPos");f=u.theta-u.parent.endPos.theta;Graph.Util.eachNode(this.graph,function(n){n.endPos.set(n.endPos.getp().add(e(f,0)))});o=this.config.interpolation;r=t({onComplete:n},r||{});this.fx.animate(t({hideLabels:!0,modes:[o]},r,{onComplete:function(){that.busy=!1;r.onComplete()}}))}}});RGraph.Op=new i({Implements:Graph.Op,initialize:function(n){this.viz=n}});RGraph.Plot=new i({Implements:Graph.Plot,initialize:function(n){this.viz=n;this.config=n.config;this.node=n.config.Node;this.edge=n.config.Edge;this.animation=new c;this.nodeTypes=new RGraph.Plot.NodeTypes;this.edgeTypes=new RGraph.Plot.EdgeTypes},placeLabel:function(n,t,i){var f=t.pos.getc(!0),e=this.viz.canvas,o=e.getSize(),r={x:Math.round(f.x+o.width/2),y:Math.round(f.y+o.height/2)},u=n.style;u.left=r.x+"px";u.top=r.y+"px";u.display=this.fitsInCanvas(r,e)?"":"none";i.onPlaceLabel(n,t)}});RGraph.Plot.NodeTypes=new i({none:function(){},circle:function(n,t){var i=n.pos.getc(!0),r=this.node,u=n.data,f=r.overridable&&u&&u.$dim||r.dim;t.path("fill",function(n){n.arc(i.x,i.y,f,0,Math.PI*2,!0)})},square:function(n,t){var r=n.pos.getc(!0),u=this.node,f=n.data,i=u.overridable&&f&&f.$dim||u.dim,e=2*i;t.getCtx().fillRect(r.x-i,r.y-i,e,e)},rectangle:function(n,t){var u=n.pos.getc(!0),i=this.node,r=n.data,f=i.overridable&&r&&r.$width||i.width,e=i.overridable&&r&&r.$height||i.height;t.getCtx().fillRect(u.x-f/2,u.y-e/2,f,e)},triangle:function(n,t){var r=n.pos.getc(!0),f=this.node,e=n.data,i=f.overridable&&e&&e.$dim||f.dim,u=r.x,s=r.y-i,h=u-i,o=r.y+i,c=u+i,l=o;t.path("fill",function(n){n.moveTo(u,s);n.lineTo(h,o);n.lineTo(c,l)})},star:function(n,t){var f=n.pos.getc(!0),e=this.node,o=n.data,u=e.overridable&&o&&o.$dim||e.dim,i=t.getCtx(),s=Math.PI/5,r;for(i.save(),i.translate(f.x,f.y),i.beginPath(),i.moveTo(u,0),r=0;r<9;r++)i.rotate(s),r%2==0?i.lineTo(u/.525731*.200811,0):i.lineTo(u,0);i.closePath();i.fill();i.restore()}});RGraph.Plot.EdgeTypes=new i({none:function(){},line:function(n,t){var i=n.nodeFrom.pos.getc(!0),r=n.nodeTo.pos.getc(!0);t.path("stroke",function(n){n.moveTo(i.x,i.y);n.lineTo(r.x,r.y)})},arrow:function(n,t){var e=n.nodeFrom,o=n.nodeTo,u=n.data,p=this.edge,c=p.overridable&&u,w=c&&u.$dim||14,f,h;c&&u.$direction&&u.$direction.length>1&&(f={},f[e.id]=e,f[o.id]=o,h=u.$direction,e=f[h[0]],o=f[h[1]]);var s=e.pos.getc(!0),i=o.pos.getc(!0),r=new Complex(i.x-s.x,i.y-s.y);r.$scale(w/r.norm());var l=new Complex(i.x-r.x,i.y-r.y),a=new Complex(-r.y/2,r.x/2),v=l.add(a),y=l.$add(a.$scale(-1));t.path("stroke",function(n){n.moveTo(s.x,s.y);n.lineTo(i.x,i.y)});t.path("fill",function(n){n.moveTo(v.x,v.y);n.lineTo(y.x,y.y);n.lineTo(i.x,i.y)})}});Complex.prototype.moebiusTransformation=function(n){var i=this.add(n),t=n.$conjugate().$prod(this);return t.x++,i.$div(t)};Graph.Util.getClosestNodeToOrigin=function(n,t,i){return this.getClosestNodeToPos(n,Polar.KER,t,i)};Graph.Util.getClosestNodeToPos=function(n,t,i,r){var u=null,f;return i=i||"pos",t=t&&t.getc(!0)||Complex.KER,f=function(n,t){var i=n.x-t.x,r=n.y-t.y;return i*i+r*r},this.eachNode(n,function(n){u=u==null||f(n[i].getc(!0),t)<f(u[i].getc(!0),t)?n:u},r),u};Graph.Util.moebiusTransformation=function(n,t,i,r,u){this.eachNode(n,function(n){for(var f,e,u=0;u<i.length;u++)f=t[u].scale(-1),e=r?r:i[u],n[i[u]].set(n[e].getc().moebiusTransformation(f))},u)};this.Hypertree=new i({Implements:[y,b],initialize:function(i,r){var u={labelContainer:i.id+"-label",withLabels:!0,Node:{overridable:!1,type:"circle",dim:7,color:"#ccb",width:5,height:5,lineWidth:1,transform:!0},Edge:{overridable:!1,type:"hyperline",color:"#ccb",lineWidth:1},clearCanvas:!0,fps:40,duration:1500,transition:Trans.Quart.easeInOut},f={onBeforeCompute:n,onAfterCompute:n,onCreateLabel:n,onPlaceLabel:n,onComplete:n,onBeforePlotLine:n,onAfterPlotLine:n,onBeforePlotNode:n,onAfterPlotNode:n};this.controller=this.config=t(u,f,r);this.graphOptions={complex:!1,Node:{selected:!1,exist:!0,drawn:!0}};this.graph=new Graph(this.graphOptions);this.fx=new Hypertree.Plot(this);this.op=new Hypertree.Op(this);this.json=null;this.canvas=i;this.root=null;this.busy=!1},refresh:function(n){n?(this.reposition(),Graph.Util.eachNode(this.graph,function(n){n.startPos.rho=n.pos.rho=n.endPos.rho;n.startPos.theta=n.pos.theta=n.endPos.theta})):this.compute();this.plot()},reposition:function(){this.compute("endPos");var n=this.graph.getNode(this.root).pos.getc().scale(-1);Graph.Util.moebiusTransformation(this.graph,[n],["endPos"],"endPos","ignore");Graph.Util.eachNode(this.graph,function(n){n.ignore&&(n.endPos.rho=n.pos.rho,n.endPos.theta=n.pos.theta)})},plot:function(){this.fx.plot()},compute:function(n){var t=n||["pos","startPos"],i=this.graph.getNode(this.root);i._depth=0;Graph.Util.computeLevels(this.graph,this.root,0,"ignore");this.computeAngularWidths();this.computePositions(t)},computePositions:function(n){for(var f,t=o(n),h=this.graph,i=Graph.Util,r=this.graph.getNode(this.root),l=this,a=this.config,s=this.canvas.getSize(),c=Math.min(s.width,s.height)/2,u=0;u<t.length;u++)r[t[u]]=e(0,0);r.angleSpan={begin:0,end:2*Math.PI};r._rel=1;f=function(){var t=0,n,r;for(i.eachNode(h,function(n){t=n._depth>t?n._depth:t;n._scale=c},"ignore"),n=.51;n<=1;n+=.01)if(r=function(n,t){return(1-Math.pow(n,t))/(1-n)}(n,t+1),r>=2)return n-.01;return.5}();i.eachBFS(this.graph,this.root,function(n){for(var h=n.angleSpan.end-n.angleSpan.begin,r=n.angleSpan.begin,c=function(n){var t=0;return i.eachSubnode(n,function(n){t+=n._treeAngularWidth},"ignore"),t}(n),u=1,o=0,s=f,l=n._depth;u<=l+1;u++)o+=s,s*=f;i.eachSubnode(n,function(n){var i,f,u;if(!n._flag){for(n._rel=n._treeAngularWidth/c,i=n._rel*h,f=r+i/2,u=0;u<t.length;u++)n[t[u]]=e(f,o);n.angleSpan={begin:r,end:r+i};r+=i}},"ignore")},"ignore")},onClick:function(n,t){var i=this.graph.getNode(n).pos.getc(!0);this.move(i,t)},move:function(i,r){var u=h(i.x,i.y),f,e,o;if(this.busy===!1&&u.norm()<1){f=Graph.Util;this.busy=!0;e=f.getClosestNodeToPos(this.graph,u);o=this;f.computeLevels(this.graph,e.id,0);this.controller.onBeforeCompute(e);u.norm()<1&&(r=t({onComplete:n},r||{}),this.fx.animate(t({modes:["moebius"],hideLabels:!0},r,{onComplete:function(){o.busy=!1;r.onComplete()}}),u))}}});Hypertree.Op=new i({Implements:Graph.Op,initialize:function(n){this.viz=n}});Hypertree.Plot=new i({Implements:Graph.Plot,initialize:function(n){this.viz=n;this.config=n.config;this.node=this.config.Node;this.edge=this.config.Edge;this.animation=new c;this.nodeTypes=new Hypertree.Plot.NodeTypes;this.edgeTypes=new Hypertree.Plot.EdgeTypes},hyperline:function(n,t){var h=n.nodeFrom,c=n.nodeTo,a=n.data,u=h.pos.getc(),f=c.pos.getc(),i=this.computeArcThroughTwoPoints(u,f),e=t.getSize(),r=Math.min(e.width,e.height)/2;if(i.a>1e3||i.b>1e3||i.ratio>1e3)t.path("stroke",function(n){n.moveTo(u.x*r,u.y*r);n.lineTo(f.x*r,f.y*r)});else{var o=Math.atan2(f.y-i.y,f.x-i.x),s=Math.atan2(u.y-i.y,u.x-i.x),l=this.sense(o,s),v=t.getCtx();t.path("stroke",function(n){n.arc(i.x*r,i.y*r,i.ratio*r,o,s,l)})}},computeArcThroughTwoPoints:function(n,t){var u=n.x*t.y-n.y*t.x,c=u,f=n.squaredNorm(),e=t.squaredNorm(),s,h;if(u==0)return{x:0,y:0,ratio:1001};var i=(n.y*e-t.y*f+n.y-t.y)/u,r=(t.x*f-n.x*e+t.x-n.x)/c,l=-i/2,a=-r/2,o=(i*i+r*r)/4-1;return o<0?{x:0,y:0,ratio:1001}:(s=Math.sqrt(o),h={x:l,y:a,ratio:s,a:i,b:r},h)},sense:function(n,t){return n<t?n+Math.PI>t?!1:!0:t+Math.PI>n?!0:!1},placeLabel:function(n,t,i){var u=t.pos.getc(!0),s=this.viz.canvas,f=s.getSize(),e=t._scale,o={x:Math.round(u.x*e+f.width/2),y:Math.round(u.y*e+f.height/2)},r=n.style;r.left=o.x+"px";r.top=o.y+"px";r.display="";i.onPlaceLabel(n,t)}});Hypertree.Plot.NodeTypes=new i({none:function(){},circle:function(n,t){var i=this.node,u=n.data,r=i.overridable&&u&&u.$dim||i.dim,f=n.pos.getc(),e=f.scale(n._scale),o=i.transform?r*(1-f.squaredNorm()):r;o>=r/4&&t.path("fill",function(n){n.arc(e.x,e.y,o,0,Math.PI*2,!0)})},square:function(n,t){var r=this.node,f=n.data,u=r.overridable&&f&&f.$dim||r.dim,e=n.pos.getc(),o=e.scale(n._scale),i=r.transform?u*(1-e.squaredNorm()):u,s=2*i;i>=u/4&&t.getCtx().fillRect(o.x-i,o.y-i,s,s)},rectangle:function(n,t){var i=this.node,f=n.data,r=i.overridable&&f&&f.$width||i.width,u=i.overridable&&f&&f.$height||i.height,o=n.pos.getc(),s=o.scale(n._scale),e=1-o.squaredNorm();r=i.transform?r*e:r;u=i.transform?u*e:u;e>=.25&&t.getCtx().fillRect(s.x-r/2,s.y-u/2,r,u)},triangle:function(n,t){var r=this.node,o=n.data,u=r.overridable&&o&&o.$dim||r.dim,s=n.pos.getc(),f=s.scale(n._scale),i=r.transform?u*(1-s.squaredNorm()):u;if(i>=u/4){var e=f.x,c=f.y-i,l=e-i,h=f.y+i,a=e+i,v=h;t.path("fill",function(n){n.moveTo(e,c);n.lineTo(l,h);n.lineTo(a,v)})}},star:function(n,t){var f=this.node,o=n.data,r=f.overridable&&o&&o.$dim||f.dim,s=n.pos.getc(),h=s.scale(n._scale),e=f.transform?r*(1-s.squaredNorm()):r,i,c,u;if(e>=r/4){for(i=t.getCtx(),c=Math.PI/5,i.save(),i.translate(h.x,h.y),i.beginPath(),i.moveTo(r,0),u=0;u<9;u++)i.rotate(c),u%2==0?i.lineTo(e/.525731*.200811,0):i.lineTo(e,0);i.closePath();i.fill();i.restore()}}});Hypertree.Plot.EdgeTypes=new i({none:function(){},line:function(n,t){var i=n.nodeFrom._scale,r=n.nodeFrom.pos.getc(!0),u=n.nodeTo.pos.getc(!0);t.path("stroke",function(n){n.moveTo(r.x*i,r.y*i);n.lineTo(u.x*i,u.y*i)})},hyperline:function(n,t){this.hyperline(n,t)}});this.TM={layout:{orientation:"h",vertical:function(){return this.orientation=="v"},horizontal:function(){return this.orientation=="h"},change:function(){this.orientation=this.vertical()?"h":"v"}},innerController:{onBeforeCompute:n,onAfterCompute:n,onComplete:n,onCreateElement:n,onDestroyElement:n,request:!1},config:{orientation:"h",titleHeight:13,rootId:"infovis",offset:4,levelsToShow:3,addLeftClickHandler:!1,addRightClickHandler:!1,selectPathOnHover:!1,Color:{allow:!1,minValue:-100,maxValue:100,minColorValue:[255,0,50],maxColorValue:[0,255,50]},Tips:{allow:!1,offsetX:20,offsetY:20,onShow:n}},initialize:function(n){var i,r,f,u;this.tree=null;this.shownTree=null;this.controller=this.config=t(this.config,this.innerController,n);this.rootId=this.config.rootId;this.layout.orientation=this.config.orientation;this.config.Tips.allow&&document.body&&(i=document.getElementById("_tooltip")||document.createElement("div"),i.id="_tooltip",i.className="tip",r=i.style,r.position="absolute",r.display="none",r.zIndex=13e3,document.body.appendChild(i),this.tip=i);f=this;u=function(){f.empty();window.CollectGarbage&&window.CollectGarbage();delete u};window.addEventListener?window.addEventListener("unload",u,!1):window.attachEvent("onunload",u)},each:function(n){(function t(i){var r,u,e,f;if(i&&(r=i.childNodes,u=r.length,u>0&&n.apply(this,[i,u===1,r[0],r[1]]),u>1))for(e=r[1].childNodes,f=0;f<e.length;f++)t(e[f])})(s(this.rootId).firstChild)},toStyle:function(n){var t="";for(var i in n)t+=i+":"+n[i]+";";return t},leaf:function(n){return n.children==0},createBox:function(n,t,i){var r;return r=this.leaf(n)?this.leafBox(n,t):this.headBox(n,t)+this.bodyBox(i,t),this.contentBox(n,t,r)},plot:function(n){var f=n.coord,e="",t,i,r,u;if(this.leaf(n))return this.createBox(n,f,null);for(t=0,i=n.children;t<i.length;t++)r=i[t],u=r.coord,u.width*u.height>1&&(e+=this.plot(r));return this.createBox(n,f,e)},headBox:function(n,t){var i=this.config,r=i.offset,u={height:i.titleHeight+"px",width:t.width-r+"px",left:r/2+"px"};return'<div class="head" style="'+this.toStyle(u)+'">'+n.name+"<\/div>"},bodyBox:function(n,t){var r=this.config,u=r.titleHeight,i=r.offset,f={width:t.width-i+"px",height:t.height-i-u+"px",top:u+i/2+"px",left:i/2+"px"};return'<div class="body" style="'+this.toStyle(f)+'">'+n+"<\/div>"},contentBox:function(n,t,i){var r={};for(var u in t)r[u]=t[u]+"px";return'<div class="content" style="'+this.toStyle(r)+'" id="'+n.id+'">'+i+"<\/div>"},leafBox:function(n,t){var r=this.config,u=r.Color.allow&&this.setColor(n),i=r.offset,e=t.width-i,o=t.height-i,f={top:i/2+"px",height:o+"px",width:e+"px",left:i/2+"px"};return u&&(f["background-color"]=u),'<div class="leaf" style="'+this.toStyle(f)+'">'+n.name+"<\/div>"},setColor:function(n){var t=this.config.Color,e=t.maxColorValue,u=t.minColorValue,o=t.maxValue,f=t.minValue,s=o-f,i=n.data.$color-0,r=function(n,t){return Math.round((e[n]-u[n])/s*(t-f)+u[n])};return nt([r(0,i),r(1,i),r(2,i)])},enter:function(n){this.view(n.parentNode.id)},onLeftClick:function(n){this.enter(n)},out:function(){var n=TreeUtil.getParent(this.tree,this.shownTree.id);n&&(this.controller.request&&TreeUtil.prune(n,this.config.levelsToShow),this.view(n.id))},onRightClick:function(){this.out()},view:function(n){var u=this.config,f=this,r={onComplete:function(){f.loadTree(n);s(u.rootId).focus()}},i;this.controller.request?(i=TreeUtil,i.loadSubtrees(i.getSubtree(this.tree,n),t(this.controller,r))):r.onComplete()},resetPath:function(n){function t(n){var t=n.parentNode;return t&&t.id!=r&&t}function i(n,i){var u,r;if(n&&(u=s(n.id),u))for(r=t(u);r;)n=r.childNodes[0],d(n,"in-path")?i!=undefined&&!i||v(n,"in-path"):i||a(n,"in-path"),r=t(r)}var r=this.rootId,u=this.resetPath.previous;this.resetPath.previous=n||!1;i(u,!0);i(n,!1)},initializeElements:function(){var n=this.controller,t=this,r=p(!1),i=n.Tips.allow;this.each(function(u,f,e,o){var s=TreeUtil.getSubtree(t.tree,u.id);n.onCreateElement(u,s,f,e,o);n.addRightClickHandler&&(e.oncontextmenu=r);(n.addLeftClickHandler||n.addRightClickHandler)&&l(e,"mouseup",function(i){var r=i.which==3||i.button==2;if(r)n.addRightClickHandler&&t.onRightClick();else if(n.addLeftClickHandler)t.onLeftClick(e);i.preventDefault?i.preventDefault():i.returnValue=!1});(n.selectPathOnHover||i)&&(l(e,"mouseover",function(){if(n.selectPathOnHover&&(f?a(e,"over-leaf"):(a(e,"over-head"),a(u,"over-content")),u.id&&t.resetPath(s)),i)n.Tips.onShow(t.tip,s,f,e)}),l(e,"mouseout",function(){n.selectPathOnHover&&(f?v(e,"over-leaf"):(v(e,"over-head"),v(u,"over-content")),t.resetPath());i&&(t.tip.style.display="none")}),i&&l(e,"mousemove",function(i,r){var e=t.tip,f,u;r=r||window;i=i||r.event;f=r.document;f=f.html||f.body;u={x:i.pageX||i.clientX+f.scrollLeft,y:i.pageY||i.clientY+f.scrollTop};e.style.display="";r={height:document.body.clientHeight,width:document.body.clientWidth};var o={width:e.offsetWidth,height:e.offsetHeight},c=e.style,s=n.Tips.offsetX,h=n.Tips.offsetY;c.top=(u.y+h+o.height>r.height?u.y-o.height-h:u.y+h)+"px";c.left=(u.x+o.width+s>r.width?u.x-o.width-s:u.x+s)+"px"}))})},destroyElements:function(){if(this.controller.onDestroyElement!=n){var t=this.controller,i=this;this.each(function(n,r,u,f){t.onDestroyElement(n,TreeUtil.getSubtree(i.tree,n.id),r,u,f)})}},empty:function(){this.destroyElements();k(s(this.rootId))},loadTree:function(n){this.empty();this.loadJSON(TreeUtil.getSubtree(this.tree,n))}};TM.SliceAndDice=new i({Implements:TM,loadJSON:function(n){this.controller.onBeforeCompute(n);var t=s(this.rootId),i=this.config,r=t.offsetWidth,u=t.offsetHeight,f={coord:{top:0,left:0,width:r,height:u+i.titleHeight+i.offset}};this.tree==null&&(this.tree=n);this.shownTree=n;this.compute(f,n,this.layout.orientation);t.innerHTML=this.plot(n);this.initializeElements();this.controller.onAfterCompute(n)},compute:function(n,t,i){var l=this.config,a=n.coord,v=l.offset,y=a.width-v,p=a.height-v-l.titleHeight,u=n.data,w=u&&"$area"in u?t.data.$area/u.$area:1,f,e,o,s,h,k=i=="h",c,b;k?(i="v",f=p,e=Math.round(y*w),o="height",s="top",h="left"):(i="h",f=Math.round(p*w),e=y,o="width",s="left",h="top");t.coord={width:e,height:f,top:0,left:0};c=0;b=this;r(t.children,function(n){b.compute(t,n,i);n.coord[s]=c;n.coord[h]=0;c+=Math.floor(n.coord[o])})}});TM.Area=new i({loadJSON:function(n){var e;this.controller.onBeforeCompute(n);var i=s(this.rootId),r=i.offsetWidth,u=i.offsetHeight,f=this.config.offset,o=r-f,h=u-f-this.config.titleHeight;n.coord={height:u,width:r,top:0,left:0};e=t(n.coord,{width:o,height:h});this.compute(n,e);i.innerHTML=this.plot(n);this.tree==null&&(this.tree=n);this.shownTree=n;this.initializeElements();this.controller.onAfterCompute(n)},computeDim:function(n,t,i,r,u){var o,f,e;if(n.length+t.length==1){o=n.length==1?n:t;this.layoutLast(o,i,r);return}if(n.length>=2&&t.length==0&&(t=[n[0]],n=n.slice(1)),n.length==0){t.length>0&&this.layoutRow(t,i,r);return}f=n[0];u(t,i)>=u([f].concat(t),i)?this.computeDim(n.slice(1),t.concat([f]),i,r,u):(e=this.layoutRow(t,i,r),this.computeDim(n,[],e.dim,e,u))},worstAspectRatio:function(n,t){var f,i,o,s;if(!n||n.length==0)return Number.MAX_VALUE;var e=0,r=0,u=Number.MAX_VALUE;for(f=0;f<n.length;f++)i=n[f]._area,e+=i,u=u<i?u:i,r=r>i?r:i;return o=t*t,s=e*e,Math.max(o*r/s,s/(o*u))},avgAspectRatio:function(n,t){var u,i,f,r;if(!n||n.length==0)return Number.MAX_VALUE;for(u=0,i=0;i<n.length;i++)f=n[i]._area,r=f/t,u+=t>r?t/r:r/t;return u/n.length},layoutLast:function(n,t,i){n[0].coord=i}});TM.Squarified=new i({Implements:[TM,TM.Area],compute:function(n,t){var i,u,r;if(t.width>=t.height&&this.layout.horizontal()||this.layout.change(),i=n.children,u=this.config,i.length>0)for(this.processChildrenLayout(n,i,t),r=0;r<i.length;r++){var f=i[r].coord,e=u.offset,o=f.height-(u.titleHeight+e),s=f.width-e;t={width:s,height:o,top:0,left:0};this.compute(i[r],t)}},processChildrenLayout:function(n,t,i){for(var h=i.width*i.height,f=0,u=[],e,o,s,r=0;r<t.length;r++)u[r]=parseFloat(t[r].data.$area),f+=u[r];for(r=0;r<u.length;r++)t[r]._area=h*u[r]/f;e=this.layout.horizontal()?i.height:i.width;t.sort(function(n,t){return(n._area<=t._area)-(n._area>=t._area)});o=[t[0]];s=t.slice(1);this.squarify(s,o,e,i)},squarify:function(n,t,i,r){this.computeDim(n,t,i,r,this.worstAspectRatio)},layoutRow:function(n,t,i){return this.layout.horizontal()?this.layoutV(n,t,i):this.layoutH(n,t,i)},layoutV:function(n,t,i){var h=0,c=Math.round,f,o,e,s,u;for(r(n,function(n){h+=n._area}),f=c(h/t),o=0,e=0;e<n.length;e++)s=c(n[e]._area/f),n[e].coord={height:s,width:f,top:i.top+o,left:i.left},o+=s;return u={height:i.height,width:i.width-f,top:i.top,left:i.left+f},u.dim=Math.min(u.width,u.height),u.dim!=u.height&&this.layout.change(),u},layoutH:function(n,t,i){var o=0,s=Math.round,f,u;r(n,function(n){o+=n._area});var e=s(o/t),c=i.top,h=0;for(f=0;f<n.length;f++)n[f].coord={height:e,width:s(n[f]._area/e),top:c,left:i.left+h},h+=n[f].coord.width;return u={height:i.height-e,width:i.width,top:i.top+e,left:i.left},u.dim=Math.min(u.width,u.height),u.dim!=u.width&&this.layout.change(),u}});TM.Strip=new i({Implements:[TM,TM.Area],compute:function(n,t){var i=n.children,u=this.config,r;if(i.length>0)for(this.processChildrenLayout(n,i,t),r=0;r<i.length;r++){var f=i[r].coord,e=u.offset,o=f.height-(u.titleHeight+e),s=f.width-e;t={width:s,height:o,top:0,left:0};this.compute(i[r],t)}},processChildrenLayout:function(n,t,i){var u=i.width*i.height,f=parseFloat(n.data.$area);r(t,function(n){n._area=u*parseFloat(n.data.$area)/f});var e=this.layout.horizontal()?i.width:i.height,o=[t[0]],s=t.slice(1);this.stripify(s,o,e,i)},stripify:function(n,t,i,r){this.computeDim(n,t,i,r,this.avgAspectRatio)},layoutRow:function(n,t,i){return this.layout.horizontal()?this.layoutH(n,t,i):this.layoutV(n,t,i)},layoutV:function(n,t,i){var s=0,h=function(n){return n},u,o,f,e;for(r(n,function(n){s+=n._area}),u=h(s/t),o=0,f=0;f<n.length;f++)e=h(n[f]._area/u),n[f].coord={height:e,width:u,top:i.top+(t-e-o),left:i.left},o+=e;return{height:i.height,width:i.width-u,top:i.top,left:i.left+u,dim:t}},layoutH:function(n,t,i){var e=0,o=function(n){return n},u;r(n,function(n){e+=n._area});var f=o(e/t),h=i.height-f,s=0;for(u=0;u<n.length;u++)n[u].coord={height:f,width:o(n[u]._area/f),top:h,left:i.left+s},s+=n[u].coord.width;return{height:i.height-f,width:i.width,top:i.top,left:i.left,dim:t}}})})();
