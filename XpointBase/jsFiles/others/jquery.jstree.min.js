(function(n){n&&n.jstree||function(t){"use strict";typeof define=="function"&&define.amd?define(["jquery"],t):typeof exports=="object"?t(require("jquery")):t(n)}(function(t,i){"use strict";var l,a,e;if(!t.jstree){var p=0,f=!1,u=!1,o=!1,y=[],v=t("script:last").attr("src"),h=document,c=h.createElement("LI"),r,s;c.setAttribute("role","treeitem");r=h.createElement("I");r.className="jstree-icon jstree-ocl";r.setAttribute("role","presentation");c.appendChild(r);r=h.createElement("A");r.className="jstree-anchor";r.setAttribute("href","#");r.setAttribute("tabindex","-1");s=h.createElement("I");s.className="jstree-icon jstree-themeicon";s.setAttribute("role","presentation");r.appendChild(s);c.appendChild(r);r=s=null;t.jstree={version:"3.0.8",defaults:{plugins:[]},plugins:{},path:v&&v.indexOf("/")!==-1?v.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%]/g};t.jstree.create=function(n,i){var r=new t.jstree.core(++p),u=i;return i=t.extend(!0,{},t.jstree.defaults,i),u&&u.plugins&&(i.plugins=u.plugins),t.each(i.plugins,function(n,t){n!=="core"&&(r=r.plugin(t,i[t]))}),r.init(n,i),r};t.jstree.destroy=function(){t(".jstree:jstree").jstree("destroy");t(document).off(".jstree")};t.jstree.core=function(n){this._id=n;this._cnt=0;this._wrk=null;this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}};t.jstree.reference=function(n){var r=null,i=null;if(n&&n.id&&(n=n.id),!i||!i.length)try{i=t(n)}catch(u){}if(!i||!i.length)try{i=t("#"+n.replace(t.jstree.idregex,"\\$&"))}catch(u){}return i&&i.length&&(i=i.closest(".jstree")).length&&(i=i.data("jstree"))?r=i:t(".jstree").each(function(){var i=t(this).data("jstree");if(i&&i._model.data[n])return r=i,!1}),r};t.fn.jstree=function(n){var u=typeof n=="string",f=Array.prototype.slice.call(arguments,1),r=null;return n===!0&&!this.length?!1:(this.each(function(){var e=t.jstree.reference(this),o=u&&e?e[n]:null;return r=u&&o?o.apply(e,f):null,e||u||n!==i&&!t.isPlainObject(n)||t(this).data("jstree",new t.jstree.create(this,n)),(e&&!u||n===!0)&&(r=e||!1),r!==null&&r!==i?!1:void 0}),r!==null&&r!==i?r:this)};t.expr[":"].jstree=t.expr.createPseudo(function(){return function(n){return t(n).hasClass("jstree")&&t(n).data("jstree")!==i}});t.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:t.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1};t.jstree.core.prototype={plugin:function(n,i){var r=t.jstree.plugins[n];return r?(this._data[n]={},r.prototype=this,new r(i,this)):this},init:function(n,i){this._model={data:{"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}};this.element=t(n).addClass("jstree jstree-"+this._id);this.settings=i;this.element.bind("destroyed",t.proxy(this.teardown,this));this._data.core.ready=!1;this._data.core.loaded=!1;this._data.core.rtl=this.element.css("direction")==="rtl";this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl");this.element.attr("role","tree");this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0);this.element.attr("tabindex")||this.element.attr("tabindex","0");this.bind();this.trigger("init");this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0);this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return this.nodeType===3&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove();this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'><\/i><a class='jstree-anchor' href='#'><i class='jstree-icon '><\/i>"+this.get_string("Loading ...")+"<\/a><\/li><\/ul>");this.element.attr("aria-activedescendant","j"+this._id+"_loading");this._data.core.li_height=this.get_container_ul().children("li").first().height()||24;this.trigger("loading");this.load_node("#")},destroy:function(n){if(this._wrk)try{window.URL.revokeObjectURL(this._wrk);this._wrk=null}catch(t){}n||this.element.empty();this.element.unbind("destroyed",this.teardown);this.teardown()},teardown:function(){this.unbind();this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/ig,"")});this.element=null},bind:function(){var n="",i=null;this.element.on("dblclick.jstree",function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var n=window.getSelection();try{n.removeAllRanges();n.collapse()}catch(t){}}}).on("click.jstree",".jstree-ocl",t.proxy(function(n){this.toggle_node(n.target)},this)).on("click.jstree",".jstree-anchor",t.proxy(function(n){n.preventDefault();n.currentTarget!==document.activeElement&&t(n.currentTarget).focus();this.activate_node(n.currentTarget,n)},this)).on("keydown.jstree",".jstree-anchor",t.proxy(function(n){if(n.target.tagName==="INPUT")return!0;var i=null;this._data.core.rtl&&(n.which===37?n.which=39:n.which===39&&(n.which=37));switch(n.which){case 32:n.ctrlKey&&(n.type="click",t(n.currentTarget).trigger(n));break;case 13:n.type="click";t(n.currentTarget).trigger(n);break;case 37:n.preventDefault();this.is_open(n.currentTarget)?this.close_node(n.currentTarget):(i=this.get_parent(n.currentTarget),i&&i.id!=="#"&&this.get_node(i,!0).children(".jstree-anchor").focus());break;case 38:n.preventDefault();i=this.get_prev_dom(n.currentTarget);i&&i.length&&i.children(".jstree-anchor").focus();break;case 39:n.preventDefault();this.is_closed(n.currentTarget)?this.open_node(n.currentTarget,function(n){this.get_node(n,!0).children(".jstree-anchor").focus()}):this.is_open(n.currentTarget)&&(i=this.get_node(n.currentTarget,!0).children(".jstree-children")[0],i&&t(this._firstChild(i)).children(".jstree-anchor").focus());break;case 40:n.preventDefault();i=this.get_next_dom(n.currentTarget);i&&i.length&&i.children(".jstree-anchor").focus();break;case 106:this.open_all();break;case 36:n.preventDefault();i=this._firstChild(this.get_container_ul()[0]);i&&t(i).children(".jstree-anchor").filter(":visible").focus();break;case 35:n.preventDefault();this.element.find(".jstree-anchor").filter(":visible").last().focus()}},this)).on("load_node.jstree",t.proxy(function(n,i){if(i.status&&(i.node.id!=="#"||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),!this._data.core.ready&&!this.get_container_ul().find(".jstree-loading").length)){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){for(var u=[],r=0,f=this._data.core.selected.length;r<f;r++)u=u.concat(this._model.data[this._data.core.selected[r]].parents);for(u=t.vakata.array_unique(u),r=0,f=u.length;r<f;r++)this.open_node(u[r],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}setTimeout(t.proxy(function(){this.trigger("ready")},this),0)}},this)).on("keypress.jstree",t.proxy(function(r){if(r.target.tagName==="INPUT")return!0;i&&clearTimeout(i);i=setTimeout(function(){n=""},500);var e=String.fromCharCode(r.which).toLowerCase(),f=this.element.find(".jstree-anchor").filter(":visible"),o=f.index(document.activeElement)||0,u=!1;if(n+=e,n.length>1){if(f.slice(o).each(t.proxy(function(i,r){if(t(r).text().toLowerCase().indexOf(n)===0)return t(r).focus(),u=!0,!1},this)),u)return;if(f.slice(0,o).each(t.proxy(function(i,r){if(t(r).text().toLowerCase().indexOf(n)===0)return t(r).focus(),u=!0,!1},this)),u)return}if(new RegExp("^"+e+"+$").test(n)){if(f.slice(o+1).each(t.proxy(function(n,i){if(t(i).text().toLowerCase().charAt(0)===e)return t(i).focus(),u=!0,!1},this)),u)return;if(f.slice(0,o+1).each(t.proxy(function(n,i){if(t(i).text().toLowerCase().charAt(0)===e)return t(i).focus(),u=!0,!1},this)),u)return}},this)).on("init.jstree",t.proxy(function(){var n=this.settings.core.themes;this._data.core.themes.dots=n.dots;this._data.core.themes.stripes=n.stripes;this._data.core.themes.icons=n.icons;this.set_theme(n.name||"default",n.url);this.set_theme_variant(n.variant)},this)).on("loading.jstree",t.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"]();this[this._data.core.themes.icons?"show_icons":"hide_icons"]();this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",t.proxy(function(n){this._data.core.focused=null;t(n.currentTarget).filter(".jstree-hovered").mouseleave()},this)).on("focus.jstree",".jstree-anchor",t.proxy(function(n){var i=this.get_node(n.currentTarget);i&&i.id&&(this._data.core.focused=i.id);this.element.find(".jstree-hovered").not(n.currentTarget).mouseleave();t(n.currentTarget).mouseenter()},this)).on("focus.jstree",t.proxy(function(){this._data.core.focused||this.get_node(this.element.attr("aria-activedescendant"),!0).find("> .jstree-anchor").focus()},this)).on("mouseenter.jstree",".jstree-anchor",t.proxy(function(n){this.hover_node(n.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",t.proxy(function(n){this.dehover_node(n.currentTarget)},this))},unbind:function(){this.element.off(".jstree");t(document).off(".jstree-"+this._id)},trigger:function(n,t){t||(t={});t.instance=this;this.element.triggerHandler(n.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(n){var i=this.settings.core.strings;return t.isFunction(i)?i.call(this,n):i&&i[n]?i[n]:n},_firstChild:function(n){for(n=n?n.firstChild:null;n!==null&&n.nodeType!==1;)n=n.nextSibling;return n},_nextSibling:function(n){for(n=n?n.nextSibling:null;n!==null&&n.nodeType!==1;)n=n.nextSibling;return n},_previousSibling:function(n){for(n=n?n.previousSibling:null;n!==null&&n.nodeType!==1;)n=n.previousSibling;return n},get_node:function(n,i){n&&n.id&&(n=n.id);var r;try{if(this._model.data[n])n=this._model.data[n];else if(typeof n=="string"&&this._model.data[n.replace(/^#/,"")])n=this._model.data[n.replace(/^#/,"")];else if(typeof n=="string"&&(r=t("#"+n.replace(t.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])n=this._model.data[r.closest(".jstree-node").attr("id")];else if((r=t(n,this.element)).length&&this._model.data[r.closest(".jstree-node").attr("id")])n=this._model.data[r.closest(".jstree-node").attr("id")];else if((r=t(n,this.element)).length&&r.hasClass("jstree"))n=this._model.data["#"];else return!1;return i&&(n=n.id==="#"?this.element:t("#"+n.id.replace(t.jstree.idregex,"\\$&"),this.element)),n}catch(u){return!1}},get_path:function(n,t,i){if(n=n.parents?n:this.get_node(n),!n||n.id==="#"||!n.parents)return!1;var u,f,r=[];for(r.push(i?n.id:n.text),u=0,f=n.parents.length;u<f;u++)r.push(i?n.parents[u]:this.get_text(n.parents[u]));return r=r.reverse().slice(1),t?r.join(t):r},get_next_dom:function(n,i){var r;if(n=this.get_node(n,!0),n[0]===this.element[0]){for(r=this._firstChild(this.get_container_ul()[0]);r&&r.offsetHeight===0;)r=this._nextSibling(r);return r?t(r):!1}if(!n||!n.length)return!1;if(i){r=n[0];do r=this._nextSibling(r);while(r&&r.offsetHeight===0);return r?t(r):!1}if(n.hasClass("jstree-open")){for(r=this._firstChild(n.children(".jstree-children")[0]);r&&r.offsetHeight===0;)r=this._nextSibling(r);if(r!==null)return t(r)}r=n[0];do r=this._nextSibling(r);while(r&&r.offsetHeight===0);return r!==null?t(r):n.parentsUntil(".jstree",".jstree-node").next(".jstree-node:visible").first()},get_prev_dom:function(n,i){var r;if(n=this.get_node(n,!0),n[0]===this.element[0]){for(r=this.get_container_ul()[0].lastChild;r&&r.offsetHeight===0;)r=this._previousSibling(r);return r?t(r):!1}if(!n||!n.length)return!1;if(i){r=n[0];do r=this._previousSibling(r);while(r&&r.offsetHeight===0);return r?t(r):!1}r=n[0];do r=this._previousSibling(r);while(r&&r.offsetHeight===0);if(r!==null){for(n=t(r);n.hasClass("jstree-open");)n=n.children(".jstree-children").first().children(".jstree-node:visible:last");return n}return r=n[0].parentNode.parentNode,r&&r.className&&r.className.indexOf("jstree-node")!==-1?t(r):!1},get_parent:function(n){return(n=this.get_node(n),!n||n.id==="#")?!1:n.parent},get_children_dom:function(n){return(n=this.get_node(n,!0),n[0]===this.element[0])?this.get_container_ul().children(".jstree-node"):!n||!n.length?!1:n.children(".jstree-children").children(".jstree-node")},is_parent:function(n){return n=this.get_node(n),n&&(n.state.loaded===!1||n.children.length>0)},is_loaded:function(n){return n=this.get_node(n),n&&n.state.loaded},is_loading:function(n){return n=this.get_node(n),n&&n.state&&n.state.loading},is_open:function(n){return n=this.get_node(n),n&&n.state.opened},is_closed:function(n){return n=this.get_node(n),n&&this.is_parent(n)&&!n.state.opened},is_leaf:function(n){return!this.is_parent(n)},load_node:function(n,i){var r,f,u,e,o;if(t.isArray(n))return this._load_nodes(n.slice(),i),!0;if(n=this.get_node(n),!n)return i&&i.call(this,n,!1),!1;if(n.state.loaded){for(n.state.loaded=!1,r=0,f=n.children_d.length;r<f;r++){for(u=0,e=n.parents.length;u<e;u++)this._model.data[n.parents[u]].children_d=t.vakata.array_remove_item(this._model.data[n.parents[u]].children_d,n.children_d[r]);this._model.data[n.children_d[r]].state.selected&&(o=!0,this._data.core.selected=t.vakata.array_remove_item(this._data.core.selected,n.children_d[r]));delete this._model.data[n.children_d[r]]}n.children=[];n.children_d=[];o&&this.trigger("changed",{action:"load_node",node:n,selected:this._data.core.selected})}return n.state.loading=!0,this.get_node(n,!0).addClass("jstree-loading").attr("aria-busy",!0),this._load_node(n,t.proxy(function(t){n=this._model.data[n.id];n.state.loading=!1;n.state.loaded=t;var r=this.get_node(n,!0);n.state.loaded&&!n.children.length&&r&&r.length&&!r.hasClass("jstree-leaf")&&r.removeClass("jstree-closed jstree-open").addClass("jstree-leaf");r.removeClass("jstree-loading").attr("aria-busy",!1);this.trigger("load_node",{node:n,status:t});i&&i.call(this,n,t)},this)),!0},_load_nodes:function(n,t,i){for(var u=!0,o=function(){this._load_nodes(n,t,!0)},f=this._model.data,r=0,e=n.length;r<e;r++)!f[n[r]]||f[n[r]].state.loaded&&i||(this.is_loading(n[r])||this.load_node(n[r],o),u=!1);u&&t&&!t.done&&(t.call(this,n),t.done=!0)},load_all:function(n,t){if(n||(n="#"),n=this.get_node(n),!n)return!1;var u=[],f=this._model.data,r=f[n.id].children_d,i,e;for(n.state&&!n.state.loaded&&u.push(n.id),i=0,e=r.length;i<e;i++)f[r[i]]&&f[r[i]].state&&!f[r[i]].state.loaded&&u.push(r[i]);u.length?this._load_nodes(u,function(){this.load_all(n,t)}):(t&&t.call(this,n),this.trigger("load_all",{node:n}))},_load_node:function(n,i){var r=this.settings.core.data,u;return r?t.isFunction(r)?r.call(this,n,t.proxy(function(r){r===!1&&i.call(this,!1);this[typeof r=="string"?"_append_html_data":"_append_json_data"](n,typeof r=="string"?t(r):r,function(n){i.call(this,n)})},this)):typeof r=="object"?r.url?(r=t.extend(!0,{},r),t.isFunction(r.url)&&(r.url=r.url.call(this,n)),t.isFunction(r.data)&&(r.data=r.data.call(this,n)),t.ajax(r).done(t.proxy(function(r,u,f){var e=f.getResponseHeader("Content-Type");return e.indexOf("json")!==-1||typeof r=="object"?this._append_json_data(n,r,function(n){i.call(this,n)}):e.indexOf("html")!==-1||typeof r=="string"?this._append_html_data(n,t(r),function(n){i.call(this,n)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:n.id,xhr:f})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))},this)).fail(t.proxy(function(t){i.call(this,!1);this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:n.id,xhr:t})};this.settings.core.error.call(this,this._data.core.last_error)},this))):(u=t.isArray(r)||t.isPlainObject(r)?JSON.parse(JSON.stringify(r)):r,n.id==="#"?this._append_json_data(n,u,function(n){i.call(this,n)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:n.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))):typeof r=="string"?n.id==="#"?this._append_html_data(n,t(r),function(n){i.call(this,n)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:n.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1)):i.call(this,!1):n.id==="#"?this._append_html_data(n,this._data.core.original_container_html.clone(!0),function(n){i.call(this,n)}):i.call(this,!1)},_node_changed:function(n){n=this.get_node(n);n&&this._model.changed.push(n.id)},_append_html_data:function(n,i,r){n=this.get_node(n);n.children=[];n.children_d=[];var a=i.is("ul")?i.children():i,o=n.id,c=[],u=[],s=this._model.data,f=s[o],v=this._data.core.selected.length,e,h,l;for(a.each(t.proxy(function(n,i){e=this._parse_model_from_html(t(i),o,f.parents.concat());e&&(c.push(e),u.push(e),s[e].children_d.length&&(u=u.concat(s[e].children_d)))},this)),f.children=c,f.children_d=u,h=0,l=f.parents.length;h<l;h++)s[f.parents[h]].children_d=s[f.parents[h]].children_d.concat(u);this.trigger("model",{nodes:u,parent:o});o!=="#"?(this._node_changed(o),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0));this._data.core.selected.length!==v&&this.trigger("changed",{action:"model",selected:this._data.core.selected});r.call(this,!0)},_append_json_data:function(n,i,r,u){n=this.get_node(n);n.children=[];n.children_d=[];i.d&&(i=i.d,typeof i=="string"&&(i=JSON.parse(i)));t.isArray(i)||(i=[i]);var f=null,e={df:this._model.default_state,dat:i,par:n.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},o=function(n,t){n.data&&(n=n.data);var u=n.dat,c=n.par,y=[],o=[],l=[],h=n.df,k=n.t_id,v=n.t_cnt,r=n.m,f=r[c],p=n.sel,s,i,e,a,w=function(n,i,u){u=u?u.concat():[];i&&u.unshift(i);var c=n.id.toString(),f,a,o,s,e={id:c,text:n.text||"",icon:n.icon!==t?n.icon:!0,parent:i,parents:u,children:n.children||[],children_d:n.children_d||[],data:n.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(f in h)h.hasOwnProperty(f)&&(e.state[f]=h[f]);if(n&&n.data&&n.data.jstree&&n.data.jstree.icon&&(e.icon=n.data.jstree.icon),n&&n.data&&(e.data=n.data,n.data.jstree))for(f in n.data.jstree)n.data.jstree.hasOwnProperty(f)&&(e.state[f]=n.data.jstree[f]);if(n&&typeof n.state=="object")for(f in n.state)n.state.hasOwnProperty(f)&&(e.state[f]=n.state[f]);if(n&&typeof n.li_attr=="object")for(f in n.li_attr)n.li_attr.hasOwnProperty(f)&&(e.li_attr[f]=n.li_attr[f]);if(e.li_attr.id||(e.li_attr.id=c),n&&typeof n.a_attr=="object")for(f in n.a_attr)n.a_attr.hasOwnProperty(f)&&(e.a_attr[f]=n.a_attr[f]);for(n&&n.children&&n.children===!0&&(e.state.loaded=!1,e.children=[],e.children_d=[]),r[e.id]=e,f=0,a=e.children.length;f<a;f++)o=w(r[e.children[f]],e.id,u),s=r[o],e.children_d.push(o),s.children_d.length&&(e.children_d=e.children_d.concat(s.children_d));return delete n.data,delete n.children,r[e.id].original=n,e.state.selected&&l.push(e.id),e.id},b=function(n,i,u){u=u?u.concat():[];i&&u.unshift(i);var o=!1,e,a,s,c,f;do o="j"+k+"_"+ ++v;while(r[o]);f={id:!1,text:typeof n=="string"?n:"",icon:typeof n=="object"&&n.icon!==t?n.icon:!0,parent:i,parents:u,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(e in h)h.hasOwnProperty(e)&&(f.state[e]=h[e]);if(n&&n.id&&(f.id=n.id.toString()),n&&n.text&&(f.text=n.text),n&&n.data&&n.data.jstree&&n.data.jstree.icon&&(f.icon=n.data.jstree.icon),n&&n.data&&(f.data=n.data,n.data.jstree))for(e in n.data.jstree)n.data.jstree.hasOwnProperty(e)&&(f.state[e]=n.data.jstree[e]);if(n&&typeof n.state=="object")for(e in n.state)n.state.hasOwnProperty(e)&&(f.state[e]=n.state[e]);if(n&&typeof n.li_attr=="object")for(e in n.li_attr)n.li_attr.hasOwnProperty(e)&&(f.li_attr[e]=n.li_attr[e]);if(f.li_attr.id&&!f.id&&(f.id=f.li_attr.id.toString()),f.id||(f.id=o),f.li_attr.id||(f.li_attr.id=f.id),n&&typeof n.a_attr=="object")for(e in n.a_attr)n.a_attr.hasOwnProperty(e)&&(f.a_attr[e]=n.a_attr[e]);if(n&&n.children&&n.children.length){for(e=0,a=n.children.length;e<a;e++)s=b(n.children[e],f.id,u),c=r[s],f.children.push(s),c.children_d.length&&(f.children_d=f.children_d.concat(c.children_d));f.children_d=f.children_d.concat(f.children)}return n&&n.children&&n.children===!0&&(f.state.loaded=!1,f.children=[],f.children_d=[]),delete n.data,delete n.children,f.original=n,r[f.id]=f,f.state.selected&&l.push(f.id),f.id};if(u.length&&u[0].id!==t&&u[0].parent!==t){for(i=0,e=u.length;i<e;i++)u[i].children||(u[i].children=[]),r[u[i].id.toString()]=u[i];for(i=0,e=u.length;i<e;i++)r[u[i].parent.toString()].children.push(u[i].id.toString()),f.children_d.push(u[i].id.toString());for(i=0,e=f.children.length;i<e;i++)s=w(r[f.children[i]],c,f.parents.concat()),o.push(s),r[s].children_d.length&&(o=o.concat(r[s].children_d));for(i=0,e=f.parents.length;i<e;i++)r[f.parents[i]].children_d=r[f.parents[i]].children_d.concat(o);a={cnt:v,mod:r,sel:p,par:c,dpc:o,add:l}}else{for(i=0,e=u.length;i<e;i++)s=b(u[i],c,f.parents.concat()),s&&(y.push(s),o.push(s),r[s].children_d.length&&(o=o.concat(r[s].children_d)));for(f.children=y,f.children_d=o,i=0,e=f.parents.length;i<e;i++)r[f.parents[i]].children_d=r[f.parents[i]].children_d.concat(o);a={cnt:v,mod:r,sel:p,par:c,dpc:o,add:l}}if(typeof window=="undefined"||typeof document=="undefined")postMessage(a);else return a},s=function(n,i){if(this._cnt=n.cnt,this._model.data=n.mod,i){var u,o,h=n.add,f=n.sel,e=this._data.core.selected.slice(),s=this._model.data;if(f.length!==e.length||t.vakata.array_unique(f.concat(e)).length!==f.length){for(u=0,o=f.length;u<o;u++)t.inArray(f[u],h)===-1&&t.inArray(f[u],e)===-1&&(s[f[u]].state.selected=!1);for(u=0,o=e.length;u<o;u++)t.inArray(e[u],f)===-1&&(s[e[u]].state.selected=!0)}}n.add.length&&(this._data.core.selected=this._data.core.selected.concat(n.add));this.trigger("model",{nodes:n.dpc,parent:n.par});n.par!=="#"?(this._node_changed(n.par),this.redraw()):this.redraw(!0);n.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected});r.call(this,!0)};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{this._wrk===null&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+o.toString()],{type:"text/javascript"})));!this._data.core.working||u?(this._data.core.working=!0,f=new window.Worker(this._wrk),f.onmessage=t.proxy(function(n){s.call(this,n.data,!0);try{f.terminate();f=null}catch(t){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),e.par?f.postMessage(e):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([n,i,r,!0])}catch(h){s.call(this,o(e),!1);this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else s.call(this,o(e),!1)},_parse_model_from_html:function(n,i,r){r=r?[].concat(r):[];i&&r.unshift(i);var o,s,c=this._model.data,u={id:!1,text:!1,icon:!0,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},e,f,h;for(e in this._model.default_state)this._model.default_state.hasOwnProperty(e)&&(u.state[e]=this._model.default_state[e]);if(f=t.vakata.attributes(n,!0),t.each(f,function(n,i){if(i=t.trim(i),!i.length)return!0;u.li_attr[n]=i;n==="id"&&(u.id=i.toString())}),f=n.children("a").first(),f.length&&(f=t.vakata.attributes(f,!0),t.each(f,function(n,i){i=t.trim(i);i.length&&(u.a_attr[n]=i)})),f=n.children("a").first().length?n.children("a").first().clone():n.clone(),f.children("ins, i, ul").remove(),f=f.html(),f=t("<div />").html(f),u.text=this.settings.core.force_text?f.text():f.html(),f=n.data(),u.data=f?t.extend(!0,{},f):null,u.state.opened=n.hasClass("jstree-open"),u.state.selected=n.children("a").hasClass("jstree-clicked"),u.state.disabled=n.children("a").hasClass("jstree-disabled"),u.data&&u.data.jstree)for(e in u.data.jstree)u.data.jstree.hasOwnProperty(e)&&(u.state[e]=u.data.jstree[e]);f=n.children("a").children(".jstree-themeicon");f.length&&(u.icon=f.hasClass("jstree-themeicon-hidden1")?!1:f.attr("rel"));u.state.icon&&(u.icon=u.state.icon);f=n.children("ul").children("li");do h="j"+this._id+"_"+ ++this._cnt;while(c[h]);return u.id=u.li_attr.id?u.li_attr.id.toString():h,f.length?(f.each(t.proxy(function(n,i){o=this._parse_model_from_html(t(i),u.id,r);s=this._model.data[o];u.children.push(o);s.children_d.length&&(u.children_d=u.children_d.concat(s.children_d))},this)),u.children_d=u.children_d.concat(u.children)):n.hasClass("jstree-closed")&&(u.state.loaded=!1),u.li_attr["class"]&&(u.li_attr["class"]=u.li_attr["class"].replace("jstree-closed","").replace("jstree-open","")),u.a_attr["class"]&&(u.a_attr["class"]=u.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled","")),c[u.id]=u,u.state.selected&&this._data.core.selected.push(u.id),u.id},_parse_model_from_flat_json:function(n,t,r){r=r?r.concat():[];t&&r.unshift(t);var c=n.id.toString(),e=this._model.data,o=this._model.default_state,u,l,s,h,f={id:c,text:n.text||"",icon:n.icon!==i?n.icon:!0,parent:t,parents:r,children:n.children||[],children_d:n.children_d||[],data:n.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(u in o)o.hasOwnProperty(u)&&(f.state[u]=o[u]);if(n&&n.data&&n.data.jstree&&n.data.jstree.icon&&(f.icon=n.data.jstree.icon),n&&n.data&&(f.data=n.data,n.data.jstree))for(u in n.data.jstree)n.data.jstree.hasOwnProperty(u)&&(f.state[u]=n.data.jstree[u]);if(n&&typeof n.state=="object")for(u in n.state)n.state.hasOwnProperty(u)&&(f.state[u]=n.state[u]);if(n&&typeof n.li_attr=="object")for(u in n.li_attr)n.li_attr.hasOwnProperty(u)&&(f.li_attr[u]=n.li_attr[u]);if(f.li_attr.id||(f.li_attr.id=c),n&&typeof n.a_attr=="object")for(u in n.a_attr)n.a_attr.hasOwnProperty(u)&&(f.a_attr[u]=n.a_attr[u]);for(n&&n.children&&n.children===!0&&(f.state.loaded=!1,f.children=[],f.children_d=[]),e[f.id]=f,u=0,l=f.children.length;u<l;u++)s=this._parse_model_from_flat_json(e[f.children[u]],f.id,r),h=e[s],f.children_d.push(s),h.children_d.length&&(f.children_d=f.children_d.concat(h.children_d));return delete n.data,delete n.children,e[f.id].original=n,f.state.selected&&this._data.core.selected.push(f.id),f.id},_parse_model_from_json:function(n,t,r){r=r?r.concat():[];t&&r.unshift(t);var e=!1,f,l,o,s,h=this._model.data,c=this._model.default_state,u;do e="j"+this._id+"_"+ ++this._cnt;while(h[e]);u={id:!1,text:typeof n=="string"?n:"",icon:typeof n=="object"&&n.icon!==i?n.icon:!0,parent:t,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(f in c)c.hasOwnProperty(f)&&(u.state[f]=c[f]);if(n&&n.id&&(u.id=n.id.toString()),n&&n.text&&(u.text=n.text),n&&n.data&&n.data.jstree&&n.data.jstree.icon&&(u.icon=n.data.jstree.icon),n&&n.data&&(u.data=n.data,n.data.jstree))for(f in n.data.jstree)n.data.jstree.hasOwnProperty(f)&&(u.state[f]=n.data.jstree[f]);if(n&&typeof n.state=="object")for(f in n.state)n.state.hasOwnProperty(f)&&(u.state[f]=n.state[f]);if(n&&typeof n.li_attr=="object")for(f in n.li_attr)n.li_attr.hasOwnProperty(f)&&(u.li_attr[f]=n.li_attr[f]);if(u.li_attr.id&&!u.id&&(u.id=u.li_attr.id.toString()),u.id||(u.id=e),u.li_attr.id||(u.li_attr.id=u.id),n&&typeof n.a_attr=="object")for(f in n.a_attr)n.a_attr.hasOwnProperty(f)&&(u.a_attr[f]=n.a_attr[f]);if(n&&n.children&&n.children.length){for(f=0,l=n.children.length;f<l;f++)o=this._parse_model_from_json(n.children[f],u.id,r),s=h[o],u.children.push(o),s.children_d.length&&(u.children_d=u.children_d.concat(s.children_d));u.children_d=u.children_d.concat(u.children)}return n&&n.children&&n.children===!0&&(u.state.loaded=!1,u.children=[],u.children_d=[]),delete n.data,delete n.children,u.original=n,h[u.id]=u,u.state.selected&&this._data.core.selected.push(u.id),u.id},_redraw:function(){for(var r=this._model.force_full_redraw?this._model.data["#"].children.concat([]):this._model.changed.concat([]),t=document.createElement("UL"),n,f=this._data.core.focused,i=0,u=r.length;i<u;i++)n=this.redraw_node(r[i],!0,this._model.force_full_redraw),n&&this._model.force_full_redraw&&t.appendChild(n);this._model.force_full_redraw&&(t.className=this.get_container_ul()[0].className,t.setAttribute("role","group"),this.element.empty().append(t));f!==null&&(n=this.get_node(f,!0),n&&n.length&&n.children(".jstree-anchor")[0]!==document.activeElement?n.children(".jstree-anchor").focus():this._data.core.focused=null);this._model.force_full_redraw=!1;this._model.changed=[];this.trigger("redraw",{nodes:r})},redraw:function(n){n&&(this._model.force_full_redraw=!0);this._redraw()},redraw_node:function(n,i,r,u){var f=this.get_node(n),e=!1,y=!1,p=!1,o=!1,s=!1,a=!1,h="",w=document,v=this._model.data,b=!1,l=null;if(!f)return!1;if(f.id==="#")return this.redraw(!0);if(i=i||f.children.length===0,n=document.querySelector?this.element[0].querySelector("#"+("0123456789".indexOf(f.id[0])!==-1?"\\3"+f.id[0]+" "+f.id.substr(1).replace(t.jstree.idregex,"\\$&"):f.id.replace(t.jstree.idregex,"\\$&"))):document.getElementById(f.id),n)n=t(n),r||(e=n.parent().parent()[0],e===this.element[0]&&(e=null),y=n.index()),i||!f.children.length||n.children(".jstree-children").length||(i=!0),i||(p=n.children(".jstree-children")[0]),b=n.children(".jstree-anchor")[0]===document.activeElement,n.remove();else if(i=!0,!r){if(e=f.parent!=="#"?t("#"+f.parent.replace(t.jstree.idregex,"\\$&"),this.element)[0]:null,e!==null&&(!e||!v[f.parent].state.opened))return!1;y=t.inArray(f.id,e===null?v["#"].children:v[f.parent].children)}n=c.cloneNode(!0);h="jstree-node ";for(o in f.li_attr)if(f.li_attr.hasOwnProperty(o)){if(o==="id")continue;o!=="class"?n.setAttribute(o,f.li_attr[o]):h+=f.li_attr[o]}f.a_attr.id||(f.a_attr.id=f.id+"_anchor");n.setAttribute("aria-selected",!!f.state.selected);n.setAttribute("aria-level",f.parents.length);n.setAttribute("aria-labelledby",f.a_attr.id);f.state.disabled&&n.setAttribute("aria-disabled",!0);f.state.loaded&&!f.children.length?h+=" jstree-leaf":(h+=f.state.opened&&f.state.loaded?" jstree-open":" jstree-closed",n.setAttribute("aria-expanded",f.state.opened&&f.state.loaded));f.parent!==null&&v[f.parent].children[v[f.parent].children.length-1]===f.id&&(h+=" jstree-last");n.id=f.id;n.className=h;h=(f.state.selected?" jstree-clicked":"")+(f.state.disabled?" jstree-disabled":"");for(s in f.a_attr)if(f.a_attr.hasOwnProperty(s)){if(s==="href"&&f.a_attr[s]==="#")continue;s!=="class"?n.childNodes[1].setAttribute(s,f.a_attr[s]):h+=" "+f.a_attr[s]}if(h.length&&(n.childNodes[1].className="jstree-anchor "+h),(f.icon&&f.icon!==!0||f.icon===!1)&&(f.icon===!1?n.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden1":f.icon.indexOf("/")===-1&&f.icon.indexOf(".")===-1?n.childNodes[1].childNodes[0].className+=" "+f.icon+" jstree-themeicon-custom":(n.childNodes[1].childNodes[0].style.backgroundImage="url("+f.icon+")",n.childNodes[1].childNodes[0].style.backgroundPosition="center center",n.childNodes[1].childNodes[0].style.backgroundSize="auto",n.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?n.childNodes[1].appendChild(w.createTextNode(f.text)):n.childNodes[1].innerHTML+=f.text,i&&f.children.length&&(f.state.opened||u)&&f.state.loaded){for(a=w.createElement("UL"),a.setAttribute("role","group"),a.className="jstree-children",o=0,s=f.children.length;o<s;o++)a.appendChild(this.redraw_node(f.children[o],i,!0));n.appendChild(a)}if(p&&n.appendChild(p),!r){for(e||(e=this.element[0]),o=0,s=e.childNodes.length;o<s;o++)if(e.childNodes[o]&&e.childNodes[o].className&&e.childNodes[o].className.indexOf("jstree-children")!==-1){l=e.childNodes[o];break}l||(l=w.createElement("UL"),l.setAttribute("role","group"),l.className="jstree-children",e.appendChild(l));e=l;y<e.childNodes.length?e.insertBefore(n,e.childNodes[y]):e.appendChild(n);b&&n.childNodes[1].focus()}return f.state.opened&&!f.state.loaded&&(f.state.opened=!1,setTimeout(t.proxy(function(){this.open_node(f.id,!1,0)},this),0)),n},open_node:function(n,r,u){var e,o,f,s;if(t.isArray(n)){for(n=n.slice(),e=0,o=n.length;e<o;e++)this.open_node(n[e],r,u);return!0}if(n=this.get_node(n),!n||n.id==="#")return!1;if(u=u===i?this.settings.core.animation:u,!this.is_closed(n))return r&&r.call(this,n,!1),!1;if(this.is_loaded(n))f=this.get_node(n,!0),s=this,f.length&&(n.children.length&&!this._firstChild(f.children(".jstree-children")[0])&&(this.redraw_node(n,!0,!1,!0),f=this.get_node(n,!0)),u?(this.trigger("before_open",{node:n}),f.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(u,function(){this.style.display="";s.trigger("after_open",{node:n})})):(this.trigger("before_open",{node:n}),f[0].className=f[0].className.replace("jstree-closed","jstree-open"),f[0].setAttribute("aria-expanded",!0))),n.state.opened=!0,r&&r.call(this,n,!0),f.length||this.trigger("before_open",{node:n}),this.trigger("open_node",{node:n}),u&&f.length||this.trigger("after_open",{node:n});else{if(this.is_loading(n))return setTimeout(t.proxy(function(){this.open_node(n,r,u)},this),500);this.load_node(n,function(n,t){return t?this.open_node(n,r,u):r?r.call(this,n,!1):!1})}},_open_to:function(n){if(n=this.get_node(n),!n||n.id==="#")return!1;for(var u=n.parents,i=0,r=u.length;i<r;i+=1)i!=="#"&&this.open_node(u[i],!1,0);return t("#"+n.id.replace(t.jstree.idregex,"\\$&"),this.element)},close_node:function(n,r){var f,e,o,u;if(t.isArray(n)){for(n=n.slice(),f=0,e=n.length;f<e;f++)this.close_node(n[f],r);return!0}if((n=this.get_node(n),!n||n.id==="#")||this.is_closed(n))return!1;r=r===i?this.settings.core.animation:r;o=this;u=this.get_node(n,!0);u.length&&(r?u.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(r,function(){this.style.display="";u.children(".jstree-children").remove();o.trigger("after_close",{node:n})}):(u[0].className=u[0].className.replace("jstree-open","jstree-closed"),u.attr("aria-expanded",!1).children(".jstree-children").remove()));n.state.opened=!1;this.trigger("close_node",{node:n});r&&u.length||this.trigger("after_close",{node:n})},toggle_node:function(n){var i,r;if(t.isArray(n)){for(n=n.slice(),i=0,r=n.length;i<r;i++)this.toggle_node(n[i]);return!0}return this.is_closed(n)?this.open_node(n):this.is_open(n)?this.close_node(n):void 0},open_all:function(n,t,i){if(n||(n="#"),n=this.get_node(n),!n)return!1;var r=n.id==="#"?this.get_container_ul():this.get_node(n,!0),u,f,e;if(!r.length){for(u=0,f=n.children_d.length;u<f;u++)this.is_closed(this._model.data[n.children_d[u]])&&(this._model.data[n.children_d[u]].state.opened=!0);return this.trigger("open_all",{node:n})}i=i||r;e=this;r=this.is_closed(n)?r.find(".jstree-closed").addBack():r.find(".jstree-closed");r.each(function(){e.open_node(this,function(n,r){r&&this.is_parent(n)&&this.open_all(n,t,i)},t||0)});i.find(".jstree-closed").length===0&&this.trigger("open_all",{node:this.get_node(i)})},close_all:function(n,i){if(n||(n="#"),n=this.get_node(n),!n)return!1;var r=n.id==="#"?this.get_container_ul():this.get_node(n,!0),e=this,u,f;if(!r.length){for(u=0,f=n.children_d.length;u<f;u++)this._model.data[n.children_d[u]].state.opened=!1;return this.trigger("close_all",{node:n})}r=this.is_open(n)?r.find(".jstree-open").addBack():r.find(".jstree-open");t(r.get().reverse()).each(function(){e.close_node(this,i||0)});this.trigger("close_all",{node:n})},is_disabled:function(n){return n=this.get_node(n),n&&n.state&&n.state.disabled},enable_node:function(n){var i,r;if(t.isArray(n)){for(n=n.slice(),i=0,r=n.length;i<r;i++)this.enable_node(n[i]);return!0}if(n=this.get_node(n),!n||n.id==="#")return!1;n.state.disabled=!1;this.get_node(n,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1);this.trigger("enable_node",{node:n})},disable_node:function(n){var i,r;if(t.isArray(n)){for(n=n.slice(),i=0,r=n.length;i<r;i++)this.disable_node(n[i]);return!0}if(n=this.get_node(n),!n||n.id==="#")return!1;n.state.disabled=!0;this.get_node(n,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0);this.trigger("disable_node",{node:n})},activate_node:function(n,t){if(this.is_disabled(n))return!1;if(this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==i?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(t.metaKey||t.ctrlKey||t.shiftKey)&&(!t.shiftKey||this._data.core.last_clicked&&this.get_parent(n)&&this.get_parent(n)===this._data.core.last_clicked.parent))if(t.shiftKey){for(var e=this.get_node(n).id,o=this._data.core.last_clicked.id,u=this.get_node(this._data.core.last_clicked.parent).children,f=!1,r=0,s=u.length;r<s;r+=1)u[r]===e&&(f=!f),u[r]===o&&(f=!f),f||u[r]===e||u[r]===o?this.select_node(u[r],!0,!1,t):this.deselect_node(u[r],!0,t);this.trigger("changed",{action:"select_node",node:this.get_node(n),selected:this._data.core.selected,event:t})}else this.is_selected(n)?this.deselect_node(n,!1,t):this.select_node(n,!1,!1,t);else!this.settings.core.multiple&&(t.metaKey||t.ctrlKey||t.shiftKey)&&this.is_selected(n)?this.deselect_node(n,!1,t):(this.deselect_all(!0),this.select_node(n,!1,!1,t),this._data.core.last_clicked=this.get_node(n));this.trigger("activate_node",{node:this.get_node(n)})},hover_node:function(n){if(n=this.get_node(n,!0),!n||!n.length||n.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),i=this.element;t&&t.length&&this.dehover_node(t);n.children(".jstree-anchor").addClass("jstree-hovered");this.trigger("hover_node",{node:this.get_node(n)});setTimeout(function(){i.attr("aria-activedescendant",n[0].id)},0)},dehover_node:function(n){if(n=this.get_node(n,!0),!n||!n.length||!n.children(".jstree-hovered").length)return!1;n.children(".jstree-anchor").removeClass("jstree-hovered");this.trigger("dehover_node",{node:this.get_node(n)})},select_node:function(n,i,r,u){var f,e,o;if(t.isArray(n)){for(n=n.slice(),e=0,o=n.length;e<o;e++)this.select_node(n[e],i,r,u);return!0}if(n=this.get_node(n),!n||n.id==="#")return!1;f=this.get_node(n,!0);n.state.selected||(n.state.selected=!0,this._data.core.selected.push(n.id),r||(f=this._open_to(n)),f&&f.length&&f.attr("aria-selected",!0).children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:n,selected:this._data.core.selected,event:u}),i||this.trigger("changed",{action:"select_node",node:n,selected:this._data.core.selected,event:u}))},deselect_node:function(n,i,r){var u,e,f;if(t.isArray(n)){for(n=n.slice(),u=0,e=n.length;u<e;u++)this.deselect_node(n[u],i,r);return!0}if(n=this.get_node(n),!n||n.id==="#")return!1;f=this.get_node(n,!0);n.state.selected&&(n.state.selected=!1,this._data.core.selected=t.vakata.array_remove_item(this._data.core.selected,n.id),f.length&&f.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:n,selected:this._data.core.selected,event:r}),i||this.trigger("changed",{action:"deselect_node",node:n,selected:this._data.core.selected,event:r}))},select_all:function(n){var r=this._data.core.selected.concat([]),t,i;for(this._data.core.selected=this._model.data["#"].children_d.concat(),t=0,i=this._data.core.selected.length;t<i;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!0);this.redraw(!0);this.trigger("select_all",{selected:this._data.core.selected});n||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:r})},deselect_all:function(n){for(var i=this._data.core.selected.concat([]),t=0,r=this._data.core.selected.length;t<r;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!1);this._data.core.selected=[];this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",!1);this.trigger("deselect_all",{selected:this._data.core.selected,node:i});n||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:i})},is_selected:function(n){return(n=this.get_node(n),!n||n.id==="#")?!1:n.state.selected},get_selected:function(n){return n?t.map(this._data.core.selected,t.proxy(function(n){return this.get_node(n)},this)):this._data.core.selected.slice()},get_top_selected:function(n){for(var r=this.get_selected(!0),u={},f,o,i=0,e=r.length;i<e;i++)u[r[i].id]=r[i];for(i=0,e=r.length;i<e;i++)for(f=0,o=r[i].children_d.length;f<o;f++)u[r[i].children_d[f]]&&delete u[r[i].children_d[f]];r=[];for(i in u)u.hasOwnProperty(i)&&r.push(i);return n?t.map(r,t.proxy(function(n){return this.get_node(n)},this)):r},get_bottom_selected:function(n){for(var r=this.get_selected(!0),u=[],i=0,f=r.length;i<f;i++)r[i].children.length||u.push(r[i].id);return n?t.map(u,t.proxy(function(n){return this.get_node(n)},this)):u},get_state:function(){var t={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(var n in this._model.data)this._model.data.hasOwnProperty(n)&&n!=="#"&&(this._model.data[n].state.opened&&t.core.open.push(n),this._model.data[n].state.selected&&t.core.selected.push(n));return t},set_state:function(n,r){if(n){if(n.core){var f,e,u,o;if(n.core.open)return t.isArray(n.core.open)?(f=!0,e=!1,u=this,t.each(n.core.open.concat([]),function(i,o){e=u.get_node(o);e&&(u.is_loaded(o)?(u.is_closed(o)&&u.open_node(o,!1,0),n&&n.core&&n.core.open&&t.vakata.array_remove_item(n.core.open,o)):(u.is_loading(o)||u.open_node(o,t.proxy(function(i,u){!u&&n&&n.core&&n.core.open&&t.vakata.array_remove_item(n.core.open,i.id);this.set_state(n,r)},u),0),f=!1))}),f&&(delete n.core.open,this.set_state(n,r)),!1):(delete n.core.open,this.set_state(n,r),!1);if(n.core.scroll)return n.core.scroll&&n.core.scroll.left!==i&&this.element.scrollLeft(n.core.scroll.left),n.core.scroll&&n.core.scroll.top!==i&&this.element.scrollTop(n.core.scroll.top),delete n.core.scroll,this.set_state(n,r),!1;if(n.core.selected)return o=this,this.deselect_all(),t.each(n.core.selected,function(n,t){o.select_node(t)}),delete n.core.selected,this.set_state(n,r),!1;if(t.isEmptyObject(n.core))return delete n.core,this.set_state(n,r),!1}return t.isEmptyObject(n)?(n=null,r&&r.call(this),this.trigger("set_state"),!1):!0}return!1},refresh:function(n,i){this._data.core.state=i===!0?{}:this.get_state();i&&t.isFunction(i)&&(this._data.core.state=i.call(this,this._data.core.state));this._cnt=0;this._model.data={"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}};var r=this.get_container_ul()[0].className;n||(this.element.html("<ul class='"+r+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'><\/i><a class='jstree-anchor' href='#'><i class='jstree-icon'><\/i>"+this.get_string("Loading ...")+"<\/a><\/li><\/ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"));this.load_node("#",function(n,i){i&&(this.get_container_ul()[0].className=r,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(t.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")}));this._data.core.state=null})},refresh_node:function(n){if(n=this.get_node(n),!n||n.id==="#")return!1;var i=[],r=[],u=this._data.core.selected.concat([]);r.push(n.id);n.state.opened===!0&&i.push(n.id);this.get_node(n,!0).find(".jstree-open").each(function(){i.push(this.id)});this._load_nodes(r,t.proxy(function(t){this.open_node(i,!1,0);this.select_node(this._data.core.selected);this.trigger("refresh_node",{node:n,nodes:t})},this))},set_id:function(n,i){if(n=this.get_node(n),!n||n.id==="#")return!1;var r,f,u=this._model.data;for(i=i.toString(),u[n.parent].children[t.inArray(n.id,u[n.parent].children)]=i,r=0,f=n.parents.length;r<f;r++)u[n.parents[r]].children_d[t.inArray(n.id,u[n.parents[r]].children_d)]=i;for(r=0,f=n.children.length;r<f;r++)u[n.children[r]].parent=i;for(r=0,f=n.children_d.length;r<f;r++)u[n.children_d[r]].parents[t.inArray(n.id,u[n.children_d[r]].parents)]=i;return r=t.inArray(n.id,this._data.core.selected),r!==-1&&(this._data.core.selected[r]=i),r=this.get_node(n.id,!0),r&&r.attr("id",i),delete u[n.id],n.id=i,u[i]=n,!0},get_text:function(n){return n=this.get_node(n),!n||n.id==="#"?!1:n.text},set_text:function(n,i){var r,u;if(t.isArray(n)){for(n=n.slice(),r=0,u=n.length;r<u;r++)this.set_text(n[r],i);return!0}return(n=this.get_node(n),!n||n.id==="#")?!1:(n.text=i,this.get_node(n,!0).length&&this.redraw_node(n.id),this.trigger("set_text",{obj:n,text:i}),!0)},get_json:function(n,i,r){if(n=this.get_node(n||"#"),!n)return!1;i&&i.flat&&!r&&(r=[]);var u={id:n.id,text:n.text,icon:this.get_icon(n),li_attr:t.extend(!0,{},n.li_attr),a_attr:t.extend(!0,{},n.a_attr),state:{},data:i&&i.no_data?!1:t.extend(!0,{},n.data)},f,e;if(i&&i.flat?u.parent=n.parent:u.children=[],!i||!i.no_state)for(f in n.state)n.state.hasOwnProperty(f)&&(u.state[f]=n.state[f]);if(i&&i.no_id&&(delete u.id,u.li_attr&&u.li_attr.id&&delete u.li_attr.id,u.a_attr&&u.a_attr.id&&delete u.a_attr.id),i&&i.flat&&n.id!=="#"&&r.push(u),!i||!i.no_children)for(f=0,e=n.children.length;f<e;f++)i&&i.flat?this.get_json(n.children[f],i,r):u.children.push(this.get_json(n.children[f],i));return i&&i.flat?r:n.id==="#"?u.children:u},create_node:function(n,r,u,f,e){if(n===null&&(n="#"),n=this.get_node(n),!n)return!1;if(u=u===i?"last":u,!u.toString().match(/^(before|after)$/)&&!e&&!this.is_loaded(n))return this.load_node(n,function(){this.create_node(n,r,u,f,!0)});r||(r={text:this.get_string("New node")});r.text===i&&(r.text=this.get_string("New node"));var o,h,s,c;n.id==="#"&&(u==="before"&&(u="first"),u==="after"&&(u="last"));switch(u){case"before":o=this.get_node(n.parent);u=t.inArray(n.id,o.children);n=o;break;case"after":o=this.get_node(n.parent);u=t.inArray(n.id,o.children)+1;n=o;break;case"inside":case"first":u=0;break;case"last":u=n.children.length;break;default:u||(u=0)}if(u>n.children.length&&(u=n.children.length),r.id||(r.id=!0),!this.check("create_node",r,n,u))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(r.id===!0&&delete r.id,r=this._parse_model_from_json(r,n.id,n.parents.concat()),!r)return!1;for(o=this.get_node(r),h=[],h.push(r),h=h.concat(o.children_d),this.trigger("model",{nodes:h,parent:n.id}),n.children_d=n.children_d.concat(h),s=0,c=n.parents.length;s<c;s++)this._model.data[n.parents[s]].children_d=this._model.data[n.parents[s]].children_d.concat(h);for(r=o,o=[],s=0,c=n.children.length;s<c;s++)o[s>=u?s+1:s]=n.children[s];return o[u]=r.id,n.children=o,this.redraw_node(n,!0),f&&f.call(this,this.get_node(r)),this.trigger("create_node",{node:this.get_node(r),parent:n.id,position:u}),r.id},rename_node:function(n,i){var r,u,f;if(t.isArray(n)){for(n=n.slice(),r=0,u=n.length;r<u;r++)this.rename_node(n[r],i);return!0}return(n=this.get_node(n),!n||n.id==="#")?!1:(f=n.text,!this.check("rename_node",n,this.get_parent(n),i))?(this.settings.core.error.call(this,this._data.core.last_error),!1):(this.set_text(n,i),this.trigger("rename_node",{node:n,text:i,old:f}),!0)},delete_node:function(n){var o,c,u,i,f,e,l,r,s,h;if(t.isArray(n)){for(n=n.slice(),o=0,c=n.length;o<c;o++)this.delete_node(n[o]);return!0}if(n=this.get_node(n),!n||n.id==="#")return!1;if(u=this.get_node(n.parent),i=t.inArray(n.id,u.children),h=!1,!this.check("delete_node",n,u,i))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(i!==-1&&(u.children=t.vakata.array_remove(u.children,i)),f=n.children_d.concat([]),f.push(n.id),r=0,s=f.length;r<s;r++){for(e=0,l=n.parents.length;e<l;e++)i=t.inArray(f[r],this._model.data[n.parents[e]].children_d),i!==-1&&(this._model.data[n.parents[e]].children_d=t.vakata.array_remove(this._model.data[n.parents[e]].children_d,i));this._model.data[f[r]].state.selected&&(h=!0,i=t.inArray(f[r],this._data.core.selected),i!==-1&&(this._data.core.selected=t.vakata.array_remove(this._data.core.selected,i)))}for(this.trigger("delete_node",{node:n,parent:u.id}),h&&this.trigger("changed",{action:"delete_node",node:n,selected:this._data.core.selected,parent:u.id}),r=0,s=f.length;r<s;r++)delete this._model.data[f[r]];return this.redraw_node(u,!0),!0},check:function(n,i,r,u,f){i=i&&i.id?i:this.get_node(i);r=r&&r.id?r:this.get_node(r);var e=n.match(/^move_node|copy_node|create_node$/i)?r:i,o=this.settings.core.check_callback;return(n==="move_node"||n==="copy_node")&&(!f||!f.is_multi)&&(i.id===r.id||t.inArray(i.id,r.children)===u||t.inArray(r.id,i.children_d)!==-1)?(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:n,pos:u,obj:i&&i.id?i.id:!1,par:r&&r.id?r.id:!1})},!1):(e&&e.data&&(e=e.data),e&&e.functions&&(e.functions[n]===!1||e.functions[n]===!0))?(e.functions[n]===!1&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+n,data:JSON.stringify({chk:n,pos:u,obj:i&&i.id?i.id:!1,par:r&&r.id?r.id:!1})}),e.functions[n]):o===!1||t.isFunction(o)&&o.call(this,n,i,r,u,f)===!1||o&&o[n]===!1?(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+n,data:JSON.stringify({chk:n,pos:u,obj:i&&i.id?i.id:!1,par:r&&r.id?r.id:!1})},!1):!0},last_error:function(){return this._data.core.last_error},move_node:function(n,r,u,f,e,o){var w,k,v,d,h,c,g,a,l,s,y,b,nt,p;if(r=this.get_node(r),u=u===i?0:u,!r)return!1;if(!u.toString().match(/^(before|after)$/)&&!e&&!this.is_loaded(r))return this.load_node(r,function(){this.move_node(n,r,u,f,!0)});if(t.isArray(n)){for(n=n.slice(),w=0,k=n.length;w<k;w++)this.move_node(n[w],r,u,f,e,!0)&&(r=n[w],u="after");return this.redraw(),!0}if(n=n&&n.id?n:this.get_node(n),!n||n.id==="#")return!1;if(v=(n.parent||"#").toString(),h=!u.toString().match(/^(before|after)$/)||r.id==="#"?r:this.get_node(r.parent),c=n.instance?n.instance:this._model.data[n.id]?this:t.jstree.reference(n.id),g=!c||!c._id||this._id!==c._id,d=c&&c._id&&v&&c._model.data[v]&&c._model.data[v].children?t.inArray(n.id,c._model.data[v].children):-1,g)return this.copy_node(n,r,u,f,e)?(c&&c.delete_node(n),!0):!1;r.id==="#"&&(u==="before"&&(u="first"),u==="after"&&(u="last"));switch(u){case"before":u=t.inArray(r.id,h.children);break;case"after":u=t.inArray(r.id,h.children)+1;break;case"inside":case"first":u=0;break;case"last":u=h.children.length;break;default:u||(u=0)}if(u>h.children.length&&(u=h.children.length),!this.check("move_node",n,h,u,{core:!0,is_multi:c&&c._id&&c._id!==this._id,is_foreign:!c||!c._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(n.parent===h.id){for(a=h.children.concat(),l=t.inArray(n.id,a),l!==-1&&(a=t.vakata.array_remove(a,l),u>l&&u--),l=[],s=0,y=a.length;s<y;s++)l[s>=u?s+1:s]=a[s];l[u]=n.id;h.children=l;this._node_changed(h.id);this.redraw(h.id==="#")}else{for(l=n.children_d.concat(),l.push(n.id),s=0,y=n.parents.length;s<y;s++){for(a=[],p=c._model.data[n.parents[s]].children_d,b=0,nt=p.length;b<nt;b++)t.inArray(p[b],l)===-1&&a.push(p[b]);c._model.data[n.parents[s]].children_d=a}for(c._model.data[v].children=t.vakata.array_remove_item(c._model.data[v].children,n.id),s=0,y=h.parents.length;s<y;s++)this._model.data[h.parents[s]].children_d=this._model.data[h.parents[s]].children_d.concat(l);for(a=[],s=0,y=h.children.length;s<y;s++)a[s>=u?s+1:s]=h.children[s];for(a[u]=n.id,h.children=a,h.children_d.push(n.id),h.children_d=h.children_d.concat(n.children_d),n.parent=h.id,l=h.parents.concat(),l.unshift(h.id),p=n.parents.length,n.parents=l,l=l.concat(),s=0,y=n.children_d.length;s<y;s++)this._model.data[n.children_d[s]].parents=this._model.data[n.children_d[s]].parents.slice(0,p*-1),Array.prototype.push.apply(this._model.data[n.children_d[s]].parents,l);(v==="#"||h.id==="#")&&(this._model.force_full_redraw=!0);this._model.force_full_redraw||(this._node_changed(v),this._node_changed(h.id));o||this.redraw()}return f&&f.call(this,n,h,u),this.trigger("move_node",{node:n,parent:h.id,position:u,old_parent:v,old_position:d,is_multi:c&&c._id&&c._id!==this._id,is_foreign:!c||!c._id,old_instance:c,new_instance:this}),!0},copy_node:function(n,r,u,f,e,o){var p,b,a,c,l,w,v,y,s,h,k;if(r=this.get_node(r),u=u===i?0:u,!r)return!1;if(!u.toString().match(/^(before|after)$/)&&!e&&!this.is_loaded(r))return this.load_node(r,function(){this.copy_node(n,r,u,f,!0)});if(t.isArray(n)){for(n=n.slice(),p=0,b=n.length;p<b;p++)c=this.copy_node(n[p],r,u,f,e,!0),c&&(r=c,u="after");return this.redraw(),!0}if(n=n&&n.id?n:this.get_node(n),!n||n.id==="#")return!1;y=(n.parent||"#").toString();s=!u.toString().match(/^(before|after)$/)||r.id==="#"?r:this.get_node(r.parent);h=n.instance?n.instance:this._model.data[n.id]?this:t.jstree.reference(n.id);k=!h||!h._id||this._id!==h._id;r.id==="#"&&(u==="before"&&(u="first"),u==="after"&&(u="last"));switch(u){case"before":u=t.inArray(r.id,s.children);break;case"after":u=t.inArray(r.id,s.children)+1;break;case"inside":case"first":u=0;break;case"last":u=s.children.length;break;default:u||(u=0)}if(u>s.children.length&&(u=s.children.length),!this.check("copy_node",n,s,u,{core:!0,is_multi:h&&h._id&&h._id!==this._id,is_foreign:!h||!h._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if((v=h?h.get_json(n,{no_id:!0,no_data:!0,no_state:!0}):n,!v)||(v.id===!0&&delete v.id,v=this._parse_model_from_json(v,s.id,s.parents.concat()),!v))return!1;for(c=this.get_node(v),n&&n.state&&n.state.loaded===!1&&(c.state.loaded=!1),a=[],a.push(v),a=a.concat(c.children_d),this.trigger("model",{nodes:a,parent:s.id}),l=0,w=s.parents.length;l<w;l++)this._model.data[s.parents[l]].children_d=this._model.data[s.parents[l]].children_d.concat(a);for(a=[],l=0,w=s.children.length;l<w;l++)a[l>=u?l+1:l]=s.children[l];return a[u]=c.id,s.children=a,s.children_d.push(c.id),s.children_d=s.children_d.concat(c.children_d),s.id==="#"&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(s.id),o||this.redraw(s.id==="#"),f&&f.call(this,c,s,u),this.trigger("copy_node",{node:c,original:n,parent:s.id,position:u,old_parent:y,old_position:h&&h._id&&y&&h._model.data[y]&&h._model.data[y].children?t.inArray(n.id,h._model.data[y].children):-1,is_multi:h&&h._id&&h._id!==this._id,is_foreign:!h||!h._id,old_instance:h,new_instance:this}),c.id},cut:function(n){if(n||(n=this._data.core.selected.concat()),t.isArray(n)||(n=[n]),!n.length)return!1;for(var e=[],i,r=0,s=n.length;r<s;r++)i=this.get_node(n[r]),i&&i.id&&i.id!=="#"&&e.push(i);if(!e.length)return!1;f=e;o=this;u="move_node";this.trigger("cut",{node:n})},copy:function(n){if(n||(n=this._data.core.selected.concat()),t.isArray(n)||(n=[n]),!n.length)return!1;for(var e=[],i,r=0,s=n.length;r<s;r++)i=this.get_node(n[r]),i&&i.id&&i.id!=="#"&&e.push(i);if(!e.length)return!1;f=e;o=this;u="copy_node";this.trigger("copy",{node:n})},get_buffer:function(){return{mode:u,node:f,inst:o}},can_paste:function(){return u!==!1&&f!==!1},paste:function(n,t){if(n=this.get_node(n),!n||!u||!u.match(/^(copy_node|move_node)$/)||!f)return!1;this[u](f,n,t)&&this.trigger("paste",{parent:n.id,node:f,mode:u});f=!1;u=!1;o=!1},clear_buffer:function(){f=!1;u=!1;o=!1;this.trigger("clear_buffer")},edit:function(n,i){if(n=this.get_node(n),!n)return!1;if(this.settings.core.check_callback===!1)return this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1;i=typeof i=="string"?i:n.text;this.set_text(n,"");n=this._open_to(n);var c=this._data.core.rtl,s=this.element.width(),r=n.children(".jstree-anchor"),u=t("<span>"),f=i,e=t("<div />",{css:{position:"absolute",top:"-200px",left:c?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),o=t("<input />",{value:f,maxlength:"37","class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:t.proxy(function(){var o=u.children(".jstree-rename-input"),i=o.val();i===""&&(i=f);e.remove();u.replaceWith(r);u.remove();this.set_text(n,f);this.rename_node(n,t("<div><\/div>").text(i)[this.settings.core.force_text?"text":"html"]())===!1&&this.set_text(n,f)},this),keydown:function(n){var t=n.which;t===27&&(this.value=f);(t===27||t===13||t===37||t===38||t===39||t===40||t===32)&&n.stopImmediatePropagation();(t===27||t===13)&&(n.preventDefault(),this.blur())},click:function(n){n.stopImmediatePropagation()},mousedown:function(n){n.stopImmediatePropagation()},keyup:function(){o.width(Math.min(e.text("pW"+this.value).width(),s))},keypress:function(n){if(n.which===13)return!1}}),h={fontFamily:r.css("fontFamily")||"",fontSize:r.css("fontSize")||"",fontWeight:r.css("fontWeight")||"",fontStyle:r.css("fontStyle")||"",fontStretch:r.css("fontStretch")||"",fontVariant:r.css("fontVariant")||"",letterSpacing:r.css("letterSpacing")||"",wordSpacing:r.css("wordSpacing")||""};u.attr("class",r.attr("class")).append(r.contents().clone()).append(o);r.replaceWith(u);e.css(h);o.css(h).width(Math.min(e.text("pW"+o[0].value).width(),s))[0].select()},set_theme:function(n,i){if(!n)return!1;if(i===!0){var r=this.settings.core.themes.dir;r||(r=t.jstree.path+"/themes");i=r+"/"+n+"/style.css"}i&&t.inArray(i,y)===-1&&(t("head").append('<link rel="stylesheet" href="'+i+'" type="text/css" />'),y.push(i));this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name);this._data.core.themes.name=n;this.element.addClass("jstree-"+n);this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+n+"-responsive");this.trigger("set_theme",{theme:n})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(n){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant);this._data.core.themes.variant=n;n&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0;this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1;this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0;this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1;this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0;this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1;this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(n,i){var f,e,u,r;if(t.isArray(n)){for(n=n.slice(),f=0,e=n.length;f<e;f++)this.set_icon(n[f],i);return!0}return(n=this.get_node(n),!n||n.id==="#")?!1:(r=n.icon,n.icon=i,u=this.get_node(n,!0).children(".jstree-anchor").children(".jstree-themeicon"),i===!1?this.hide_icon(n):i===!0?(u.removeClass("jstree-themeicon-custom "+r).css("background","").removeAttr("rel"),r===!1&&this.show_icon(n)):i.indexOf("/")===-1&&i.indexOf(".")===-1?(u.removeClass(r).css("background",""),u.addClass(i+" jstree-themeicon-custom").attr("rel",i),r===!1&&this.show_icon(n)):(u.removeClass(r).css("background",""),u.addClass("jstree-themeicon-custom").css("background","url('"+i+"') center center no-repeat").attr("rel",i),r===!1&&this.show_icon(n)),!0)},get_icon:function(n){return n=this.get_node(n),!n||n.id==="#"?!1:n.icon},hide_icon:function(n){var i,r;if(t.isArray(n)){for(n=n.slice(),i=0,r=n.length;i<r;i++)this.hide_icon(n[i]);return!0}return(n=this.get_node(n),!n||n==="#")?!1:(n.icon=!1,this.get_node(n,!0).children(".jstree-anchor").children(".jstree-themeicon"),!0)},show_icon:function(n){var i,u,r;if(t.isArray(n)){for(n=n.slice(),i=0,u=n.length;i<u;i++)this.show_icon(n[i]);return!0}return(n=this.get_node(n),!n||n==="#")?!1:(r=this.get_node(n,!0),n.icon=r.length?r.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"):!0,n.icon||(n.icon=!0),r.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden1"),!0)}};t.vakata={};t.vakata.attributes=function(n,i){n=t(n)[0];var r=i?{}:[];return n&&n.attributes&&t.each(n.attributes,function(n,u){t.inArray(u.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])===-1&&u.value!==null&&t.trim(u.value)!==""&&(i?r[u.name]=u.value:r.push(u.name))}),r};t.vakata.array_unique=function(n){for(var r=[],i,t=0,u=n.length;t<u;t++){for(i=0;i<=t;i++)if(n[t]===n[i])break;i===t&&r.push(n[t])}return r};t.vakata.array_remove=function(n,t,i){var r=n.slice((i||t)+1||n.length);return n.length=t<0?n.length+t:t,n.push.apply(n,r),n};t.vakata.array_remove_item=function(n,i){var r=t.inArray(i,n);return r!==-1?t.vakata.array_remove(n,r):n};l=document.createElement("I");l.className="jstree-icon jstree-checkbox";l.setAttribute("role","presentation");t.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0};t.jstree.plugins.checkbox=function(n,i){this.bind=function(){i.bind.call(this);this._data.checkbox.uto=!1;this._data.checkbox.selected=[];this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined");this.element.on("init.jstree",t.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible;this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked");this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",t.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this));if(this.settings.checkbox.cascade.indexOf("undetermined")!==-1)this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",t.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto);this._data.checkbox.uto=setTimeout(t.proxy(this._undetermined,this),50)},this));if(!this.settings.checkbox.tie_selection)this.element.on("model.jstree",t.proxy(function(n,t){for(var u=this._model.data,e=u[t.parent],r=t.nodes,i=0,f=r.length;i<f;i++)u[r[i]].state.checked=u[r[i]].original&&u[r[i]].original.state&&u[r[i]].original.state.checked,u[r[i]].state.checked&&this._data.checkbox.selected.push(r[i])},this));if(this.settings.checkbox.cascade.indexOf("up")!==-1||this.settings.checkbox.cascade.indexOf("down")!==-1)this.element.on("model.jstree",t.proxy(function(n,i){var e=this._model.data,u=e[i.parent],s=i.nodes,c=[],v,r,o,h,l,a,y=this.settings.checkbox.cascade,f=this.settings.checkbox.tie_selection;if(y.indexOf("down")!==-1)if(u.state[f?"selected":"checked"]){for(r=0,o=s.length;r<o;r++)e[s[r]].state[f?"selected":"checked"]=!0;this._data[f?"core":"checkbox"].selected=this._data[f?"core":"checkbox"].selected.concat(s)}else for(r=0,o=s.length;r<o;r++)if(e[s[r]].state[f?"selected":"checked"]){for(h=0,l=e[s[r]].children_d.length;h<l;h++)e[e[s[r]].children_d[h]].state[f?"selected":"checked"]=!0;this._data[f?"core":"checkbox"].selected=this._data[f?"core":"checkbox"].selected.concat(e[s[r]].children_d)}if(y.indexOf("up")!==-1){for(r=0,o=u.children_d.length;r<o;r++)e[u.children_d[r]].children.length||c.push(e[u.children_d[r]].parent);for(c=t.vakata.array_unique(c),h=0,l=c.length;h<l;h++)for(u=e[c[h]];u&&u.id!=="#";){for(v=0,r=0,o=u.children.length;r<o;r++)v+=e[u.children[r]].state[f?"selected":"checked"];if(v===o)u.state[f?"selected":"checked"]=!0,this._data[f?"core":"checkbox"].selected.push(u.id),a=this.get_node(u,!0),a&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(f?"jstree-clicked":"jstree-checked");else break;u=this.get_node(u.parent)}}this._data[f?"core":"checkbox"].selected=t.vakata.array_unique(this._data[f?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",t.proxy(function(n,i){var o=i.node,l=this._model.data,u=this.get_node(o.parent),a=this.get_node(o,!0),f,s,h,r,c=this.settings.checkbox.cascade,e=this.settings.checkbox.tie_selection;if(c.indexOf("down")!==-1)for(this._data[e?"core":"checkbox"].selected=t.vakata.array_unique(this._data[e?"core":"checkbox"].selected.concat(o.children_d)),f=0,s=o.children_d.length;f<s;f++)r=l[o.children_d[f]],r.state[e?"selected":"checked"]=!0,r&&r.original&&r.original.state&&r.original.state.undetermined&&(r.original.state.undetermined=!1);if(c.indexOf("up")!==-1)while(u&&u.id!=="#"){for(h=0,f=0,s=u.children.length;f<s;f++)h+=l[u.children[f]].state[e?"selected":"checked"];if(h===s)u.state[e?"selected":"checked"]=!0,this._data[e?"core":"checkbox"].selected.push(u.id),r=this.get_node(u,!0),r&&r.length&&r.attr("aria-selected",!0).children(".jstree-anchor").addClass(e?"jstree-clicked":"jstree-checked");else break;u=this.get_node(u.parent)}c.indexOf("down")!==-1&&a.length&&a.find(".jstree-anchor").addClass(e?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!0)},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",t.proxy(function(){for(var i=this.get_node("#"),u=this._model.data,n,t=0,r=i.children_d.length;t<r;t++)n=u[i.children_d[t]],n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",t.proxy(function(n,i){var f=i.node,h=this.get_node(f,!0),u,o,r,s=this.settings.checkbox.cascade,e=this.settings.checkbox.tie_selection;if(f&&f.original&&f.original.state&&f.original.state.undetermined&&(f.original.state.undetermined=!1),s.indexOf("down")!==-1)for(u=0,o=f.children_d.length;u<o;u++)r=this._model.data[f.children_d[u]],r.state[e?"selected":"checked"]=!1,r&&r.original&&r.original.state&&r.original.state.undetermined&&(r.original.state.undetermined=!1);if(s.indexOf("up")!==-1)for(u=0,o=f.parents.length;u<o;u++)r=this._model.data[f.parents[u]],r.state[e?"selected":"checked"]=!1,r&&r.original&&r.original.state&&r.original.state.undetermined&&(r.original.state.undetermined=!1),r=this.get_node(f.parents[u],!0),r&&r.length&&r.attr("aria-selected",!1).children(".jstree-anchor").removeClass(e?"jstree-clicked":"jstree-checked");for(r=[],u=0,o=this._data[e?"core":"checkbox"].selected.length;u<o;u++)(s.indexOf("down")===-1||t.inArray(this._data[e?"core":"checkbox"].selected[u],f.children_d)===-1)&&(s.indexOf("up")===-1||t.inArray(this._data[e?"core":"checkbox"].selected[u],f.parents)===-1)&&r.push(this._data[e?"core":"checkbox"].selected[u]);this._data[e?"core":"checkbox"].selected=t.vakata.array_unique(r);s.indexOf("down")!==-1&&h.length&&h.find(".jstree-anchor").removeClass(e?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!1)},this));if(this.settings.checkbox.cascade.indexOf("up")!==-1)this.element.on("delete_node.jstree",t.proxy(function(n,t){for(var i=this.get_node(t.parent),s=this._model.data,r,e,o,u,f=this.settings.checkbox.tie_selection;i&&i.id!=="#";){for(o=0,r=0,e=i.children.length;r<e;r++)o+=s[i.children[r]].state[f?"selected":"checked"];if(o===e)i.state[f?"selected":"checked"]=!0,this._data[f?"core":"checkbox"].selected.push(i.id),u=this.get_node(i,!0),u&&u.length&&u.attr("aria-selected",!0).children(".jstree-anchor").addClass(f?"jstree-clicked":"jstree-checked");else break;i=this.get_node(i.parent)}},this)).on("move_node.jstree",t.proxy(function(n,i){var c=i.is_multi,l=i.old_parent,a=this.get_node(i.parent),h=this._model.data,r,o,e,s,f,u=this.settings.checkbox.tie_selection;if(!c)for(r=this.get_node(l);r&&r.id!=="#";){for(o=0,e=0,s=r.children.length;e<s;e++)o+=h[r.children[e]].state[u?"selected":"checked"];if(o===s)r.state[u?"selected":"checked"]=!0,this._data[u?"core":"checkbox"].selected.push(r.id),f=this.get_node(r,!0),f&&f.length&&f.attr("aria-selected",!0).children(".jstree-anchor").addClass(u?"jstree-clicked":"jstree-checked");else break;r=this.get_node(r.parent)}for(r=a;r&&r.id!=="#";){for(o=0,e=0,s=r.children.length;e<s;e++)o+=h[r.children[e]].state[u?"selected":"checked"];if(o===s)r.state[u?"selected":"checked"]||(r.state[u?"selected":"checked"]=!0,this._data[u?"core":"checkbox"].selected.push(r.id),f=this.get_node(r,!0),f&&f.length&&f.attr("aria-selected",!0).children(".jstree-anchor").addClass(u?"jstree-clicked":"jstree-checked"));else if(r.state[u?"selected":"checked"])r.state[u?"selected":"checked"]=!1,this._data[u?"core":"checkbox"].selected=t.vakata.array_remove_item(this._data[u?"core":"checkbox"].selected,r.id),f=this.get_node(r,!0),f&&f.length&&f.attr("aria-selected",!1).children(".jstree-anchor").removeClass(u?"jstree-clicked":"jstree-checked");else break;r=this.get_node(r.parent)}},this))};this._undetermined=function(){for(var f=this._model.data,e=this.settings.checkbox.tie_selection,r=this._data[e?"core":"checkbox"].selected,i=[],o=this,n=0,u=r.length;n<u;n++)f[r[n]]&&f[r[n]].parents&&(i=i.concat(f[r[n]].parents));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var t=o.get_node(this),r;if(t.state.loaded)for(n=0,u=t.children_d.length;n<u;n++)r=f[t.children_d[n]],!r.state.loaded&&r.original&&r.original.state&&r.original.state.undetermined&&r.original.state.undetermined===!0&&(i.push(r.id),i=i.concat(r.parents));else t.original&&t.original.state&&t.original.state.undetermined&&t.original.state.undetermined===!0&&(i.push(t.id),i=i.concat(t.parents))}),i=t.vakata.array_unique(i),i=t.vakata.array_remove_item(i,"#"),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),n=0,u=i.length;n<u;n++)f[i[n]].state[e?"selected":"checked"]||(r=this.get_node(i[n],!0),r&&r.length&&r.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined"))};this.redraw_node=function(n,r,u){if(n=i.redraw_node.apply(this,arguments),n){for(var e=null,f=0,o=n.childNodes.length;f<o;f++)if(n.childNodes[f]&&n.childNodes[f].className&&n.childNodes[f].className.indexOf("jstree-anchor")!==-1){e=n.childNodes[f];break}e&&(!this.settings.checkbox.tie_selection&&this._model.data[n.id].state.checked&&(e.className+=" jstree-checked"),e.insertBefore(l.cloneNode(!1),e.childNodes[0]))}return u||this.settings.checkbox.cascade.indexOf("undetermined")===-1||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(t.proxy(this._undetermined,this),50)),n};this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0;this.get_container_ul().removeClass("jstree-no-checkboxes")};this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1;this.get_container_ul().addClass("jstree-no-checkboxes")};this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()};this.is_undetermined=function(n){n=this.get_node(n);var r=this.settings.checkbox.cascade,i,u,f=this.settings.checkbox.tie_selection,o=this._data[f?"core":"checkbox"].selected,e=this._model.data;if(!n||n.state[f?"selected":"checked"]===!0||r.indexOf("undetermined")===-1||r.indexOf("down")===-1&&r.indexOf("up")===-1)return!1;if(!n.state.loaded&&n.original.state.undetermined===!0)return!0;for(i=0,u=n.children_d.length;i<u;i++)if(t.inArray(n.children_d[i],o)!==-1||!e[n.children_d[i]].state.loaded&&e[n.children_d[i]].original.state.undetermined)return!0;return!1};this.activate_node=function(n,r){if(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||t(r.target).hasClass("jstree-checkbox"))&&(r.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!t(r.target).hasClass("jstree-checkbox"))return i.activate_node.call(this,n,r);this.is_checked(n)?this.uncheck_node(n,r):this.check_node(n,r);this.trigger("activate_node",{node:this.get_node(n)})};this.check_node=function(n,i){if(this.settings.checkbox.tie_selection)return this.select_node(n,!1,!0,i);var r,u,f;if(t.isArray(n)){for(n=n.slice(),u=0,f=n.length;u<f;u++)this.check_node(n[u],i);return!0}if(n=this.get_node(n),!n||n.id==="#")return!1;r=this.get_node(n,!0);n.state.checked||(n.state.checked=!0,this._data.checkbox.selected.push(n.id),r&&r.length&&r.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:n,selected:this._data.checkbox.selected,event:i}))};this.uncheck_node=function(n,i){if(this.settings.checkbox.tie_selection)return this.deselect_node(n,!1,i);var r,f,u;if(t.isArray(n)){for(n=n.slice(),r=0,f=n.length;r<f;r++)this.uncheck_node(n[r],i);return!0}if(n=this.get_node(n),!n||n.id==="#")return!1;u=this.get_node(n,!0);n.state.checked&&(n.state.checked=!1,this._data.checkbox.selected=t.vakata.array_remove_item(this._data.checkbox.selected,n.id),u.length&&u.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:n,selected:this._data.checkbox.selected,event:i}))};this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var i=this._data.checkbox.selected.concat([]),n,t;for(this._data.checkbox.selected=this._model.data["#"].children_d.concat(),n=0,t=this._data.checkbox.selected.length;n<t;n++)this._model.data[this._data.checkbox.selected[n]]&&(this._model.data[this._data.checkbox.selected[n]].state.checked=!0);this.redraw(!0);this.trigger("check_all",{selected:this._data.checkbox.selected})};this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();for(var i=this._data.checkbox.selected.concat([]),n=0,t=this._data.checkbox.selected.length;n<t;n++)this._model.data[this._data.checkbox.selected[n]]&&(this._model.data[this._data.checkbox.selected[n]].state.checked=!1);this._data.checkbox.selected=[];this.element.find(".jstree-checked").removeClass("jstree-checked");this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:i})};this.is_checked=function(n){return this.settings.checkbox.tie_selection?this.is_selected(n):(n=this.get_node(n),!n||n.id==="#")?!1:n.state.checked};this.get_checked=function(n){return this.settings.checkbox.tie_selection?this.get_selected(n):n?t.map(this._data.checkbox.selected,t.proxy(function(n){return this.get_node(n)},this)):this._data.checkbox.selected};this.get_top_checked=function(n){if(this.settings.checkbox.tie_selection)return this.get_top_selected(n);for(var r=this.get_checked(!0),u={},f,o,i=0,e=r.length;i<e;i++)u[r[i].id]=r[i];for(i=0,e=r.length;i<e;i++)for(f=0,o=r[i].children_d.length;f<o;f++)u[r[i].children_d[f]]&&delete u[r[i].children_d[f]];r=[];for(i in u)u.hasOwnProperty(i)&&r.push(i);return n?t.map(r,t.proxy(function(n){return this.get_node(n)},this)):r};this.get_bottom_checked=function(n){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(n);for(var r=this.get_checked(!0),u=[],i=0,f=r.length;i<f;i++)r[i].children.length||u.push(r[i].id);return n?t.map(u,t.proxy(function(n){return this.get_node(n)},this)):u}};t.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(n){var i=t.jstree.reference(n.reference),r=i.get_node(n.reference);i.create_node(r,{},"last",function(n){setTimeout(function(){i.edit(n)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(n){var i=t.jstree.reference(n.reference),r=i.get_node(n.reference);i.edit(r)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(n){var i=t.jstree.reference(n.reference),r=i.get_node(n.reference);i.is_selected(r)?i.delete_node(i.get_selected()):i.delete_node(r)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(n){var i=t.jstree.reference(n.reference),r=i.get_node(n.reference);i.is_selected(r)?i.cut(i.get_selected()):i.cut(r)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(n){var i=t.jstree.reference(n.reference),r=i.get_node(n.reference);i.is_selected(r)?i.copy(i.get_selected()):i.copy(r)}},paste:{separator_before:!1,icon:!1,_disabled:function(n){return!t.jstree.reference(n.reference).can_paste()},separator_after:!1,label:"Paste",action:function(n){var i=t.jstree.reference(n.reference),r=i.get_node(n.reference);i.paste(r)}}}}}}};t.jstree.plugins.contextmenu=function(n,r){this.bind=function(){r.bind.call(this);var n=0;this.element.on("contextmenu.jstree",".jstree-anchor",t.proxy(function(t){t.preventDefault();n=t.ctrlKey?t.timeStamp:0;this.is_loading(t.currentTarget)||this.show_contextmenu(t.currentTarget,t.pageX,t.pageY,t)},this)).on("click.jstree",".jstree-anchor",t.proxy(function(i){this._data.contextmenu.visible&&(!n||i.timeStamp-n>250)&&t.vakata.context.hide()},this));t(document).on("context_hide.vakata.jstree",t.proxy(function(){this._data.contextmenu.visible=!1},this))};this.teardown=function(){this._data.contextmenu.visible&&t.vakata.context.hide();r.teardown.call(this)};this.show_contextmenu=function(n,r,u,f){if(n=this.get_node(n),!n||n.id==="#")return!1;var s=this.settings.contextmenu,h=this.get_node(n,!0),c=h.children(".jstree-anchor"),o=!1,e=!1;(s.show_at_node||r===i||u===i)&&(o=c.offset(),r=o.left,u=o.top+this._data.core.li_height);this.settings.contextmenu.select_node&&!this.is_selected(n)&&this.activate_node(n,f);e=s.items;t.isFunction(e)&&(e=e.call(this,n,t.proxy(function(t){this._show_contextmenu(n,r,u,t)},this)));t.isPlainObject(e)&&this._show_contextmenu(n,r,u,e)};this._show_contextmenu=function(n,i,r,u){var f=this.get_node(n,!0),e=f.children(".jstree-anchor");t(document).one("context_show.vakata.jstree",t.proxy(function(n,i){var r="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";t(i.element).addClass(r)},this));this._data.contextmenu.visible=!0;t.vakata.context.show(e,{x:i,y:r},u);this.trigger("show_contextmenu",{node:n,x:i,y:r})}},function(n){var i=!1,t={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};n.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(i){n(document).triggerHandler("context_"+i+".vakata",{reference:t.reference,element:t.element,position:{x:t.position_x,y:t.position_y}})},_execute:function(i){return i=t.items[i],i&&(!i._disabled||n.isFunction(i._disabled)&&!i._disabled({item:i,reference:t.reference,element:t.element}))&&i.action?i.action.call(null,{item:i,reference:t.reference,element:t.element,position:{x:t.position_x,y:t.position_y}}):!1},_parse:function(i,r){if(!i)return!1;r||(t.html="",t.items=[]);var u="",f=!1,e;return r&&(u+="<ul>"),n.each(i,function(i,r){if(!r)return!0;t.items.push(r);!f&&r.separator_before&&(u+="<li class='vakata-context-separator'><a href='#' "+(n.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;<\/a><\/li>");f=!1;u+="<li class='"+(r._class||"")+(r._disabled===!0||n.isFunction(r._disabled)&&r._disabled({item:r,reference:t.reference,element:t.element})?" vakata-contextmenu-disabled ":"")+"' "+(r.shortcut?" data-shortcut='"+r.shortcut+"' ":"")+">";u+="<a href='#' rel='"+(t.items.length-1)+"'>";n.vakata.context.settings.icons&&(u+="<i ",r.icon&&(u+=r.icon.indexOf("/")!==-1||r.icon.indexOf(".")!==-1?" style='background:url(\""+r.icon+"\") center center no-repeat' ":" class='"+r.icon+"' "),u+="><\/i><span class='vakata-contextmenu-sep'>&#160;<\/span>");u+=(n.isFunction(r.label)?r.label({item:i,reference:t.reference,element:t.element}):r.label)+(r.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+r.shortcut+'">'+(r.shortcut_label||"")+"<\/span>":"")+"<\/a>";r.submenu&&(e=n.vakata.context._parse(r.submenu,!0),e&&(u+=e));u+="<\/li>";r.separator_after&&(u+="<li class='vakata-context-separator'><a href='#' "+(n.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;<\/a><\/li>",f=!0)}),u=u.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),r&&(u+="<\/ul>"),r||(t.html=u,n.vakata.context._trigger("parse")),u.length>10?u:!1},_show_submenu:function(t){if(t=n(t),t.length&&t.children("ul").length){var r=t.children("ul"),u=t.offset().left+t.outerWidth(),e=t.offset().top,f=r.width(),o=r.height(),s=n(window).width()+n(window).scrollLeft(),h=n(window).height()+n(window).scrollTop();i?t[u-(f+10+t.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):t[u+f+10>s?"addClass":"removeClass"]("vakata-context-right");e+o+10>h&&r.css("bottom","-1px");r.show()}},show:function(r,u,f){var h,o,e,s,c,l,a,v;t.element&&t.element.length&&t.element.width("");switch(!0){case!u&&!r:return!1;case!!u&&!!r:t.reference=r;t.position_x=u.x;t.position_y=u.y;break;case!u&&!!r:t.reference=r;h=r.offset();t.position_x=h.left+r.outerHeight();t.position_y=h.top;break;case!!u&&!r:t.position_x=u.x;t.position_y=u.y}!r||f||!n(r).data("vakata_contextmenu")||(f=n(r).data("vakata_contextmenu"));n.vakata.context._parse(f)&&t.element.html(t.html);t.items.length&&(t.element.appendTo("body"),o=t.element,e=t.position_x,s=t.position_y,c=o.width(),l=o.height(),a=n(window).width()+n(window).scrollLeft(),v=n(window).height()+n(window).scrollTop(),i&&(e-=o.outerWidth(),e<n(window).scrollLeft()+20&&(e=n(window).scrollLeft()+20)),e+c+20>a&&(e=a-(c+20)),s+l+20>v&&(s=v-(l+20)),t.element.css({left:e,top:s}).show().find("a").first().focus().parent().addClass("vakata-context-hover"),t.is_visible=!0,n.vakata.context._trigger("show"))},hide:function(){t.is_visible&&(t.element.hide().find("ul").hide().end().find(":focus").blur().end().detach(),t.is_visible=!1,n.vakata.context._trigger("hide"))}};n(function(){i=n("body").css("direction")==="rtl";var r=!1;t.element=n("<ul class='vakata-context'><\/ul>");t.element.on("mouseenter","li",function(i){(i.stopImmediatePropagation(),n.contains(this,i.relatedTarget))||(r&&clearTimeout(r),t.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),n(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),n.vakata.context._show_submenu(this))}).on("mouseleave","li",function(t){n.contains(this,t.relatedTarget)||n(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(){n(this).find(".vakata-context-hover").removeClass("vakata-context-hover");n.vakata.context.settings.hide_onmouseleave&&(r=setTimeout(function(){return function(){n.vakata.context.hide()}}(this),n.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(t){t.preventDefault();n(this).blur().parent().hasClass("vakata-context-disabled")||n.vakata.context._execute(n(this).attr("rel"))===!1||n.vakata.context.hide()}).on("keydown","a",function(i){var r=null;switch(i.which){case 13:case 32:i.type="mouseup";i.preventDefault();n(i.currentTarget).trigger(i);break;case 37:t.is_visible&&(t.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),i.stopImmediatePropagation(),i.preventDefault());break;case 38:t.is_visible&&(r=t.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),r.length||(r=t.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),r.addClass("vakata-context-hover").children("a").focus(),i.stopImmediatePropagation(),i.preventDefault());break;case 39:t.is_visible&&(t.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),i.stopImmediatePropagation(),i.preventDefault());break;case 40:t.is_visible&&(r=t.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),r.length||(r=t.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),r.addClass("vakata-context-hover").children("a").focus(),i.stopImmediatePropagation(),i.preventDefault());break;case 27:n.vakata.context.hide();i.preventDefault()}}).on("keydown",function(n){n.preventDefault();var i=t.element.find(".vakata-contextmenu-shortcut-"+n.which).parent();i.parent().not(".vakata-context-disabled")&&i.click()});n(document).on("mousedown.vakata.jstree",function(i){t.is_visible&&!n.contains(t.element[0],i.target)&&n.vakata.context.hide()}).on("context_show.vakata.jstree",function(){t.element.find("li:has(ul)").children("a").addClass("vakata-context-parent");i&&t.element.addClass("vakata-context-rtl").css("direction","rtl");t.element.find("ul").hide().end()})})}(t);t.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0};t.jstree.plugins.dnd=function(n,i){this.bind=function(){i.bind.call(this);this.element.on("mousedown.jstree touchstart.jstree",".jstree-anchor",t.proxy(function(n){var i=this.get_node(n.target),r=this.is_selected(i)?this.get_selected().length:1;if(i&&i.id&&i.id!=="#"&&(n.which===1||n.type==="touchstart")&&(this.settings.dnd.is_draggable===!0||t.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,r>1?this.get_selected(!0):[i])))return this.element.trigger("mousedown.jstree"),t.vakata.dnd.start(n,{jstree:!0,origin:this,obj:this.get_node(i,!0),nodes:r>1?this.get_selected():[i.id]},'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"><\/i>'+(r>1?r+" "+this.get_string("nodes"):this.get_text(n.currentTarget,!0))+'<ins class="jstree-copy" style="display:none;">+<\/ins><\/div>')},this))}};t(function(){var n=!1,r=!1,u=!1,i=t('<div id="jstree-marker">&#160;<\/div>').hide();t(document).on("dnd_start.vakata.jstree",function(t,r){(n=!1,r&&r.data&&r.data.jstree)&&i.appendTo("body")}).on("dnd_move.vakata.jstree",function(f,e){if((u&&clearTimeout(u),e&&e.data&&e.data.jstree)&&(!e.event.target.id||e.event.target.id!=="jstree-marker")){var o=t.jstree.reference(e.event.target),s=!1,l=!1,b=!1,k,d,a,v,y,g,c,h,nt,it,tt,rt,p,w;if(o&&o._data&&o._data.dnd)if(i.attr("class","jstree-"+o.get_theme()+(o.settings.core.themes.responsive?" jstree-dnd-responsive":"")),e.helper.children().attr("class","jstree-"+o.get_theme()+" jstree-"+o.get_theme()+"-"+o.get_theme_variant()+" "+(o.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[e.data.origin&&(e.data.origin.settings.dnd.always_copy||e.data.origin.settings.dnd.copy&&(e.event.metaKey||e.event.ctrlKey))?"show":"hide"](),(e.event.target===o.element[0]||e.event.target===o.get_container_ul()[0])&&o.get_container_ul().children().length===0){for(c=!0,h=0,nt=e.data.nodes.length;h<nt;h++)if(c=c&&o.check(e.data.origin&&(e.data.origin.settings.dnd.always_copy||e.data.origin.settings.dnd.copy&&(e.event.metaKey||e.event.ctrlKey))?"copy_node":"move_node",e.data.origin&&e.data.origin!==o?e.data.origin.get_node(e.data.nodes[h]):e.data.nodes[h],"#","last",{dnd:!0,ref:o.get_node("#"),pos:"i",is_multi:e.data.origin&&e.data.origin!==o,is_foreign:!e.data.origin}),!c)break;if(c){n={ins:o,par:"#",pos:"last"};i.hide();e.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok");return}}else if(s=t(e.event.target).closest(".jstree-anchor"),s&&s.length&&s.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(l=s.offset(),b=e.event.pageY-l.top,a=s.height(),g=b<a/3?["b","i","a"]:b>a-a/3?["a","i","b"]:b>a/2?["i","a","b"]:["i","b","a"],t.each(g,function(f,b){switch(b){case"b":k=l.left-6;d=l.top;v=o.get_parent(s);y=s.parent().index();break;case"i":p=o.settings.dnd.inside_pos;w=o.get_node(s.parent());k=l.left-2;d=l.top+a/2+1;v=w.id;y=p==="first"?0:p==="last"?w.children.length:Math.min(p,w.children.length);break;case"a":k=l.left-6;d=l.top+a;v=o.get_parent(s);y=s.parent().index()+1}for(c=!0,h=0,nt=e.data.nodes.length;h<nt;h++)if(it=e.data.origin&&(e.data.origin.settings.dnd.always_copy||e.data.origin.settings.dnd.copy&&(e.event.metaKey||e.event.ctrlKey))?"copy_node":"move_node",tt=y,it==="move_node"&&b==="a"&&e.data.origin&&e.data.origin===o&&v===o.get_parent(e.data.nodes[h])&&(rt=o.get_node(v),tt>t.inArray(e.data.nodes[h],rt.children)&&(tt-=1)),c=c&&(o&&o.settings&&o.settings.dnd&&o.settings.dnd.check_while_dragging===!1||o.check(it,e.data.origin&&e.data.origin!==o?e.data.origin.get_node(e.data.nodes[h]):e.data.nodes[h],v,tt,{dnd:!0,ref:o.get_node(s.parent()),pos:b,is_multi:e.data.origin&&e.data.origin!==o,is_foreign:!e.data.origin})),!c){o&&o.last_error&&(r=o.last_error());break}return b==="i"&&s.parent().is(".jstree-closed")&&o.settings.dnd.open_timeout&&(u=setTimeout(function(n,t){return function(){n.open_node(t)}}(o,s),o.settings.dnd.open_timeout)),c?(n={ins:o,par:v,pos:b==="i"&&p==="last"&&y===0&&!o.is_loaded(w)?"last":y},i.css({left:k+"px",top:d+"px"}).show(),e.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),r={},g=!0,!1):void 0}),g===!0))return;n=!1;e.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er");i.hide()}}).on("dnd_scroll.vakata.jstree",function(t,r){r&&r.data&&r.data.jstree&&(i.hide(),n=!1,r.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(f,e){if(u&&clearTimeout(u),e&&e.data&&e.data.jstree){i.hide().detach();var o,h,s=[];if(n){for(o=0,h=e.data.nodes.length;o<h;o++)s[o]=e.data.origin?e.data.origin.get_node(e.data.nodes[o]):e.data.nodes[o],e.data.origin&&(s[o].instance=e.data.origin);for(n.ins[e.data.origin&&(e.data.origin.settings.dnd.always_copy||e.data.origin.settings.dnd.copy&&(e.event.metaKey||e.event.ctrlKey))?"copy_node":"move_node"](s,n.par,n.pos),o=0,h=s.length;o<h;o++)s[o].instance&&(s[o].instance=null)}else o=t(e.event.target).closest(".jstree"),o.length&&r&&r.error&&r.error==="check"&&(o=o.jstree(!0),o&&o.settings.core.error.call(this,r))}}).on("keyup.jstree keydown.jstree",function(n,i){i=t.vakata.dnd._get();i&&i.data&&i.data.jstree&&i.helper.find(".jstree-copy").first()[i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(n.metaKey||n.ctrlKey))?"show":"hide"]()})}),function(n){var t={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};n.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(t,i){var r=n.vakata.dnd._get();r.event=i;n(document).triggerHandler("dnd_"+t+".vakata",r)},_get:function(){return{data:t.data,element:t.element,helper:t.helper}},_clean:function(){t.helper&&t.helper.remove();t.scroll_i&&(clearInterval(t.scroll_i),t.scroll_i=!1);t={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};n(document).off("mousemove.vakata.jstree touchmove.vakata.jstree",n.vakata.dnd.drag);n(document).off("mouseup.vakata.jstree touchend.vakata.jstree",n.vakata.dnd.stop)},_scroll:function(i){if(!t.scroll_e||!t.scroll_l&&!t.scroll_t)return t.scroll_i&&(clearInterval(t.scroll_i),t.scroll_i=!1),!1;if(!t.scroll_i)return t.scroll_i=setInterval(n.vakata.dnd._scroll,100),!1;if(i===!0)return!1;var r=t.scroll_e.scrollTop(),u=t.scroll_e.scrollLeft();t.scroll_e.scrollTop(r+t.scroll_t*n.vakata.dnd.settings.scroll_speed);t.scroll_e.scrollLeft(u+t.scroll_l*n.vakata.dnd.settings.scroll_speed);(r!==t.scroll_e.scrollTop()||u!==t.scroll_e.scrollLeft())&&n.vakata.dnd._trigger("scroll",t.scroll_e)},start:function(i,r,u){i.type==="touchstart"&&i.originalEvent&&i.originalEvent.changedTouches&&i.originalEvent.changedTouches[0]&&(i.pageX=i.originalEvent.changedTouches[0].pageX,i.pageY=i.originalEvent.changedTouches[0].pageY,i.target=document.elementFromPoint(i.originalEvent.changedTouches[0].pageX-window.pageXOffset,i.originalEvent.changedTouches[0].pageY-window.pageYOffset));t.is_drag&&n.vakata.dnd.stop({});try{i.currentTarget.unselectable="on";i.currentTarget.onselectstart=function(){return!1};i.currentTarget.style&&(i.currentTarget.style.MozUserSelect="none")}catch(f){}t.init_x=i.pageX;t.init_y=i.pageY;t.data=r;t.is_down=!0;t.element=i.currentTarget;t.target=i.target;t.is_touch=i.type==="touchstart";u!==!1&&(t.helper=n("<div id='vakata-dnd'><\/div>").html(u).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"}));n(document).on("mousemove.vakata.jstree touchmove.vakata.jstree",n.vakata.dnd.drag);n(document).on("mouseup.vakata.jstree touchend.vakata.jstree",n.vakata.dnd.stop);return!1},drag:function(i){if(i.type==="touchmove"&&i.originalEvent&&i.originalEvent.changedTouches&&i.originalEvent.changedTouches[0]&&(i.pageX=i.originalEvent.changedTouches[0].pageX,i.pageY=i.originalEvent.changedTouches[0].pageY,i.target=document.elementFromPoint(i.originalEvent.changedTouches[0].pageX-window.pageXOffset,i.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_down){if(!t.is_drag)if(Math.abs(i.pageX-t.init_x)>(t.is_touch?n.vakata.dnd.settings.threshold_touch:n.vakata.dnd.settings.threshold)||Math.abs(i.pageY-t.init_y)>(t.is_touch?n.vakata.dnd.settings.threshold_touch:n.vakata.dnd.settings.threshold))t.helper&&(t.helper.appendTo("body"),t.helper_w=t.helper.outerWidth()),t.is_drag=!0,n.vakata.dnd._trigger("start",i);else return;var r=!1,c=!1,u=!1,e=!1,f=!1,o=!1,l=!1,a=!1,s=!1,h=!1;return t.scroll_t=0,t.scroll_l=0,t.scroll_e=!1,n(n(i.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(n(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var u=n(this),r=u.offset();return this.scrollHeight>this.offsetHeight&&(r.top+u.height()-i.pageY<n.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=1),i.pageY-r.top<n.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(r.left+u.width()-i.pageX<n.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=1),i.pageX-r.left<n.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=-1)),t.scroll_t||t.scroll_l?(t.scroll_e=n(this),!1):void 0}),t.scroll_e||(r=n(document),c=n(window),u=r.height(),e=c.height(),f=r.width(),o=c.width(),l=r.scrollTop(),a=r.scrollLeft(),u>e&&i.pageY-l<n.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=-1),u>e&&e-(i.pageY-l)<n.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=1),f>o&&i.pageX-a<n.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=-1),f>o&&o-(i.pageX-a)<n.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=1),(t.scroll_t||t.scroll_l)&&(t.scroll_e=r)),t.scroll_e&&n.vakata.dnd._scroll(!0),t.helper&&(s=parseInt(i.pageY+n.vakata.dnd.settings.helper_top,10),h=parseInt(i.pageX+n.vakata.dnd.settings.helper_left,10),u&&s+25>u&&(s=u-50),f&&h+t.helper_w>f&&(h=f-(t.helper_w+2)),t.helper.css({left:h+"px",top:s+"px"})),n.vakata.dnd._trigger("move",i),!1}},stop:function(i){if(i.type==="touchend"&&i.originalEvent&&i.originalEvent.changedTouches&&i.originalEvent.changedTouches[0]&&(i.pageX=i.originalEvent.changedTouches[0].pageX,i.pageY=i.originalEvent.changedTouches[0].pageY,i.target=document.elementFromPoint(i.originalEvent.changedTouches[0].pageX-window.pageXOffset,i.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_drag)n.vakata.dnd._trigger("stop",i);else if(i.type==="touchend"&&i.target===t.target){var r=setTimeout(function(){n(i.target).click()},100);n(i.target).one("click",function(){r&&clearTimeout(r)})}return n.vakata.dnd._clean(),!1}}}(t);t.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1};t.jstree.plugins.search=function(n,r){this.bind=function(){r.bind.call(this);this._data.search.str="";this._data.search.dom=t();this._data.search.res=[];this._data.search.opn=[];this._data.search.som=!1;this.element.on("before_open.jstree",t.proxy(function(){var r,f,i=this._data.search.res,n=[],u=t();if(i&&i.length&&(this._data.search.dom=t(this.element[0].querySelectorAll("#"+t.map(i,function(n){return"0123456789".indexOf(n[0])!==-1?"\\3"+n[0]+" "+n.substr(1).replace(t.jstree.idregex,"\\$&"):n.replace(t.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search"),this._data.search.som&&this._data.search.res.length)){for(r=0,f=i.length;r<f;r++)n=n.concat(this.get_node(i[r]).parents);n=t.vakata.array_remove_item(t.vakata.array_unique(n),"#");u=n.length?t(this.element[0].querySelectorAll("#"+t.map(n,function(n){return"0123456789".indexOf(n[0])!==-1?"\\3"+n[0]+" "+n.substr(1).replace(t.jstree.idregex,"\\$&"):n.replace(t.jstree.idregex,"\\$&")}).join(", #"))):t();this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last");u=u.add(this._data.search.dom);u.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){t(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")})}},this)).on("search.jstree",t.proxy(function(n,i){this._data.search.som&&i.nodes.length&&(this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),i.nodes.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){t(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")}))},this)).on("clear_search.jstree",t.proxy(function(n,t){this._data.search.som&&t.nodes.length&&this.element.find(".jstree-node").css("display","").filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last")},this))};this.search=function(n,r,u){if(n===!1||t.trim(n.toString())==="")return this.clear_search();n=n.toString();var e=this.settings.search,f=e.ajax?e.ajax:!1,h=null,s=[],o=[];if(this._data.search.res.length&&this.clear_search(),u===i&&(u=e.show_only_matches),!r&&f!==!1)return t.isFunction(f)?f.call(this,n,t.proxy(function(i){i&&i.d&&(i=i.d);this._load_nodes(t.isArray(i)?t.vakata.array_unique(i):[],function(){this.search(n,!0,u)},!0)},this)):(f=t.extend({},f),f.data||(f.data={}),f.data.str=n,t.ajax(f).fail(t.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(f)};this.settings.core.error.call(this,this._data.core.last_error)},this)).done(t.proxy(function(i){i&&i.d&&(i=i.d);this._load_nodes(t.isArray(i)?t.vakata.array_unique(i):[],function(){this.search(n,!0,u)},!0)},this)));this._data.search.str=n;this._data.search.dom=t();this._data.search.res=[];this._data.search.opn=[];this._data.search.som=u;h=new t.vakata.search(n,!0,{caseSensitive:e.case_sensitive,fuzzy:e.fuzzy});t.each(this._model.data,function(t,i){i.text&&(e.search_callback&&e.search_callback.call(this,n,i)||!e.search_callback&&h.search(i.text).isMatch)&&(!e.search_leaves_only||i.state.loaded&&i.children.length===0)&&(s.push(t),o=o.concat(i.parents))});s.length&&(o=t.vakata.array_unique(o),this._search_open(o),this._data.search.dom=t(this.element[0].querySelectorAll("#"+t.map(s,function(n){return"0123456789".indexOf(n[0])!==-1?"\\3"+n[0]+" "+n.substr(1).replace(t.jstree.idregex,"\\$&"):n.replace(t.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=s,this._data.search.dom.children(".jstree-anchor").addClass("jstree-search"));this.trigger("search",{nodes:this._data.search.dom,str:n,res:this._data.search.res,show_only_matches:u})};this.clear_search=function(){this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search");this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0);this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res});this._data.search.str="";this._data.search.res=[];this._data.search.opn=[];this._data.search.dom=t()};this._search_open=function(n){var i=this;t.each(n.concat([]),function(r,u){if(u==="#")return!0;try{u=t("#"+u.replace(t.jstree.idregex,"\\$&"),i.element)}catch(f){}u&&u.length&&i.is_closed(u)&&(i._data.search.opn.push(u[0].id),i.open_node(u,function(){i._search_open(n)},0))})}},function(n){n.vakata.search=function(n,t,i){i=i||{};i.fuzzy!==!1&&(i.fuzzy=!0);n=i.caseSensitive?n:n.toLowerCase();var u=i.location||0,o=i.distance||100,c=i.threshold||.6,r=n.length,s,h,f,e;return r>32&&(i.fuzzy=!1),i.fuzzy&&(s=1<<r-1,h=function(){for(var i={},t=0,t=0;t<r;t++)i[n.charAt(t)]=0;for(t=0;t<r;t++)i[n.charAt(t)]|=1<<r-t-1;return i}(),f=function(n,t){var i=n/r,f=Math.abs(u-t);return o?i+f/o:f?1:i}),e=function(t){if(t=i.caseSensitive?t:t.toLowerCase(),n===t||t.indexOf(n)!==-1)return{isMatch:!0,score:0};if(!i.fuzzy)return{isMatch:!1,score:1};var a,e,tt=t.length,v=c,o=t.indexOf(n,u),p,l,w=r+tt,b,g,k,y,nt,d=1,it=[];for(o!==-1&&(v=Math.min(f(0,o),v),o=t.lastIndexOf(n,u+r),o!==-1&&(v=Math.min(f(0,o),v))),o=-1,a=0;a<r;a++){for(p=0,l=w;p<l;)f(a,u+l)<=v?p=l:w=l,l=Math.floor((w-p)/2+p);for(w=l,g=Math.max(1,u-l+1),k=Math.min(u+l,tt)+r,y=new Array(k+2),y[k+1]=(1<<a)-1,e=k;e>=g;e--)if(nt=h[t.charAt(e-1)],y[e]=a===0?(y[e+1]<<1|1)&nt:(y[e+1]<<1|1)&nt|(b[e+1]|b[e])<<1|1|b[e+1],y[e]&s&&(d=f(a,e-1),d<=v))if(v=d,o=e-1,it.push(o),o>u)g=Math.max(1,2*u-o);else break;if(f(a+1,u)>v)break;b=y}return{isMatch:o>=0,score:d}},t===!0?{search:e}:e(t)}}(t);t.jstree.defaults.sort=function(n,t){return this.get_text(n)>this.get_text(t)?1:-1};t.jstree.plugins.sort=function(n,i){this.bind=function(){i.bind.call(this);this.element.on("model.jstree",t.proxy(function(n,t){this.sort(t.parent,!0)},this)).on("rename_node.jstree create_node.jstree",t.proxy(function(n,t){this.sort(t.parent||t.node.parent,!1);this.redraw_node(t.parent||t.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",t.proxy(function(n,t){this.sort(t.parent,!1);this.redraw_node(t.parent,!0)},this))};this.sort=function(n,i){var r,u;if(n=this.get_node(n),n&&n.children&&n.children.length&&(n.children.sort(t.proxy(this.settings.sort,this)),i))for(r=0,u=n.children_d.length;r<u;r++)this.sort(n.children_d[r],!1)}};a=!1;t.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree",ttl:!1,filter:!1};t.jstree.plugins.state=function(n,i){this.bind=function(){i.bind.call(this);var n=t.proxy(function(){this.element.on(this.settings.state.events,t.proxy(function(){a&&clearTimeout(a);a=setTimeout(t.proxy(function(){this.save_state()},this),100)},this))},this);this.element.on("ready.jstree",t.proxy(function(){this.element.one("restore_state.jstree",n);this.restore_state()||n()},this))};this.save_state=function(){var n={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};t.vakata.storage.set(this.settings.state.key,JSON.stringify(n))};this.restore_state=function(){var n=t.vakata.storage.get(this.settings.state.key);if(!!n)try{n=JSON.parse(n)}catch(i){return!1}if(!!n&&n.ttl&&n.sec&&+new Date-n.sec>n.ttl)return!1;if(!!n&&n.state&&(n=n.state),!!n&&t.isFunction(this.settings.state.filter)&&(n=this.settings.state.filter.call(this,n)),!!n){this.element.one("set_state.jstree",function(i,r){r.instance.trigger("restore_state",{state:t.extend(!0,{},n)})});return this.set_state(n),!0}return!1};this.clear_state=function(){return t.vakata.storage.del(this.settings.state.key)}},function(n){n.vakata.storage={set:function(n,t){return window.localStorage.setItem(n,t)},get:function(n){return window.localStorage.getItem(n)},del:function(n){return window.localStorage.removeItem(n)}}}(t);t.jstree.defaults.types={"#":{},"default":{}};t.jstree.plugins.types=function(n,r){this.init=function(n,t){var u,f;if(t&&t.types&&t.types["default"])for(u in t.types)if(u!=="default"&&u!=="#"&&t.types.hasOwnProperty(u))for(f in t.types["default"])t.types["default"].hasOwnProperty(f)&&t.types[u][f]===i&&(t.types[u][f]=t.types["default"][f]);r.init.call(this,n,t);this._model.data["#"].type="#"};this.refresh=function(n,t){r.refresh.call(this,n,t);this._model.data["#"].type="#"};this.bind=function(){this.element.on("model.jstree",t.proxy(function(n,t){for(var u=this._model.data,f=t.nodes,o=this.settings.types,e="default",r=0,s=f.length;r<s;r++)e="default",u[f[r]].original&&u[f[r]].original.type&&o[u[f[r]].original.type]&&(e=u[f[r]].original.type),u[f[r]].data&&u[f[r]].data.jstree&&u[f[r]].data.jstree.type&&o[u[f[r]].data.jstree.type]&&(e=u[f[r]].data.jstree.type),u[f[r]].type=e,u[f[r]].icon===!0&&o[e].icon!==i&&(u[f[r]].icon=o[e].icon);u["#"].type="#"},this));r.bind.call(this)};this.get_json=function(n,i,u){var e,s,o=this._model.data,h=i?t.extend(!0,{},i,{no_id:!1}):{},f=r.get_json.call(this,n,h,u);if(f===!1)return!1;if(t.isArray(f))for(e=0,s=f.length;e<s;e++)f[e].type=f[e].id&&o[f[e].id]&&o[f[e].id].type?o[f[e].id].type:"default",i&&i.no_id&&(delete f[e].id,f[e].li_attr&&f[e].li_attr.id&&delete f[e].li_attr.id,f[e].a_attr&&f[e].a_attr.id&&delete f[e].a_attr.id);else f.type=f.id&&o[f.id]&&o[f.id].type?o[f.id].type:"default",i&&i.no_id&&(f=this._delete_ids(f));return f};this._delete_ids=function(n){if(t.isArray(n)){for(var i=0,r=n.length;i<r;i++)n[i]=this._delete_ids(n[i]);return n}return delete n.id,n.li_attr&&n.li_attr.id&&delete n.li_attr.id,n.a_attr&&n.a_attr.id&&delete n.a_attr.id,n.children&&t.isArray(n.children)&&(n.children=this._delete_ids(n.children)),n};this.check=function(n,u,f,e,o){if(r.check.call(this,n,u,f,e,o)===!1)return!1;u=u&&u.id?u:this.get_node(u);f=f&&f.id?f:this.get_node(f);var c=u&&u.id?t.jstree.reference(u.id):null,s,h,l,a;c=c&&c._model&&c._model.data?c._model.data:null;switch(n){case"create_node":case"move_node":case"copy_node":if(n!=="move_node"||t.inArray(u.id,f.children)===-1){if(s=this.get_rules(f),s.max_children!==i&&s.max_children!==-1&&s.max_children===f.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+n,data:JSON.stringify({chk:n,pos:e,obj:u&&u.id?u.id:!1,par:f&&f.id?f.id:!1})},!1;if(s.valid_children!==i&&s.valid_children!==-1&&t.inArray(u.type||"default",s.valid_children)===-1)return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+n,data:JSON.stringify({chk:n,pos:e,obj:u&&u.id?u.id:!1,par:f&&f.id?f.id:!1})},!1;if(c&&u.children_d&&u.parents){for(h=0,l=0,a=u.children_d.length;l<a;l++)h=Math.max(h,c[u.children_d[l]].parents.length);h=h-u.parents.length+1}(h<=0||h===i)&&(h=1);do{if(s.max_depth!==i&&s.max_depth!==-1&&s.max_depth<h)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+n,data:JSON.stringify({chk:n,pos:e,obj:u&&u.id?u.id:!1,par:f&&f.id?f.id:!1})},!1;f=this.get_node(f.parent);s=this.get_rules(f);h++}while(f)}}return!0};this.get_rules=function(n){if(n=this.get_node(n),!n)return!1;var t=this.get_type(n,!0);return t.max_depth===i&&(t.max_depth=-1),t.max_children===i&&(t.max_children=-1),t.valid_children===i&&(t.valid_children=-1),t};this.get_type=function(n,i){return n=this.get_node(n),n?i?t.extend({type:n.type},this.settings.types[n.type]):n.type:!1};this.set_type=function(n,r){var u,f,s,e,o;if(t.isArray(n)){for(n=n.slice(),f=0,s=n.length;f<s;f++)this.set_type(n[f],r);return!0}return(u=this.settings.types,n=this.get_node(n),!u[r]||!n)?!1:(e=n.type,o=this.get_icon(n),n.type=r,(o===!0||u[e]&&u[e].icon!==i&&o===u[e].icon)&&this.set_icon(n,u[r].icon!==i?u[r].icon:!0),!0)}};t.jstree.defaults.unique={case_sensitive:!1,duplicate:function(n,t){return n+" ("+t+")"}};t.jstree.plugins.unique=function(n,r){this.check=function(n,i,u,f,e){if(r.check.call(this,n,i,u,f,e)===!1)return!1;if(i=i&&i.id?i:this.get_node(i),u=u&&u.id?u:this.get_node(u),!u||!u.children)return!0;for(var s=n==="rename_node"?f:i.text,h=[],c=this.settings.unique.case_sensitive,l=this._model.data,o=0,a=u.children.length;o<a;o++)h.push(c?l[u.children[o]].text:l[u.children[o]].text.toLowerCase());c||(s=s.toLowerCase());switch(n){case"delete_node":return!0;case"rename_node":return o=t.inArray(s,h)===-1||i.text&&i.text[c?"toString":"toLowerCase"]()===s,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+s+" already exists. Preventing: "+n,data:JSON.stringify({chk:n,pos:f,obj:i&&i.id?i.id:!1,par:u&&u.id?u.id:!1})}),o;case"create_node":return o=t.inArray(s,h)===-1,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+s+" already exists. Preventing: "+n,data:JSON.stringify({chk:n,pos:f,obj:i&&i.id?i.id:!1,par:u&&u.id?u.id:!1})}),o;case"copy_node":return o=t.inArray(s,h)===-1,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+s+" already exists. Preventing: "+n,data:JSON.stringify({chk:n,pos:f,obj:i&&i.id?i.id:!1,par:u&&u.id?u.id:!1})}),o;case"move_node":return o=i.parent===u.id||t.inArray(s,h)===-1,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+s+" already exists. Preventing: "+n,data:JSON.stringify({chk:n,pos:f,obj:i&&i.id?i.id:!1,par:u&&u.id?u.id:!1})}),o}return!0};this.create_node=function(n,u,f,e,o){if(!u||u.text===i){if((n===null&&(n="#"),n=this.get_node(n),!n)||(f=f===i?"last":f,!f.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(n)))return r.create_node.call(this,n,u,f,e,o);u||(u={});var l,h,c,s,a,v=this._model.data,y=this.settings.unique.case_sensitive,p=this.settings.unique.duplicate;for(h=l=this.get_string("New node"),c=[],s=0,a=n.children.length;s<a;s++)c.push(y?v[n.children[s]].text:v[n.children[s]].text.toLowerCase());for(s=1;t.inArray(y?h:h.toLowerCase(),c)!==-1;)h=p.call(this,l,++s).toString();u.text=h}return r.create_node.call(this,n,u,f,e,o)}};e=document.createElement("DIV");e.setAttribute("unselectable","on");e.setAttribute("role","presentation");e.className="jstree-wholerow";e.innerHTML="&#160;";t.jstree.plugins.wholerow=function(n,i){this.bind=function(){i.bind.call(this);this.element.on("ready.jstree set_state.jstree",t.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",t.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",t.proxy(function(){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",t.proxy(function(n,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");for(var i=!1,r=0,u=t.selected.length;r<u;r++)i=this.get_node(t.selected[r],!0),i&&i.length&&i.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",t.proxy(function(n,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",t.proxy(function(n,t){n.type==="hover_node"&&this.is_disabled(t.node)||this.get_node(t.node,!0).children(".jstree-wholerow")[n.type==="hover_node"?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",t.proxy(function(n){n.preventDefault();var i=t.Event("contextmenu",{metaKey:n.metaKey,ctrlKey:n.ctrlKey,altKey:n.altKey,shiftKey:n.shiftKey,pageX:n.pageX,pageY:n.pageY});t(n.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i)},this)).on("click.jstree",".jstree-wholerow",function(n){n.stopImmediatePropagation();var i=t.Event("click",{metaKey:n.metaKey,ctrlKey:n.ctrlKey,altKey:n.altKey,shiftKey:n.shiftKey});t(n.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",t.proxy(function(n){n.stopImmediatePropagation();var i=t.Event("click",{metaKey:n.metaKey,ctrlKey:n.ctrlKey,altKey:n.altKey,shiftKey:n.shiftKey});t(n.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(i).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",t.proxy(function(n){return n.stopImmediatePropagation(),this.is_disabled(n.currentTarget)||this.hover_node(n.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",t.proxy(function(n){this.dehover_node(n.currentTarget)},this))};this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove();i.teardown.call(this)};this.redraw_node=function(n){if(n=i.redraw_node.apply(this,arguments),n){var r=e.cloneNode(!0);t.inArray(n.id,this._data.core.selected)!==-1&&(r.className+=" jstree-wholerow-clicked");this._data.core.focused&&this._data.core.focused===n.id&&(r.className+=" jstree-wholerow-hovered");n.insertBefore(r,n.childNodes[0])}return n}},function(t){if(document.registerElement&&Object&&Object.create){var i=Object.create(HTMLElement.prototype);i.createdCallback=function(){var r={core:{},plugins:[]};for(var i in t.jstree.plugins)t.jstree.plugins.hasOwnProperty(i)&&this.attributes[i]&&(r.plugins.push(i),this.getAttribute(i)&&JSON.parse(this.getAttribute(i))&&(r[i]=JSON.parse(this.getAttribute(i))));for(i in t.jstree.defaults.core)t.jstree.defaults.core.hasOwnProperty(i)&&this.attributes[i]&&(r.core[i]=JSON.parse(this.getAttribute(i))||this.getAttribute(i));n(this).jstree(r)};try{document.registerElement("vakata-jstree",{prototype:i})}catch(r){}}}(n)}})})(jq1102,jq1102);
/*
//# sourceMappingURL=jquery.jstree.min.js.map
*/